bespin.tiki.register("::text_editor",{name:"text_editor",dependencies:{completion:"0.0.0",undomanager:"0.0.0",settings:"0.0.0",canon:"0.0.0",rangeutils:"0.0.0",traits:"0.0.0",theme_manager:"0.0.0",keyboard:"0.0.0",edit_session:"0.0.0",syntax_manager:"0.0.0"}});
bespin.tiki.module("text_editor:utils/rect",function(x,t){t._distanceFromBounds=function(v,s,n){if(v<s)return v-s;if(v>=n)return v-n;return 0};t.merge=function(v){var s;do{s=false;for(var n=[],j=0;j<v.length;j++){var b=v[j];n.push(b);for(var e=j+1;e<v.length;e++){var l=v[e];if(t.rectsSideBySide(b,l)||t.rectsIntersect(b,l)){v.splice(e,1);n[n.length-1]=t.unionRects(b,l);s=true;break}}}v=n}while(s);return v};t.offsetFromRect=function(v,s){return{x:t._distanceFromBounds(s.x,v.x,t.maxX(v)),y:t._distanceFromBounds(s.y,
v.y,t.maxY(v))}};t.rectsIntersect=function(v,s){v=t.intersectRects(v,s);return v.width!==0&&v.height!==0};t.rectsSideBySide=function(v,s){if(v.x==s.x&&v.width==s.width)return v.y<s.y?v.y+v.height==s.y:s.y+s.height==v.y;else if(v.y==s.y&&v.height==s.height)return v.x<s.x?v.x+v.width==s.x:s.x+s.width==v.x;return false};t.intersectRects=function(v,s){v={x:Math.max(t.minX(v),t.minX(s)),y:Math.max(t.minY(v),t.minY(s)),width:Math.min(t.maxX(v),t.maxX(s)),height:Math.min(t.maxY(v),t.maxY(s))};v.width=Math.max(0,
v.width-v.x);v.height=Math.max(0,v.height-v.y);return v};t.minX=function(v){return v.x||0};t.maxX=function(v){return(v.x||0)+(v.width||0)};t.minY=function(v){return v.y||0};t.maxY=function(v){return(v.y||0)+(v.height||0)};t.pointInRect=function(v,s){return v.x>=t.minX(s)&&v.y>=t.minY(s)&&v.x<=t.maxX(s)&&v.y<=t.maxY(s)};t.unionRects=function(v,s){v={x:Math.min(t.minX(v),t.minX(s)),y:Math.min(t.minY(v),t.minY(s)),width:Math.max(t.maxX(v),t.maxX(s)),height:Math.max(t.maxY(v),t.maxY(s))};v.width=Math.max(0,
v.width-v.x);v.height=Math.max(0,v.height-v.y);return v};t.rectsEqual=function(v,s,n){if(!v||!s)return v==s;if(!n&&n!==0)n=0.1;if(v.y!=s.y&&Math.abs(v.y-s.y)>n)return false;if(v.x!=s.x&&Math.abs(v.x-s.x)>n)return false;if(v.width!=s.width&&Math.abs(v.width-s.width)>n)return false;if(v.height!=s.height&&Math.abs(v.height-s.height)>n)return false;return true}});
bespin.tiki.module("text_editor:views/gutter",function(x,t){var v=x("bespin:util/util"),s=x("bespin:plugins").catalog,n=x("utils/rect"),j=x("views/canvas").CanvasView;t.GutterView=function(b,e){j.call(this,b,true);this.editor=e;this.domNode.addEventListener("click",this._click.bind(this),false)};t.GutterView.prototype=new j;v.mixin(t.GutterView.prototype,{_decorationSpacing:2,drawRect:function(b,e){var l=this.editor.themeData.gutter;e.fillStyle=l.backgroundColor;e.fillRect(b.x,b.y,b.width,b.height);
e.save();e.translate(l.paddingLeft-0.5,-0.5);l=this.editor.layoutManager;var h=l.characterRangeForBoundingRect(b);b=Math.min(h.end.row,l.textLines.length-1);for(var i=l.fontDimension.lineAscent,g=this._loadedDecorations(true),q=[],r=0;r<g.length;r++)q.push(g[r].computeWidth(this));for(h=h.start.row;h<=b;h++){e.save();r=l.lineRectForRow(h).y;e.translate(0,r);for(r=0;r<g.length;r++){g[r].drawDecoration(this,e,i,h);e.translate(q[r]+this._decorationSpacing,0)}e.restore()}e.restore()},computeWidth:function(){var b=
this.editor.themeData.gutter;b=b.paddingLeft+b.paddingRight;for(var e=this._loadedDecorations(true),l=0;l<e.length;l++)b+=e[l].computeWidth(this);b+=(e.length-1)*this._decorationSpacing;return b},_click:function(b){var e={x:b.layerX,y:b.layerY};if(n.pointInRect(e,this.frame))if((b=this._decorationAtPoint(e))&&"selected"in b){e=this.editor.layoutManager.characterAtPoint(this.computeWithClippingFrame(e.x,e.y));b.selected(this,e.row)}},_loadedDecorations:function(b){for(var e=[],l=s.getExtensions("gutterDecoration"),
h=0;h<l.length;h++){var i=l[h].load();if(i.isResolved())i.then(e.push.bind(e));else b&&i.then(this.invalidate.bind(this))}return e},_decorationAtPoint:function(b){var e=this.editor.themeData.gutter;if(b.x>e.paddingLeft){var l=this._loadedDecorations(false);e=e.paddingLeft;for(var h=0;h<l.length;h++){var i=l[h],g=i.computeWidth(this);if(b.x<e+g)return i;e+=g+this._decorationSpacing}}return null}});t.lineNumbers={drawDecoration:function(b,e,l,h){b=b.editor;e.fillStyle=b.themeData.gutter.color;e.font=
b.font;e.fillText(""+(h+1),0,l)},computeWidth:function(b){b=b.editor.layoutManager;return b.fontDimension.characterWidth*(""+b.textLines.length).length}}});
bespin.tiki.module("text_editor:views/editor",function(x,t){function v(m){var w=C.plugins.text_editor.provides,D=w.length,H={};if(m){m=m.themestyles;if(m.currentThemeVariables&&m.currentThemeVariables.text_editor)H=m.currentThemeVariables.text_editor}for(;D--;)if(w[D].ep==="themevariable"){m=j.mixin(j.clone(w[D].defaultValue),H[w[D].name]);switch(w[D].name){case "gutter":case "editor":case "scroller":case "highlighterFG":case "highlighterBG":M[w[D].name]=m}}}var s=x("rangeutils:utils/range"),n=x("views/scroller"),
j=x("bespin:util/util"),b=x("models/buffer").Buffer,e=x("completion:controller").CompletionController,l=x("controllers/search").EditorSearchController,h=x("controllers/undo").EditorUndoController,i=x("events").Event,g=x("views/gutter").GutterView;x("controllers/layoutmanager");var q=n.ScrollerCanvasView,r=x("views/text").TextView,z=x("underscore")._,C=x("bespin:plugins").catalog,f=x("keyboard:keyboard").keyboardManager,K=x("settings").settings,M={};v();C.registerExtension("themeChange",{pointer:v});
t.EditorView=function(m){this.elementAppended=new i;var w=this.element=this.container=document.createElement("div");w.style.overflow="visible";w.style.position="relative";this.scrollOffsetChanged=new i;this.willChangeBuffer=new i;this.selectionChanged=new i;this.textChanged=new i;this.gutterView=new g(w,this);this.textView=new r(w,this);var D=new q(this,n.LAYOUT_VERTICAL),H=new q(this,n.LAYOUT_HORIZONTAL);this.verticalScroller=D;this.horizontalScroller=H;this.completionController=new e(this);this.editorUndoController=
new h(this);this.searchController=new l(this);this._textViewSize=this._oldSize={width:0,height:0};this._themeData=M;this.buffer=new b(null,m);this.elementAppended.add(function(){var R=K.get("fontsize"),W=K.get("fontface");this._font=R+"px "+W;C.registerExtension("themeChange",{pointer:this._themeVariableChange.bind(this)});C.registerExtension("settingChange",{match:"font[size|face]",pointer:this._fontSettingChanged.bind(this)});C.registerExtension("dimensionsChanged",{pointer:this.dimensionsChanged.bind(this)});
this._dontRecomputeLayout=false;this._recomputeLayout();w.addEventListener(j.isMozilla?"DOMMouseScroll":"mousewheel",this._onMouseWheel.bind(this),false);D.valueChanged.add(function($){this.scrollOffset={y:$}}.bind(this));H.valueChanged.add(function($){this.scrollOffset={x:$}}.bind(this));this.scrollOffsetChanged.add(function($){this._updateScrollOffsetChanged($)}.bind(this))}.bind(this))};t.EditorView.prototype={elementAppended:null,textChanged:null,selectionChanged:null,scrollOffsetChanged:null,
willChangeBuffer:null,_textViewSize:null,_textLinesCount:0,_gutterViewWidth:0,_oldSize:null,_buffer:null,_dontRecomputeLayout:true,_themeData:null,_layoutManagerSizeChanged:function(m){var w=this.layoutManager.fontDimension;this._textViewSize={width:m.width*w.characterWidth,height:m.height*w.lineHeight};if(this._textLinesCount!==m.height){this.gutterView.computeWidth()!==this._gutterViewWidth?this._recomputeLayout(true):this.gutterView.invalidate();this._textLinesLength=m.height}this._updateScrollers();
this.scrollOffset={}},_updateScrollers:function(){if(!this._dontRecomputeLayout){var m=this.textViewPaddingFrame,w=this._textViewSize.width,D=this._textViewSize.height,H=this.scrollOffset,R=this.verticalScroller,W=this.horizontalScroller;if(D<m.height)R.isVisible=false;else{R.isVisible=true;R.proportion=m.height/D;R.maximum=D-m.height;R.value=H.y}if(w<m.width)W.isVisible=false;else{W.isVisible=true;W.proportion=m.width/w;W.maximum=w-m.width;W.value=H.x}}},_onMouseWheel:function(m){var w=0;if(m.wheelDelta)w=
-m.wheelDelta;else if(m.detail)w=m.detail*40;var D=true;if(m.axis){if(m.axis==m.HORIZONTAL_AXIS)D=false}else if(m.wheelDeltaY||m.wheelDeltaX){if(m.wheelDeltaX==m.wheelDelta)D=false}else if(m.shiftKey)D=false;D?this.scrollBy(0,w):this.scrollBy(w*5,0);j.stopEvent(m)},scrollTo:function(m){this.scrollOffset=m},scrollBy:function(m,w){this.scrollOffset={x:this.scrollOffset.x+m,y:this.scrollOffset.y+w}},_recomputeLayout:function(m){if(!this._dontRecomputeLayout){var w=this.container.offsetWidth,D=this.container.offsetHeight;
if(!(!m&&w==this._oldSize.width&&D==this._oldSize.height)){this._oldSize={width:w,height:D};this._gutterViewWidth=m=this.gutterView.computeWidth();this.gutterView.frame={x:0,y:0,width:m,height:D};this.textView.frame={x:m,y:0,width:w-m,height:D};var H=this._themeData.scroller.padding,R=this._themeData.scroller.thickness;this.horizontalScroller.frame={x:m+H,y:D-(R+H),width:w-(m+2*H+R),height:R};this.verticalScroller.frame={x:w-(H+R),y:H,width:R,height:D-(2*H+R)};this.scrollOffset={};this._updateScrollers();
this.gutterView.invalidate();this.textView.invalidate();this.verticalScroller.invalidate();this.horizontalScroller.invalidate()}}},dimensionsChanged:function(){this._recomputeLayout()},_font:null,_fontSettingChanged:function(){var m=K.get("fontsize"),w=K.get("fontface");this._font=m+"px "+w;this.layoutManager._recalculateMaximumWidth();this._layoutManagerSizeChanged(this.layoutManager.size);this.textView.invalidate()},_themeVariableChange:function(){this._recomputeLayout(true)},_updateScrollOffsetChanged:function(m){this.verticalScroller.value=
m.y;this.horizontalScroller.value=m.x;this.textView.clippingFrame={x:m.x,y:m.y};this.gutterView.clippingFrame={y:m.y};this._updateScrollers();this.gutterView.invalidate();this.textView.invalidate()},processKeyEvent:function(m,w,D){D=z(D).clone();D.completing=this.completionController.isCompleting();return f.processKeyEvent(m,w,D)},convertTextViewPoint:function(m){var w=this.scrollOffset;return{x:m.x-w.x+this._gutterViewWidth,y:m.y-w.y}},replace:function(m,w,D){if(!s.isRange(m))throw new Error('replace(): expected range but found "'+
m+"'");if(!j.isString(w))throw new Error('replace(): expected text string but found "'+text+'"');var H=s.normalizeRange(m),R=this.textView,W=R.getSelectedRange(false);return R.groupChanges(function(){R.replaceCharacters(H,w);if(D)R.setSelection(W);else{var $=w.split("\n");$=$.length>1?{row:m.start.row+$.length-1,col:$[$.length-1].length}:s.addPositions(m.start,{row:0,col:w.length});R.moveCursorTo($)}})},getText:function(m){if(!s.isRange(m))throw new Error('getText(): expected range but found "'+m+
'"');return this.layoutManager.textStorage.getCharacters(s.normalizeRange(m))},setLineNumber:function(m){if(!j.isNumber(m))throw new Error("setLineNumber(): lineNumber must be a number");this.textView.moveCursorTo({row:m-1,col:0})},setCursor:function(m){if(!s.isPosition(m))throw new Error('setCursor(): expected position but found "'+m+'"');this.textView.moveCursorTo(m)},changeGroup:function(m){return this.textView.groupChanges(function(){m(this)}.bind(this))},addTags:function(m){this.completionController.tags.add(m)}};
Object.defineProperties(t.EditorView.prototype,{themeData:{get:function(){return this._themeData},set:function(){throw new Error("themeData can't be changed directly. Use themeManager.");}},font:{get:function(){return this._font},set:function(){throw new Error("font can't be changed directly. Use settings fontsize and fontface.");}},buffer:{set:function(m){if(m!==this._buffer){if(!m.loadPromise.isResolved())throw new Error("buffer.set(): the new buffer must first be loaded!");if(this._buffer!==null){this.layoutManager.sizeChanged.remove(this);
this.layoutManager.textStorage.changed.remove(this);this.textView.selectionChanged.remove(this)}this.willChangeBuffer(m);C.publish(this,"editorChange","buffer",m);this.layoutManager=m.layoutManager;this._buffer=m;var w=this.layoutManager,D=this.textView;w.sizeChanged.add(this,this._layoutManagerSizeChanged.bind(this));w.textStorage.changed.add(this,this.textChanged.bind(this));D.selectionChanged.add(this,this.selectionChanged.bind(this));this.textView.setSelection(m._selectedRange,false);this.scrollOffsetChanged(m._scrollOffset);
this.layoutManager.sizeChanged(this.layoutManager.size);this._recomputeLayout()}},get:function(){return this._buffer}},frame:{get:function(){return{width:this.container.offsetWidth,height:this.container.offsetHeight}}},textViewPaddingFrame:{get:function(){var m=j.clone(this.textView.frame),w=this.textView.padding;m.width-=w.left+w.right;m.height-=w.top+w.bottom;return m}},scrollOffset:{set:function(m){if(m.x===undefined)m.x=this.scrollOffset.x;if(m.y===undefined)m.y=this.scrollOffset.y;var w=this.textViewPaddingFrame;
if(m.y<0)m.y=0;else if(this._textViewSize.height<w.height)m.y=0;else if(m.y+w.height>this._textViewSize.height)m.y=this._textViewSize.height-w.height;if(m.x<0)m.x=0;else if(this._textViewSize.width<w.width)m.x=0;else if(m.x+w.width>this._textViewSize.width)m.x=this._textViewSize.width-w.width;if(!(m.x===this.scrollOffset.x&&m.y===this.scrollOffset.y)){this.buffer._scrollOffset=m;this.scrollOffsetChanged(m);C.publish(this,"editorChange","scrollOffset",m)}},get:function(){return this.buffer._scrollOffset}},
readOnly:{get:function(){return this._buffer.model.readOnly},set:function(m){this._buffer.model.readOnly=m}},focus:{get:function(){return this.textView.hasFocus},set:function(m){if(!j.isBoolean(m))throw new Error('set focus: expected boolean but found "'+m+'"');this.textView.hasFocus=m}},selection:{get:function(){return j.clone(this.textView.getSelectedRange(false))},set:function(m){if(!s.isRange(m))throw new Error("set selection: position/selection must be supplied");this.textView.setSelection(m)}},
selectedText:{get:function(){return this.getText(this.selection)},set:function(m){if(!j.isString(m))throw new Error('set selectedText: expected string but found "'+m+'"');return this.replace(this.selection,m)}},value:{get:function(){return this.layoutManager.textStorage.value},set:function(m){if(!j.isString(m))throw new Error('set value: expected string but found "'+m+'"');return this.replace(this.layoutManager.textStorage.range,m,false)}},syntax:{get:function(){return this.layoutManager.syntaxManager.getSyntax()},
set:function(m){if(!j.isString(m))throw new Error('set syntax: expected string but found "'+newValue+'"');return this.layoutManager.syntaxManager.setSyntax(m)}}})});
bespin.tiki.module("text_editor:views/textinput",function(x,t){var v=x("bespin:util/util");x("events");var s=x("rangeutils:utils/range"),n=x("keyboard:keyutil");t.TextInput=function(j,b){var e=this.domNode=document.createElement("textarea");e.setAttribute("style","position: absolute; z-index: -99999; width: 0px; height: 0px; margin: 0px; outline: none; border: 0;");j.appendChild(e);this.delegate=b;this._attachEvents()};t.TextInput.prototype={_composing:false,domNode:null,delegate:null,_textFieldChanged:function(){if(!(this._composing||
this._ignore)){var j=this.domNode,b=j.value;if(b!=""){j.value="";this._textInserted(b)}}},_copy:function(){var j=false,b=this.delegate;if(b&&b.copy)j=b.copy();return j},_cut:function(){var j=false,b=this.delegate;if(b&&b.cut)j=b.cut();return j},_textInserted:function(j){var b=this.delegate;b&&b.textInserted&&b.textInserted(j)},_setValueAndSelect:function(j){var b=this.domNode;b.value=j;b.select()},focus:function(){this.domNode.focus()},blur:function(){this.domNode.blur()},_attachEvents:function(){var j=
this.domNode,b=this;j.addEventListener("focus",function(){b.delegate&&b.delegate.didFocus&&b.delegate.didFocus()},false);j.addEventListener("blur",function(){b.delegate&&b.delegate.didBlur&&b.delegate.didBlur()},false);n.addKeyDownListener(j,function(i){return b.delegate&&b.delegate.keyDown?b.delegate.keyDown(i):false});if(v.isWebKit){v.isChrome||j.addEventListener("compositionend",function(i){b._textInserted(i.data)},false);j.addEventListener("textInput",function(i){b._textInserted(i.data)},false);
j.addEventListener("paste",function(i){b._textInserted(i.clipboardData.getData("text/plain"));i.preventDefault()},false)}else{j.addEventListener("input",function(){b._textFieldChanged()},false);j.addEventListener("compositionstart",function(){b._composing=true},false);j.addEventListener("compositionend",function(){b._composing=false;b._textFieldChanged()},false);j.addEventListener("paste",function(){b._setValueAndSelect("");window.setTimeout(function(){b._textFieldChanged()},0)},false);this.delegate.selectionChanged.add(function(i){if(s.isZeroLength(i))wasSelection=
false;else{j.value="z";j.select();wasSelection=true}}.bind(this))}var e=function(i){i=i.type.indexOf("copy")!=-1?b._copy():b._cut();b._setValueAndSelect(i)};if(v.isWebKit&&!v.isChrome&&v.isMac){var l=(new Date).getTime(),h=function(i){var g=i.type.indexOf("cut")!=-1;if(!(g&&(new Date).getTime()-l<10)){e(i);if(g)l=(new Date).getTime()}};j.addEventListener("beforecopy",h,false);j.addEventListener("beforecut",h,false)}else{h=false;if(v.isMozilla)h=function(i){e(i);b._ignore=true;window.setTimeout(function(){b._setValueAndSelect("");
b._ignore=false},0)};j.addEventListener("copy",h||e,false);j.addEventListener("cut",h||e,false)}}}});
bespin.tiki.module("text_editor:views/text",function(x,t){var v=x("bespin:plugins").catalog,s=x("bespin:util/util"),n=x("events").Event,j=x("views/canvas").CanvasView;x("controllers/layoutmanager");var b=x("rangeutils:utils/range"),e=x("utils/rect"),l=x("views/textinput").TextInput,h=x("bespin:console").console,i=x("settings").settings;t.TextView=function(g,q){j.call(this,g,true);this.editor=q;this.padding={top:0,bottom:30,left:0,right:30};this.clippingChanged.add(this.clippingFrameChanged.bind(this));
var r=this.domNode;r.style.cursor="text";r.addEventListener("click",this.click.bind(this),false);r.addEventListener("mousedown",this.mouseDown.bind(this),false);r.addEventListener("mousemove",this.mouseMove.bind(this),false);window.addEventListener("mouseup",this.mouseUp.bind(this),false);q.willChangeBuffer.add(this.editorWillChangeBuffer.bind(this));this.selectionChanged=new n;this.beganChangeGroup=new n;this.endedChangeGroup=new n;this.willReplaceRange=new n;this.replacedCharacters=new n;this.textInput=
new l(g,this)};t.TextView.prototype=new j;s.mixin(t.TextView.prototype,{_dragPoint:null,_dragTimer:null,_enclosingScrollView:null,_inChangeGroup:false,_insertionPointBlinkTimer:null,_insertionPointVisible:true,_keyBuffer:"",_keyMetaBuffer:"",_keyState:"start",_hasFocus:false,_mouseIsDown:false,selectionChanged:null,beganChangeGroup:null,endedChangeGroup:null,willReplaceRange:null,replacedCharacters:null,editorWillChangeBuffer:function(g){if(this.editor.layoutManager){var q=this.editor.layoutManager;
q.invalidatedRects.remove(this);q.changedTextAtRow.remove(this)}q=g.layoutManager;q.invalidatedRects.add(this,this.layoutManagerInvalidatedRects.bind(this));q.changedTextAtRow.add(this,this.layoutManagerChangedTextAtRow.bind(this))},didFocus:function(){this._setFocus(true,true)},didBlur:function(){this._setFocus(false,true)},_drag:function(){var g=this._dragPoint,q=e.offsetFromRect(this.clippingFrame,g);this.moveCursorTo(this._selectionPositionForPoint({x:g.x-q.x,y:g.y-q.y}),true)},_drawInsertionPoint:function(g,
q){if(this._insertionPointVisible){var r=this.editor.layoutManager.characterRectForPosition(this.editor.buffer._selectedRange.start);g=Math.floor(r.x);var z=r.y,C=Math.ceil(r.width);r=r.height;q.save();var f=this.editor.themeData.editor;if(this._hasFocus){q.strokeStyle=f.cursorColor;q.beginPath();q.moveTo(g+0.5,z);q.lineTo(g+0.5,z+r);q.closePath();q.stroke()}else{q.fillStyle=f.unfocusedCursorBackgroundColor;q.fillRect(g+0.5,z,C-0.5,r);q.strokeStyle=f.unfocusedCursorColor;q.strokeRect(g+0.5,z+0.5,
C-1,r-1)}q.restore()}},_drawLines:function(g,q){var r=this.editor,z=r.layoutManager,C=z.textLines,f=z.fontDimension.lineAscent,K=r.themeData;r=K.highlighterFG;K=K.highlighterBG;q.save();q.font=this.editor.font;var M=z.characterRangeForBoundingRect(g),m=M.start;M=M.end;for(var w=M.row,D=m.row;D<=w;D++){var H=C[D];if(!s.none(H)){var R=H.characters,W=R.length,$=Math.min(M.col,W);g=m.col;if(!(g>=W)){H=H.colors;if(H==null)H=[];for(W=0;W<H.length&&g<H[W].start;)W++;for(var ea=W<H.length?H[W].start:g;ea<
$;){g=H[W];var Y=g!=null?g.end:$,da=g!=null?g.tag:"plain";g=z.characterRectForPosition({row:D,col:ea});if(K.hasOwnProperty(da)){var ia=z.characterRectForPosition({row:D,col:Y-1});q.fillStyle=K[da];q.fillRect(g.x,g.y,ia.x-g.x+ia.width,ia.height)}da=r.hasOwnProperty(da)?r[da]:"red";ea=R.substring(ea,Y);q.fillStyle=da;q.fillText(ea,g.x,g.y+f);ea=Y;W++}}}}q.restore()},_drawSelectionHighlight:function(g,q){g=this.editor.themeData.editor;g=this._hasFocus?g.selectedTextBackgroundColor:g.unfocusedCursorBackgroundColor;
var r=this.editor.layoutManager;q.save();var z=b.normalizeRange(this.editor.buffer._selectedRange);q.fillStyle=g;r.rectsForRange(z).forEach(function(C){q.fillRect(C.x,C.y,C.width,C.height)});q.restore()},_drawSelection:function(g,q){this._rangeIsInsertionPoint(this.editor.buffer._selectedRange)?this._drawInsertionPoint(g,q):this._drawSelectionHighlight(g,q)},_getVirtualSelection:function(g){var q=this.editor.buffer._selectedRange,r=this.editor.buffer._selectedRangeEndVirtual;return{start:g&&r?r:q.start,
end:r||q.end}},_invalidateSelection:function(){var g=function(z){return{x:z.x-1,y:z.y,width:z.width+2,height:z.height}},q=this.editor.layoutManager,r=b.normalizeRange(this.editor.buffer._selectedRange);if(this._rangeIsInsertionPoint(r)){q=q.characterRectForPosition(r.start);this.invalidateRect(g(q))}else q.rectsForRange(r).forEach(function(z){this.invalidateRect(g(z))},this)},_isReadOnly:function(){return this.editor.layoutManager.textStorage.readOnly},_keymappingChanged:function(){this._keyBuffer=
"";this._keyState="start"},_performVerticalKeyboardSelection:function(g){var q=this.editor.buffer._selectedRangeEndVirtual;this.moveCursorTo(b.addPositions(q!==null?q:this.editor.buffer._selectedRange.end,{row:g,col:0}),true,true)},_rangeIsInsertionPoint:function(g){return b.isZeroLength(g)},_rearmInsertionPointBlinkTimer:function(){this._insertionPointVisible||this.blinkInsertionPoint();this._insertionPointBlinkTimer!==null&&clearInterval(this._insertionPointBlinkTimer);this._insertionPointBlinkTimer=
setInterval(this.blinkInsertionPoint.bind(this),750)},_repositionSelection:function(){var g=this.editor.layoutManager.textLines,q=g.length,r=this.editor.buffer._selectedRange,z=Math.min(r.start.row,q-1);q=Math.min(r.end.row,q-1);var C=g[q];this.setSelection({start:{row:z,col:Math.min(r.start.col,g[z].characters.length)},end:{row:q,col:Math.min(r.end.col,C.characters.length)}})},_scrollPage:function(g){this.editor.scrollBy(0,(this.clippingFrame.height+this.editor.layoutManager.fontDimension.lineAscent)*
(g?-1:1))},_scrollWhileDragging:function(){var g=this._dragPoint;g=this.computeWithClippingFrame(g.layerX,g.layerY);s.mixin(this._dragPoint,g);this._drag()},_selectionPositionForPoint:function(g){g=this.editor.layoutManager.characterAtPoint(g);return g.partialFraction<0.5?g:b.addPositions(g,{row:0,col:1})},_syntaxManagerUpdatedSyntaxForRows:function(g,q){if(g!==q){var r=this.editor.layoutManager;r.updateTextRows(g,q);r.rectsForRange({start:{row:g,col:0},end:{row:q,col:0}}).forEach(this.invalidateRect,
this)}},blinkInsertionPoint:function(){this._insertionPointVisible=!this._insertionPointVisible;this._invalidateSelection()},copy:function(){return this.getSelectedCharacters()},cut:function(){var g=this.getSelectedCharacters();g!=""&&this.performBackspaceOrDelete(false);return g},click:function(){this.focus()},drawRect:function(g,q){q.fillStyle=this.editor.themeData.editor.backgroundColor;q.fillRect(g.x,g.y,g.width,g.height);this._drawSelection(g,q);this._drawLines(g,q)},focus:function(){this.textInput.focus()},
getInsertionPointPosition:function(){var g=this.editor;g=g.layoutManager.characterRectForPosition(g.buffer._selectedRange.start);return{x:g.x,y:g.y}},getSelectedCharacters:function(){return this._rangeIsInsertionPoint(this.editor.buffer._selectedRange)?"":this.editor.layoutManager.textStorage.getCharacters(b.normalizeRange(this.editor.buffer._selectedRange))},getSelectedRange:function(g){return g?this.editor.buffer._selectedRange:b.normalizeRange(this.editor.buffer._selectedRange)},groupChanges:function(g){if(this._isReadOnly())return false;
if(this._inChangeGroup){g();return true}this._inChangeGroup=true;this.beganChangeGroup(this,this.editor.buffer._selectedRange);try{g()}catch(q){h.error("Error in groupChanges(): "+q);this._inChangeGroup=false;this.endedChangeGroup(this,this.editor.buffer._selectedRange);return false}finally{this._inChangeGroup=false;this.endedChangeGroup(this,this.editor.buffer._selectedRange);return true}},insertText:function(g){if(this._isReadOnly())return false;this.groupChanges(function(){var q=b.normalizeRange(this.editor.buffer._selectedRange);
this.replaceCharacters(q,g);var r=g.split("\n");this.moveCursorTo(r.length>1?{row:q.start.row+r.length-1,col:r[r.length-1].length}:b.addPositions(q.start,{row:0,col:g.length}))}.bind(this));return true},isDelimiter:function(g){return"\"',;.!~@#$%^&*?[]<>():/\\-+ \t".indexOf(g)!==-1},keyDown:function(g){if(g.charCode===0||g._charCode===0)return this.editor.processKeyEvent(g,this,{isTextView:true});else if(g.keyCode===9)g.preventDefault();else return false},layoutManagerChangedTextAtRow:function(){this._repositionSelection()},
layoutManagerInvalidatedRects:function(g,q){q.forEach(this.invalidateRect,this)},mouseDown:function(g){this._mouseIsDown=this.hasFocus=true;var q=this.computeWithClippingFrame(g.layerX,g.layerY);s.mixin(q,{layerX:g.layerX,layerY:g.layerY});switch(g.detail){case 1:var r=this._selectionPositionForPoint(q);this.moveCursorTo(r,g.shiftKey);break;case 2:r=this._selectionPositionForPoint(q);var z=this.editor.layoutManager.textStorage.lines[r.row];if(z.length===0)return true;r.col-=r.col==z.length?1:0;var C=
!this.isDelimiter(z[r.col]),f=this,K=function(M,m){for(;M>-1&&M<z.length;M+=m)if(f.isDelimiter(z[M])===C)break;return M+(m==1?0:1)};g=K(r.col,-1);K=K(r.col,1);this.moveCursorTo({row:r.row,col:g});this.moveCursorTo({row:r.row,col:K},true);break;case 3:g=this.editor.layoutManager.textStorage.lines;r=this._selectionPositionForPoint(q);this.setSelection({start:{row:r.row,col:0},end:{row:r.row,col:g[r.row].length}});break}this._dragPoint=q;this._dragTimer=setInterval(this._scrollWhileDragging.bind(this),
100)},mouseMove:function(g){if(this._mouseIsDown){this._dragPoint=this.computeWithClippingFrame(g.layerX,g.layerY);s.mixin(this._dragPoint,{layerX:g.layerX,layerY:g.layerY});this._drag()}},mouseUp:function(){this._mouseIsDown=false;if(this._dragTimer!==null){clearInterval(this._dragTimer);this._dragTimer=null}},moveCursorTo:function(g,q,r){var z=this.editor.layoutManager.textStorage,C=z.clampPosition(g);this.setSelection({start:q?this.editor.buffer._selectedRange.start:C,end:C});if(r){q=z.lines.length;
r=g.row;z=g.col;this.editor.buffer._selectedRangeEndVirtual=r>0&&r<q?g:{row:r<1?0:q-1,col:z}}else this.editor.buffer._selectedRangeEndVirtual=null;this.scrollToPosition(this.editor.buffer._selectedRange.end)},moveDown:function(){var g=this._getVirtualSelection();g=b.normalizeRange(g);g=this._rangeIsInsertionPoint(this.editor.buffer._selectedRange)?g.end:{row:g.end.row,col:g.start.col};g=b.addPositions(g,{row:1,col:0});this.moveCursorTo(g,false,true)},moveLeft:function(){var g=b.normalizeRange(this.editor.buffer._selectedRange);
this._rangeIsInsertionPoint(g)?this.moveCursorTo(this.editor.layoutManager.textStorage.displacePosition(g.start,-1)):this.moveCursorTo(g.start)},moveRight:function(){var g=b.normalizeRange(this.editor.buffer._selectedRange);this._rangeIsInsertionPoint(g)?this.moveCursorTo(this.editor.layoutManager.textStorage.displacePosition(g.end,1)):this.moveCursorTo(g.end)},moveUp:function(){var g=b.normalizeRange(this._getVirtualSelection(true));position=b.addPositions({row:g.start.row,col:this._getVirtualSelection().end.col},
{row:-1,col:0});this.moveCursorTo(position,false,true)},parentViewFrameChanged:function(){arguments.callee.base.apply(this,arguments);this._resize()},replaceCharacters:function(g,q){if(this._isReadOnly())return false;this.groupChanges(function(){g=b.normalizeRange(g);this.willReplaceRange(this,g);this.editor.layoutManager.textStorage.replaceCharacters(g,q);this.replacedCharacters(this,g,q)}.bind(this));return true},performBackspaceOrDelete:function(g){if(this._isReadOnly())return false;var q=this.editor.layoutManager.textStorage,
r=q.lines,z="";z=0;var C=i.get("tabstop"),f=this.getSelectedRange();if(b.isZeroLength(f))if(g){g=f.start;z=r[g.row];z=z.substring(0,g.col).match(/\s*$/)[0].length<C||(g.col-C)%C!=0?1:C;f={start:q.displacePosition(g,z*-1),end:f.end}}else{g=f.end;z=r[g.row];z=z.substring(g.col).match(/^\s*/)[0].length<C?1:C;f={start:f.start,end:q.displacePosition(f.end,z)}}this.groupChanges(function(){this.replaceCharacters(f,"");this.moveCursorTo(f.start)}.bind(this));return true},resetKeyBuffers:function(){this._keyMetaBuffer=
this._keyBuffer=""},scrollPageDown:function(){this._scrollPage(false)},scrollPageUp:function(){this._scrollPage(true)},scrollToPosition:function(g){var q=this.editor.layoutManager.characterRectForPosition(g);g=q.x;var r=q.y,z=q.width;q=q.height;var C=this.clippingFrame,f=C.x,K=C.y,M=this.padding,m=C.width-M.right;C=C.height-M.bottom;this.editor.scrollTo({x:g>=f+30&&g+z<f+m?f:g-m/2+z/2,y:r>=K&&r+q<K+C?K:r-C/2+q/2})},selectAll:function(){var g=this.editor.layoutManager.textStorage.lines,q=g.length-
1;this.setSelection({start:{row:0,col:0},end:{row:q,col:g[q].length}})},selectDown:function(){this._performVerticalKeyboardSelection(1)},selectLeft:function(){this.moveCursorTo(this.editor.layoutManager.textStorage.displacePosition(this.editor.buffer._selectedRange.end,-1),true)},selectRight:function(){this.moveCursorTo(this.editor.layoutManager.textStorage.displacePosition(this.editor.buffer._selectedRange.end,1),true)},selectUp:function(){this._performVerticalKeyboardSelection(-1)},setSelection:function(g,
q){var r=this.editor.layoutManager.textStorage;g=r.clampRange(g);if(!b.equal(g,this.editor.buffer._selectedRange)){this._invalidateSelection();this.editor.buffer._selectedRange=g=r.clampRange(g);this._invalidateSelection();this._hasFocus&&this._rearmInsertionPointBlinkTimer();q&&this.scrollToPosition(g.end);this.selectionChanged(g);v.publish(this.editor,"editorChange","selection",g)}},textInserted:function(g){if(g!=="\n")if(!this.editor.processKeyEvent(g,this,{isTextView:true,isCommandKey:false})){this.insertText(g);
this.resetKeyBuffers()}},_setFocus:function(g,q){if(g!=this._hasFocus)if(this._hasFocus=g){this._rearmInsertionPointBlinkTimer();this._invalidateSelection();q||this.textInput.focus()}else{if(this._insertionPointBlinkTimer){clearInterval(this._insertionPointBlinkTimer);this._insertionPointBlinkTimer=null}this._insertionPointVisible=true;this._invalidateSelection();q||this.textInput.blur()}}});Object.defineProperties(t.TextView.prototype,{hasFocus:{get:function(){return this._hasFocus},set:function(g){this._setFocus(g,
false)}}})});
bespin.tiki.module("text_editor:views/scroller",function(x,t){var v=x("bespin:util/util"),s=x("events").Event,n=x("bespin:console").console,j=x("utils/rect"),b=x("views/canvas").CanvasView,e=t.LAYOUT_HORIZONTAL=0,l=t.LAYOUT_VERTICAL=1;t.ScrollerCanvasView=function(h,i){b.call(this,h.container,false,true);this.editor=h;this.layoutDirection=i;h=function(g,q,r){r=r||this.domNode;r.addEventListener(g,function(z){q.call(this,z);v.stopEvent(z)}.bind(this),false)}.bind(this);h("mouseover",this.mouseEntered);h("mouseout",
this.mouseExited);h("mousedown",this.mouseDown);h("mouseup",this.mouseUp,window);h("mousemove",this.mouseMove,window);this.valueChanged=new s};t.ScrollerCanvasView.prototype=new b;v.mixin(t.ScrollerCanvasView.prototype,{lineHeight:20,proportion:0,layoutDirection:l,_isVisible:false,_maximum:0,_value:0,valueChanged:null,padding:{left:0,bottom:0,top:0,right:0},_mouseDownScreenPoint:null,_mouseDownValue:null,_isMouseOver:false,_scrollTimer:null,_mouseEventPosition:null,_mouseOverHandle:false,_drawNib:function(h){var i=
this.editor.themeData.scroller,g,q;g=i.nibStyle;q=i.nibArrowStyle;i=i.nibStrokeStyle;var r=Math.floor(7.5);h.fillStyle=g;h.beginPath();h.arc(0,0,Math.floor(7.5),0,Math.PI*2,true);h.closePath();h.fill();h.strokeStyle=i;h.stroke();h.fillStyle=q;h.beginPath();h.moveTo(0,-r+3);h.lineTo(-r+3,r-5);h.lineTo(r-3,r-5);h.closePath();h.fill()},_drawNibs:function(h,i){var g=this._getClientThickness(),q=this._value,r=this._maximum,z=this._isHighlighted();if(z||q!==0){h.save();h.translate(8,g/2);h.rotate(Math.PI*
1.5);h.moveTo(0,0);this._drawNib(h,i);h.restore()}if(z||q!==r){h.save();h.translate(this._getClientLength()-8,g/2);h.rotate(Math.PI*0.5);h.moveTo(0,0);this._drawNib(h,i);h.restore()}},_getClientFrame:function(){var h=this.frame,i=this.padding;return{x:i.left,y:i.top,width:h.width-(i.left+i.right),height:h.height-(i.top+i.bottom)}},_getClientLength:function(){var h=this._getClientFrame();switch(this.layoutDirection){case e:return h.width;case l:return h.height;default:n.error("unknown layout direction");
return null}},_getClientThickness:function(){var h=this.padding,i=this.editor.themeData.scroller.thickness;switch(this.layoutDirection){case l:return i-(h.left+h.right);case e:return i-(h.top+h.bottom);default:n.error("unknown layout direction");return null}},_getFrameLength:function(){switch(this.layoutDirection){case e:return this.frame.width;case l:return this.frame.height;default:n.error("unknown layout direction");return null}},_getGutterFrame:function(){var h=this._getClientFrame(),i=this._getClientThickness();
switch(this.layoutDirection){case l:return{x:h.x,y:h.y+15,width:i,height:Math.max(0,h.height-30)};case e:return{x:h.x+15,y:h.y,width:Math.max(0,h.width-30),height:i};default:n.error("unknown layout direction");return null}},_getGutterLength:function(){var h=this._getGutterFrame(),i;switch(this.layoutDirection){case e:i=h.width;break;case l:i=h.height;break;default:n.error("unknown layout direction");break}return i},_getHandleFrame:function(){var h=this._getGutterFrame(),i=this._getHandleOffset(),
g=this._getHandleLength();switch(this.layoutDirection){case l:return{x:h.x,y:h.y+i,width:h.width,height:g};case e:return{x:h.x+i,y:h.y,width:g,height:h.height}}},_getHandleLength:function(){var h=this._getGutterLength();return Math.max(h*this.proportion,20)},_getHandleOffset:function(){var h=this._maximum;if(h===0)return 0;var i=this._getGutterLength(),g=this._getHandleLength();return(i-g)*this._value/h},_isHighlighted:function(){return this._isMouseOver===true||this._mouseDownScreenPoint!==null},
_segmentForMouseEvent:function(h){h={x:h.layerX,y:h.layerY};var i=this._getClientFrame(),g=this.padding;if(!j.pointInRect(h,i))return null;var q=this.layoutDirection;switch(q){case e:if(h.x-g.left<15)return"nib-start";else if(h.x>=i.width-15)return"nib-end";break;case l:if(h.y-g.top<15)return"nib-start";else if(h.y>=i.height-15)return"nib-end";break;default:n.error("unknown layout direction");break}g=this._getHandleFrame();if(j.pointInRect(h,g))return"handle";switch(q){case e:if(h.x<g.x)return"gutter-before";
else if(h.x>=g.x+g.width)return"gutter-after";break;case l:if(h.y<g.y)return"gutter-before";else if(h.y>=g.y+g.height)return"gutter-after";break;default:n.error("unknown layout direction");break}n.error("_segmentForMouseEvent: point ",h," outside view with handle frame ",g," and client frame ",i);return null},adjustFrame:function(){var h=this.frame;this.set("layout",{left:0,top:0,width:h.width,height:h.height})},drawRect:function(h,i){if(this._isVisible){var g=this._isHighlighted();h=this.editor.themeData.scroller;
var q=g?h.fullAlpha:h.particalAlpha,r=this.frame;i.clearRect(0,0,r.width,r.height);i.save();r=this.padding;i.translate(r.left,r.top);this._getHandleFrame();r=this._getGutterLength();var z=this._getClientThickness(),C=z/2,f=this.layoutDirection,K=this._getHandleOffset()+15,M=this._getHandleLength();if(f===l){i.translate(z+1,0);i.rotate(Math.PI*0.5)}if(!(r<=M)){i.globalAlpha=q;if(g){g=this._getClientLength();i.fillStyle=h.trackFillStyle;i.fillRect(8.5,0.5,g-16,z-1);i.strokeStyle=h.trackStrokeStyle;
i.strokeRect(8.5,0.5,g-16,z-1)}g=function(){i.beginPath();i.arc(K+C+0.5,C,C-0.5,Math.PI/2,3*Math.PI/2,false);i.arc(K+M-C-0.5,C,C-0.5,3*Math.PI/2,Math.PI/2,false);i.lineTo(K+C+0.5,z-0.5);i.closePath()};g();r=i.createLinearGradient(K,0,K,z);r.addColorStop(0,h.barFillGradientTopStart);r.addColorStop(0.4,h.barFillGradientTopStop);r.addColorStop(0.41,h.barFillStyle);r.addColorStop(0.8,h.barFillGradientBottomStart);r.addColorStop(1,h.barFillGradientBottomStop);i.fillStyle=r;i.fill();i.save();i.clip();i.fillStyle=
h.barFillStyle;i.beginPath();i.moveTo(K+C*0.4,C*0.6);i.lineTo(K+C*0.9,z*0.4);i.lineTo(K,z*0.4);i.closePath();i.fill();i.beginPath();i.moveTo(K+M-C*0.4,0+C*0.6);i.lineTo(K+M-C*0.9,0+z*0.4);i.lineTo(K+M,0+z*0.4);i.closePath();i.fill();i.restore();i.save();g();i.strokeStyle=h.trackStrokeStyle;i.stroke();i.restore();this._drawNibs(i,q);i.restore()}}},_repeatAction:function(h,i){if(h()!==false){var g=function(){this._repeatAction(h,100)}.bind(this);this._scrollTimer=setTimeout(g,i)}},_scrollByDelta:function(h){this.value=
this._value+h},_scrollUpOneLine:function(){this._scrollByDelta(-this.lineHeight);return true},_scrollDownOneLine:function(){this._scrollByDelta(this.lineHeight);return true},_scrollPage:function(){switch(this._segmentForMouseEvent(this._mouseEventPosition)){case "gutter-before":this._scrollByDelta(this._getGutterLength()*-1);break;case "gutter-after":this._scrollByDelta(this._getGutterLength());break;case null:break;default:return false}return true},mouseDown:function(h){this._mouseEventPosition=
h;this._mouseOverHandle=false;this._getGutterLength();switch(this._segmentForMouseEvent(h)){case "nib-start":this._repeatAction(this._scrollUpOneLine.bind(this),500);break;case "nib-end":this._repeatAction(this._scrollDownOneLine.bind(this),500);break;case "gutter-before":this._repeatAction(this._scrollPage.bind(this),500);break;case "gutter-after":this._repeatAction(this._scrollPage.bind(this),500);break;case "handle":break;default:n.error("_segmentForMouseEvent returned an unknown value");break}switch(this.layoutDirection){case e:this._mouseDownScreenPoint=
h.pageX;break;case l:this._mouseDownScreenPoint=h.pageY;break;default:n.error("unknown layout direction");break}},mouseMove:function(h){if(this._mouseDownScreenPoint!==null){if(this._segmentForMouseEvent(h)=="handle"||this._mouseOverHandle===true){this._mouseOverHandle=true;if(this._scrollTimer!==null){clearTimeout(this._scrollTimer);this._scrollTimer=null}var i;switch(this.layoutDirection){case e:i=h.pageX;break;case l:i=h.pageY;break;default:n.error("unknown layout direction");break}var g=i-this._mouseDownScreenPoint,
q=this._maximum,r=this._value,z=this._getGutterLength(),C=this._getHandleLength();this.value=r+q*g/(z-C);this._mouseDownScreenPoint=i}this._mouseEventPosition=h}},mouseEntered:function(){this._isMouseOver=true;this.invalidate()},mouseExited:function(){this._isMouseOver=false;this.invalidate()},mouseUp:function(){this._mouseDownValue=this._mouseDownScreenPoint=null;if(this._scrollTimer){clearTimeout(this._scrollTimer);this._scrollTimer=null}this.invalidate()}});Object.defineProperties(t.ScrollerCanvasView.prototype,
{isVisible:{set:function(h){if(this._isVisible!==h){this._isVisible=h;this.domNode.style.display=h?"block":"none";h&&this.invalidate()}}},maximum:{set:function(h){if(this._value>this._maximum)this._value=this._maximum;if(h!==this._maximum){this._maximum=h;this.invalidate()}}},value:{set:function(h){if(h<0)h=0;else if(h>this._maximum)h=this._maximum;if(h!==this._value){this._value=h;this.valueChanged(h);this.invalidate()}}}})});
bespin.tiki.module("text_editor:views/canvas",function(x,t){var v=x("bespin:util/util"),s=x("utils/rect"),n=x("events").Event;t.CanvasView=function(j,b,e){if(j){this._preventDownsize=b||false;this._clearOnFullInvalid=e||false;this._clippingFrame=this._frame={x:0,y:0,width:0,height:0};this._invalidRects=[];b=document.createElement("canvas");b.setAttribute("style","position: absolute");b.innerHTML="canvas tag not supported by your browser";j.appendChild(b);this.domNode=b;this.clippingChanged=new n;
this.clippingChanged.add(this.clippingFrameChanged.bind(this))}};t.CanvasView.prototype={domNode:null,clippingChanged:null,_canvasContext:null,_canvasId:null,_invalidRects:null,_lastRedrawTime:null,_redrawTimer:null,_clippingFrame:null,_preventDownsize:false,_clearOnFullInvalid:false,_frame:null,_getContext:function(){if(this._canvasContext===null)this._canvasContext=this.domNode.getContext("2d");return this._canvasContext},computeWithClippingFrame:function(j,b){var e=this.clippingFrame;return{x:j+
e.x,y:b+e.y}},minimumRedrawDelay:1E3/30,clippingFrameChanged:function(){this.invalidate()},drawRect:function(){},render:function(){if(!(this._renderTimer||this._redrawTimer))this._renderTimer=setTimeout(this._tryRedraw.bind(this),0)},invalidate:function(){this._invalidRects="all";this.render()},invalidateRect:function(j){var b=this._invalidRects;if(b!=="all"){b.push(j);this.render()}},_tryRedraw:function(){this._renderTimer=null;var j=(new Date).getTime(),b=this._lastRedrawTime,e=this.minimumRedrawDelay;
if(b===null||j-b>=e)this._redraw();else if(this._redrawTimer===null)this._redrawTimer=window.setTimeout(this._redraw.bind(this),e)},_redraw:function(){var j=this.clippingFrame;j={x:Math.round(j.x),y:Math.round(j.y),width:j.width,height:j.height};var b=this._getContext();b.save();b.translate(-j.x,-j.y);var e=this._invalidRects;if(e==="all"){this._clearOnFullInvalid&&b.clearRect(0,0,this.domNode.width,this.domNode.height);this.drawRect(j,b)}else s.merge(e).forEach(function(l){l=s.intersectRects(l,j);
if(l.width!==0&&l.height!==0){b.save();var h=l.x,i=l.y,g=l.width,q=l.height;b.beginPath();b.moveTo(h,i);b.lineTo(h+g,i);b.lineTo(h+g,i+q);b.lineTo(h,i+q);b.closePath();b.clip();this.drawRect(l,b);b.restore()}},this);b.restore();this._invalidRects=[];this._redrawTimer=null;this._lastRedrawTime=(new Date).getTime()}};Object.defineProperties(t.CanvasView.prototype,{clippingFrame:{get:function(){return this._clippingFrame},set:function(j){j=v.mixin(v.clone(this._clippingFrame),j);if(this._clippingFrame===
null||!s.rectsEqual(j,this._clippingFrame)){this._clippingFrame=j;this.clippingChanged()}}},frame:{get:function(){return this._frame},set:function(j){var b=this.domNode,e=b.style,l=this._preventDownsize,h=b.width,i=b.height;e=b.style;e.left=j.x+"px";e.top=j.y+"px";var g,q;if(j.width!==h)if(j.width<h)l||(g=true);else g=true;if(j.height!==i)if(j.height<i)l||(q=true);else q=true;if(g)this.domNode.width=j.width;if(q)this.domNode.height=j.height;this._frame=j;this.clippingFrame={width:j.width,height:j.height}}}})});
bespin.tiki.module("text_editor:models/buffer",function(x,t){var v=x("environment").env,s=x("bespin:util/util"),n=x("bespin:promise").Promise,j=x("models/textstorage").TextStorage,b=x("controllers/layoutmanager").LayoutManager,e=x("undomanager").UndoManager;t.Buffer=function(l,h){this._file=l;this._model=new j(h);this._layoutManager=new b({textStorage:this._model});this.undoManager=new e;if(l)this.reload().then(function(){this._updateSyntaxManagerInitialContext()}.bind(this));else{this.loadPromise=
new n;this.loadPromise.resolve()}h=v.session?v.session.history:null;var i,g,q;if(h&&l&&(i=h.getHistoryForPath(l.path))){g=i.selection;q=i.scroll}this._selectedRange=g||{start:{row:0,col:0},end:{row:0,col:0}};this._scrollOffset=q||{x:0,y:0}};t.Buffer.prototype={undoManager:null,loadPromise:null,_scrollOffset:null,_selectedRange:null,_selectedRangeEndVirtual:null,_layoutManager:null,_file:null,_model:null,save:function(){return this._file.saveContents(this._model.value)},saveAs:function(l){var h=new n;
l.saveContents(this._model.value).then(function(){this._file=l;this._updateSyntaxManagerInitialContext();h.resolve()}.bind(this),function(i){h.reject(i)});return h},reload:function(){var l=this,h;return this.loadPromise=h=this._file.loadContents().then(function(i){l._model.value=i})},_updateSyntaxManagerInitialContext:function(){var l=this._file.extension();this._layoutManager.syntaxManager.setSyntaxFromFileExt(l===null?"":l)},untitled:function(){return s.none(this._file)}};Object.defineProperties(t.Buffer.prototype,
{layoutManager:{get:function(){return this._layoutManager}},syntaxManager:{get:function(){}},file:{get:function(){return this._file}},model:{get:function(){return this._model}}})});
bespin.tiki.module("text_editor:models/textstorage",function(x,t){var v=x("events").Event,s=x("bespin:util/util");x=function(n){this._lines=n!==null&&n!==undefined?n.split("\n"):[""];this.changed=new v;return this};x.prototype={_lines:null,readOnly:false,clampPosition:function(n){var j=this._lines,b=n.row;if(b<0)return{row:0,col:0};else if(b>=j.length)return this.range.end;n=Math.max(0,Math.min(n.col,j[b].length));return{row:b,col:n}},clampRange:function(n){var j=this.clampPosition(n.start);n=this.clampPosition(n.end);
return{start:j,end:n}},deleteCharacters:function(n){this.replaceCharacters(n,"")},displacePosition:function(n,j){var b=j>0,e=this._lines,l=e.length;for(j=Math.abs(j);j!==0;j--)if(b){var h=e[n.row].length;if(n.row===l-1&&n.col===h)return n;n=n.col===h?{row:n.row+1,col:0}:{row:n.row,col:n.col+1}}else{if(n.row===0&&n.col==0)return n;if(n.col===0){e=this._lines;n={row:n.row-1,col:e[n.row-1].length}}else n={row:n.row,col:n.col-1}}return n},getCharacters:function(n){var j=this._lines,b=n.start,e=n.end,
l=b.row;n=e.row;var h=b.col;b=e.col;if(l===n)return j[l].substring(h,b);e=j[l].substring(h);l=j.slice(l+1,n);j=j[n].substring(0,b);return[e].concat(l,j).join("\n")},getLines:function(){return this._lines},getRange:function(){var n=this._lines,j=n.length-1;return{start:{row:0,col:0},end:{row:j,col:n[j].length}}},getValue:function(){return this._lines.join("\n")},insertCharacters:function(n,j){this.replaceCharacters({start:n,end:n},j)},replaceCharacters:function(n,j){if(this.readOnly)throw new Error("Attempt to modify a read-only text storage object");
var b=j.split("\n"),e=b.length,l=this.resultingRangeForReplacement(n,b),h=n.start,i=n.end,g=h.row,q=i.row,r=this._lines;b[0]=r[g].substring(0,h.col)+b[0];b[e-1]+=r[q].substring(i.col);this._lines=s.replace(r,g,q-g+1,b);this.changed(n,l,j)},resultingRangeForReplacement:function(n,j){var b=j.length;n=n.start;return{start:n,end:{row:n.row+b-1,col:(b===1?n.col:0)+j[b-1].length}}},setLines:function(n){this.setValue(n.join("\n"))},setValue:function(n){this.replaceCharacters(this.range,n)}};t.TextStorage=
x;Object.defineProperties(t.TextStorage.prototype,{lines:{get:function(){return this.getLines()},set:function(n){return this.setLines(n)}},range:{get:function(){return this.getRange()}},value:{get:function(){return this.getValue()},set:function(n){this.setValue(n)}}})});
bespin.tiki.module("text_editor:commands/editor",function(x,t){x("bespin:plugins");var v=x("settings").settings,s=x("environment").env;t.findNextCommand=function(){var j=s.view,b=j.editor.searchController,e=j.getSelectedRange();if(b=b.findNext(e.end,true)){j.setSelection(b,true);j.focus()}};t.findPrevCommand=function(){var j=s.view,b=j.editor.searchController,e=j.getSelectedRange();if(b=b.findPrevious(e.start,true)){j.setSelection(b,true);j.focus()}};var n=function(j){var b=s.view,e=b.getSelectedCharacters();
j=j(e);b=b.getSelectedRange();s.model.replaceCharacters(b,j)};t.replaceCommand=function(j){n(function(b){return b.replace(j.search+"/g",j.replace)})};t.entabCommand=function(){tabstop=v.get("tabstop");n(function(j){return j.replace(" {"+tabstop+"}","\t")})};t.detabCommand=function(){tabstop=v.get("tabstop");n(function(j){return j.replace("\t",(new Array(tabstop+1)).join(" "))})};t.trimCommand=function(j){n(function(b){b=b.split("\n");b=b.map(function(e){if(j.side==="left"||j.side==="both")e=e.replace(/^\s+/,
"");if(j.side==="right"||j.side==="both")e=e.replace(/\s+$/,"");return e});return b.join("\n")})};t.ucCommand=function(){n(function(j){return j.toUpperCase()})};t.lcCommand=function(){n(function(j){return j.toLowerCase()})}});
bespin.tiki.module("text_editor:commands/scrolling",function(x,t){var v=x("environment").env;t.scrollDocStart=function(){v.view.scrollToPosition({col:0,row:0})};t.scrollDocEnd=function(){v.view.scrollToPosition(v.model.range.end)};t.scrollPageDown=function(){v.view.scrollPageDown()};t.scrollPageUp=function(){v.view.scrollPageUp()}});
bespin.tiki.module("text_editor:commands/editing",function(x,t){var v=x("settings").settings,s=x("environment").env,n=x("rangeutils:utils/range");t.backspace=function(){s.view.performBackspaceOrDelete(true)};t.deleteCommand=function(){s.view.performBackspaceOrDelete(false)};t.deleteLines=function(){if(!s.model.readOnly)if(s.model.lines.length!=1){var b=s.view;b.groupChanges(function(){var e=b.getSelectedRange(),l=s.model.lines,h=l.length-1,i;i=e.start.row==h?{col:l[h-1].length,row:h-1}:{col:0,row:e.start.row};
b.replaceCharacters({start:i,end:e.end.row==h?{col:l[h].length,row:h}:{col:0,row:e.end.row+1}},"");b.moveCursorTo(i)})}};var j=function(b,e){var l=e.getSelectedRange().start;b=/^\s*/.exec(b.lines[l.row].substring(0,l.col));e.insertText("\n"+b)};t.insertText=function(b){s.view.insertText(b.text)};t.newline=function(){j(s.model,s.view)};t.joinLines=function(){var b=s.model;if(!b.readOnly){var e=s.view,l=e.getSelectedRange(),h=b.lines,i=l.end.row;h.length!=i&&e.groupChanges(function(){e.replaceCharacters({start:{col:h[i].length,
row:i},end:{col:/^\s*/.exec(h[i+1])[0].length,row:i+1}},"")})}};t.openLine=function(){if(!s.model.readOnly){var b=s.model,e=s.view,l=e.getSelectedRange().end.row;e.moveCursorTo({row:l,col:b.lines[l].length});j(b,e)}};t.tab=function(){var b=s.view;b.groupChanges(function(){var e=v.get("tabstop"),l=b.getSelectedRange(),h="";if(n.isZeroLength(l)){var i=s.model.lines[l.start.row].substring(l.start.col).match(/^\s*/)[0].length;e=e-(l.start.col+i)%e;for(var g=0;g<e;g++)h+=" ";b.replaceCharacters({start:l.start,
end:l.start},h);b.moveCursorTo({col:l.start.col+e+i,row:l.end.row})}else{for(g=0;g<e;g++)h+=" ";for(g=l.start.row-1;g++<l.end.row;){i=g==l.start.row?l.start.col:0;b.replaceCharacters({start:{row:g,col:i},end:{row:g,col:i}},h)}b.setSelection({start:l.start,end:{col:l.end.col+e,row:l.end.row}})}}.bind(this))};t.untab=function(){var b=s.view;b.groupChanges(function(){var e=v.get("tabstop"),l=b.getSelectedRange(),h=s.model.lines,i=0;if(n.isZeroLength(l)){i=Math.min(h[l.start.row].substring(0,l.start.col).match(/\s*$/)[0].length,
(l.start.col-e)%e||e);b.replaceCharacters({start:{col:l.start.col-i,row:l.start.row},end:l.start},"");b.moveCursorTo({row:l.start.row,col:l.end.col-i})}else{for(var g,q=l.start.row-1;q++<l.end.row;){g=q==l.start.row?l.start.col:0;i=Math.min(h[q].substring(g).match(/^\s*/)[0].length,e);b.replaceCharacters({start:{row:q,col:g},end:{row:q,col:g+i}},"")}b.setSelection({start:{row:l.start.row,col:l.start.col},end:{row:l.end.row,col:l.end.col-i}})}}.bind(this))}});
bespin.tiki.module("text_editor:commands/movement",function(x,t){x("rangeutils:utils/range");var v=x("environment").env;t.moveDown=function(){v.view.moveDown()};t.moveLeft=function(){v.view.moveLeft()};t.moveRight=function(){v.view.moveRight()};t.moveUp=function(){v.view.moveUp()};t.selectDown=function(){v.view.selectDown()};t.selectLeft=function(){v.view.selectLeft()};t.selectRight=function(){v.view.selectRight()};t.selectUp=function(){v.view.selectUp()};var s=function(l,h){var i=v.view,g=v.model.lines,
q=i.getSelectedRange(true);h=h?q.end.row:g.length-1;i.moveCursorTo({row:h,col:g[h].length},l)};t.moveLineEnd=function(){s(false,true)};t.selectLineEnd=function(){s(true,true)};t.moveDocEnd=function(){s(false,false)};t.selectDocEnd=function(){s(true,false)};var n=function(l,h){var i=v.view,g=i.getSelectedRange(true);i.moveCursorTo({row:h?g.end.row:0,col:0},l)};t.moveLineStart=function(){n(false,true)};t.selectLineStart=function(){n(true,true)};t.moveDocStart=function(){n(false,false)};t.selectDocStart=
function(){n(true,false)};var j=function(l,h,i,g,q){var r=0,z=false;if(g<0){i--;if(q)r=1}for(;i<h.length&&i>-1;){if(q=l.isDelimiter(h[i]))r++;else z=true;if((q||r>1)&&z)break;i+=g}g<0&&i++;return i},b=function(l){var h=v.view,i=v.model.lines,g=h.getSelectedRange(true).end,q=g.row;g=g.col;var r=i[q],z=false;if(g>=r.length){q++;z=true;if(q<i.length){g=0;r=i[q]}else r=""}g=j(h,r,g,1,z);h.moveCursorTo({row:q,col:g},l)},e=function(l){var h=v.view,i=v.model.lines,g=h.getSelectedRange(true).end,q=g.row;
g=g.col;var r=i[q],z=false;if(g>r.length)g=r.length;else if(g==0){q--;z=true;if(q>-1){r=i[q];g=r.length}else r=""}g=j(h,r,g,-1,z);h.moveCursorTo({row:q,col:g},l)};t.moveNextWord=function(){b(false)};t.selectNextWord=function(){b(true)};t.movePreviousWord=function(){e(false)};t.selectPreviousWord=function(){e(true)};t.selectAll=function(){v.view.selectAll()}});
bespin.tiki.module("text_editor:controllers/layoutmanager",function(x,t){var v=x("bespin:util/util"),s=x("events").Event;x("rangeutils:utils/range");var n=x("syntax_manager").SyntaxManager,j=x("models/textstorage").TextStorage,b=x("bespin:plugins").catalog,e=x("settings").settings,l=x("bespin:util/scratchcanvas"),h={};x=function(){var i=e.get("fontsize"),g=e.get("fontface");g=i+"px "+g;for(var q=l.get(),r="",z=0;z<100;z++)r+="M";g=q.measureStringWidth(g,r)/100;h.characterWidth=g;h.lineHeight=Math.floor(i*
1.6);h.lineAscent=Math.floor(i*1.3)};x();b.registerExtension("settingChange",{match:"font[size|face]",pointer:x});t.LayoutManager=function(i){this.changedTextAtRow=new s;this.invalidatedRects=new s;this.fontDimension=h;if(i.textStorage){i._textStorage=i.textStorage;delete i.textStorage}else this._textStorage=new j;v.mixin(this,i);this._textStorage.changed.add(this.textStorageChanged.bind(this));this.textLines=[{characters:"",colors:[{start:0,end:0,color:"plain"}]}];this.syntaxManager=i=new n(this);
i.attrsChanged.add(this._attrsChanged.bind(this));this._size={width:0,height:0};this.sizeChanged=new s;this._height=0;this._recomputeEntireLayout()};t.LayoutManager.prototype={_maximumWidth:0,_textStorage:null,_size:null,sizeChanged:null,_theme:{},margin:{left:5,bottom:6,top:0,right:12},pluginCatalog:b,syntaxManager:null,textLines:null,_attrsChanged:function(i,g){this.updateTextRows(i,g);this.invalidatedRects(this,this.rectsForRange({start:{row:i,col:0},end:{row:g,col:0}}))},_computeInvalidRects:function(i,
g){var q=this.characterRectForPosition(i.start),r={x:q.x,y:q.y,width:Number.MAX_VALUE,height:q.height};return i.end.row===g.end.row?[r]:[r,{x:0,y:q.y+h.lineHeight,width:Number.MAX_VALUE,height:Number.MAX_VALUE}]},_lastCharacterPosition:function(){return{row:this.textLines.length-1,col:this._maximumWidth}},_recalculateMaximumWidth:function(){var i=0;this.textLines.forEach(function(g){g=g.characters.length;if(i<g)i=g});this._maximumWidth=i;this.size={width:i,height:this.textLines.length}},_recomputeEntireLayout:function(){var i=
this._textStorage.range;this._recomputeLayoutForRanges(i,i)},_recomputeLayoutForRanges:function(i,g){for(var q=i.start.row,r=i.end.row,z=g.end.row,C=z-q+1,f=this._textStorage.lines,K=this._theme.plain,M=[],m=0;m<C;m++)M[m]={characters:f[q+m],colors:[{start:0,end:null,color:K}]};this.textLines=v.replace(this.textLines,q,r-q+1,M);this._recalculateMaximumWidth();r=this.textLines.length;C=this.syntaxManager;if(this._height!==r)this._height=r;C.invalidateRow(q);this.updateTextRows(q,z+1);this.changedTextAtRow(this,
q);this.invalidatedRects(this,this._computeInvalidRects(i,g))},boundingRect:function(){return this.rectsForRange({start:{row:0,col:0},end:{row:this.textLines.length-1,col:this._maximumWidth}})[0]},characterAtPoint:function(i){var g=this.margin,q=i.x-g.left,r=h.characterWidth,z=this._textStorage;i=z.clampPosition({row:Math.floor((i.y-g.top)/h.lineHeight),col:Math.floor(q/r)});z=z.lines[i.row].length;i.partialFraction=q<0||i.col===z?0:q%r/r;return i},characterRangeForBoundingRect:function(i){var g=
h.lineHeight,q=h.characterWidth,r=this.margin,z=i.x-r.left;r=i.y-r.top;return{start:{row:Math.max(Math.floor(r/g),0),col:Math.max(Math.floor(z/q),0)},end:{row:Math.floor((r+i.height-1)/g),col:Math.floor((z+i.width-1)/q)+1}}},characterRectForPosition:function(i){return this.rectsForRange({start:i,end:{row:i.row,col:i.col+1}})[0]},lineRectForRow:function(i){return this.rectsForRange({start:{row:i,col:0},end:{row:i,col:this._maximumWidth}})[0]},rectForPosition:function(i){var g=this.margin,q=h.characterWidth,
r=h.lineHeight;return{x:g.left+q*i.col,y:g.top+r*i.row,width:q,height:r}},rectsForRange:function(i){var g=h.characterWidth,q=h.lineHeight,r=this._maximumWidth,z=this.margin,C=i.start,f=i.end;i=C.row;var K=C.col;C=f.row;f=f.col;if(i===C)return[{x:z.left+g*K,y:z.top+q*i,width:g*(f-K),height:q}];var M=[],m;if(K===0)m=i;else{m=i+1;M.push({x:z.left+g*K,y:z.top+q*i,width:99999,height:q})}if(f===0)r=C-1;else if(f===r)r=C;else{r=C-1;M.push({x:z.left,y:z.top+q*C,width:g*f,height:q})}M.push({x:z.left,y:z.top+
q*m,width:99999,height:q*(r-m+1)});return M},textStorageChanged:function(i,g){this._recomputeLayoutForRanges(i,g)},updateTextRows:function(i,g){var q=this.textLines;g=this.syntaxManager.getAttrsForRows(i,g);for(var r=0;r<g.length;r++)q[i+r].colors=g[r]}};Object.defineProperties(t.LayoutManager.prototype,{size:{set:function(i){if(i.width!==this._size.width||i.height!==this._size.height){this.sizeChanged(i);this._size=i}},get:function(){return this._size}},textStorage:{get:function(){return this._textStorage}}})});
bespin.tiki.module("text_editor:controllers/search",function(x,t){var v=x("bespin:util/util");x("rangeutils:utils/range");x("bespin:console");t.EditorSearchController=function(s){this.editor=s};t.EditorSearchController.prototype={editor:null,_escapeString:/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}|\\)/g,_findMatchesInString:function(s){var n=[],j=this.searchRegExp,b;for(j.lastIndex=0;;){b=j.exec(s);if(b===null)break;n.push(b);j.lastIndex=b.index+b[0].length}return n},_makeRange:function(s,n){return{start:{row:n,
col:s.index},end:{row:n,col:s.index+s[0].length}}},isRegExp:null,searchRegExp:null,searchText:null,setSearchText:function(s,n){this.searchRegExp=n?new RegExp(s):new RegExp(s.replace(this._escapeString,"\\$1"),"gi");this.isRegExp=n;this.searchText=s},findNext:function(s,n){var j=this.searchRegExp;if(v.none(j))return null;s=s||this.editor.textView.getSelectedRange().end;var b=this.editor.layoutManager.textStorage.lines,e;j.lastIndex=s.col;var l;for(l=s.row;l<b.length;l++){e=j.exec(b[l]);if(!v.none(e))return this._makeRange(e,
l)}if(!n)return null;for(l=0;l<=s.row;l++){e=j.exec(b[l]);if(!v.none(e))return this._makeRange(e,l)}return null},findPrevious:function(s,n){if(v.none(this.searchRegExp))return null;s=s||this.editor.textView.getSelectedRange().start;var j=this.editor.buffer.layoutManager.textStorage.lines,b;b=this._findMatchesInString(j[s.row].substring(0,s.col));if(b.length!==0)return this._makeRange(b[b.length-1],s.row);var e;for(e=s.row-1;e!==-1;e--){b=this._findMatchesInString(j[e]);if(b.length!==0)return this._makeRange(b[b.length-
1],e)}if(!n)return null;for(e=j.length-1;e>=s.row;e--){b=this._findMatchesInString(j[e]);if(b.length!==0)return this._makeRange(b[b.length-1],e)}return null}}});
bespin.tiki.module("text_editor:controllers/undo",function(x,t){var v=x("bespin:console").console,s=x("environment").env;t.EditorUndoController=function(n){this.editor=n;n=this.textView=n.textView;n.beganChangeGroup.add(function(j,b){this._beginTransaction();this._record.selectionBefore=b}.bind(this));n.endedChangeGroup.add(function(j,b){this._record.selectionAfter=b;this._endTransaction()}.bind(this));n.replacedCharacters.add(function(j,b,e){if(!this._inTransaction)throw new Error("UndoController.textViewReplacedCharacters() called outside a transaction");
this._record.patches.push({oldCharacters:this._deletedCharacters,oldRange:b,newCharacters:e,newRange:this.editor.layoutManager.textStorage.resultingRangeForReplacement(b,e.split("\n"))});this._deletedCharacters=null}.bind(this));n.willReplaceRange.add(function(j,b){if(!this._inTransaction)throw new Error("UndoController.textViewWillReplaceRange() called outside a transaction");this._deletedCharacters=this.editor.layoutManager.textStorage.getCharacters(b)}.bind(this))};t.EditorUndoController.prototype=
{_inTransaction:false,_record:null,textView:null,_beginTransaction:function(){if(this._inTransaction){v.trace();throw new Error("UndoController._beginTransaction() called with a transaction already in place");}this._inTransaction=true;this._record={patches:[]}},_endTransaction:function(){if(!this._inTransaction)throw new Error("UndoController._endTransaction() called without a transaction in place");this.editor.buffer.undoManager.registerUndo(this,this._record);this._record=null;this._inTransaction=
false},_tryApplyingPatches:function(n){var j=this.editor.layoutManager.textStorage;n.forEach(function(b){j.replaceCharacters(b.oldRange,b.newCharacters)});return true},_undoOrRedo:function(n,j){if(this._inTransaction)throw new Error("UndoController._undoOrRedo() called while in a transaction");if(!this._tryApplyingPatches(n))return false;this.textView.setSelection(j,true);return true},redo:function(n){var j=n.patches.concat();j.reverse();return this._undoOrRedo(j,n.selectionAfter)},undo:function(n){return this._undoOrRedo(n.patches.map(function(j){return{oldCharacters:j.newCharacters,
oldRange:j.newRange,newCharacters:j.oldCharacters,newRange:j.oldRange}}),n.selectionBefore)}};t.undoManagerCommand=function(n,j){s.editor.buffer.undoManager[j.commandExt.name]()}});bespin.tiki.module("text_editor:index",function(){});bespin.tiki.register("::less",{name:"less",dependencies:{}});
bespin.tiki.module("less:index",function(x,t){function v(b){if(b instanceof j.Dimension)return parseFloat(b.unit=="%"?b.value/100:b.value);else if(typeof b==="number")return b;else throw{error:"RuntimeError",message:"color functions take numbers as parameters"};}function s(b){return Math.min(1,Math.max(0,b))}if(!Array.isArray)Array.isArray=function(b){return Object.prototype.toString.call(b)==="[object Array]"||b instanceof Array};if(!Array.prototype.forEach)Array.prototype.forEach=function(b,e){for(var l=
this.length>>>0,h=0;h<l;h++)h in this&&b.call(e,this[h],h,this)};if(!Array.prototype.map)Array.prototype.map=function(b,e){for(var l=this.length>>>0,h=new Array(l),i=0;i<l;i++)if(i in this)h[i]=b.call(e,this[i],i,this);return h};if(!Array.prototype.filter)Array.prototype.filter=function(b,e){for(var l=[],h=0;h<this.length;h++)b.call(e,this[h])&&l.push(this[h]);return l};if(!Array.prototype.reduce)Array.prototype.reduce=function(b){var e=this.length>>>0,l=0;if(e===0&&arguments.length===1)throw new TypeError;
if(arguments.length>=2)var h=arguments[1];else{do{if(l in this){h=this[l++];break}if(++l>=e)throw new TypeError;}while(1)}for(;l<e;l++)if(l in this)h=b.call(null,h,this[l],l,this);return h};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(b,e){var l=this.length;e=e||0;if(!l)return-1;if(e>=l)return-1;if(e<0)e+=l;for(;e<l;e++)if(Object.prototype.hasOwnProperty.call(this,e))if(b===this[e])return e;return-1};if(!Object.keys)Object.keys=function(b){var e=[];for(var l in b)Object.prototype.hasOwnProperty.call(b,
l)&&e.push(l);return e};if(!String.prototype.trim)String.prototype.trim=function(){return String(this).replace(/^\s\s*/,"").replace(/\s\s*$/,"")};if(typeof x!=="undefined")var n=t,j={};else n=j={};n.Parser=function(b){function e(m){var w,D,H;if(m instanceof Function)return m.call(C.parsers);else if(typeof m==="string"){w=h.charAt(i)===m?m:null;D=1}else{if(i>=z+r[g].length&&g<r.length-1)z+=r[g++].length;m.lastIndex=H=i-z;if(w=m.exec(r[g])){D=w[0].length;if(m.lastIndex-D!==H)return}}if(w){i+=D;for(D=
z+r[g].length;i<=D;){m=h.charCodeAt(i);if(!(m===32||m===10||m===9))break;i++}return typeof w==="string"?w:w.length===1?w[0]:w}}function l(m){var w;if(typeof m==="string")return h.charAt(i)===m;else{m.lastIndex=i;if((w=m.exec(h))&&m.lastIndex-w[0].length===i)return w}}var h,i,g,q,r,z,C,f=this,K=function(){},M=this.imports={paths:b&&b.paths||[],queue:[],files:{},push:function(m,w){var D=this;this.queue.push(m);n.Parser.importer(m,this.paths,function(H){D.queue.splice(D.queue.indexOf(m),1);D.files[m]=
H;w(H);D.queue.length===0&&K()})}};this.env=b||{};this.optimization="optimization"in this.env?this.env.optimization:1;return C={imports:M,parse:function(m,w){var D,H,R=null;i=g=z=q=0;r=[];h=m.replace(/\r\n/g,"\n");if(f.optimization>0){h=h.replace(/\/\*(?:[^*]|\*+[^\/*])*\*+\//g,function(ea){return f.optimization>1?"":ea.replace(/\n(\s*\n)+/g,"\n")});r=h.split(/^(?=\n)/mg)}else r=[h];D=new j.Ruleset([],e(this.parsers.primary));D.root=true;D.toCSS=function(ea){var Y,da;return function(){try{return ea.call(this)}catch(ia){da=
h.split("\n");Y=(h.slice(0,ia.index).match(/\n/g)||"").length+1;for(var ma=ia.index,na=-1;ma>=0&&h.charAt(ma)!=="\n";ma--)na++;throw{name:"NameError",message:ia.message,line:Y,column:na,extract:[da[Y-2],da[Y-1],da[Y]]};}}}(D.toCSS);if(i<h.length-1){i=q;H=h.split("\n");m=(h.slice(0,i).match(/\n/g)||"").length+1;for(var W=i,$=-1;W>=0&&h.charAt(W)!=="\n";W--)$++;R={name:"ParseError",message:"Syntax Error on line "+m,filename:b.filename,line:m,column:$,extract:[H[m-2],H[m-1],H[m]]}}if(this.imports.queue.length>
0)K=function(){w(R,D)};else w(R,D)},parsers:{primary:function(){for(var m,w=[];m=e(this.mixin.definition)||e(this.rule)||e(this.ruleset)||e(this.mixin.call)||e(this.comment)||e(/[\n\s]+/g)||e(this.directive);)w.push(m);return w},comment:function(){var m;if(h.charAt(i)==="/")return(m=e(/\/\*(?:[^*]|\*+[^\/*])*\*+\/\n?/g))?new j.Comment(m):e(/\/\/.*/g)},entities:{quoted:function(){var m;if(!(h.charAt(i)!=='"'&&h.charAt(i)!=="'"))if(m=e(/"((?:[^"\\\r\n]|\\.)*)"|'((?:[^'\\\r\n]|\\.)*)'/g))return new j.Quoted(m[0],
m[1]||m[2])},keyword:function(){var m;if(m=e(/[A-Za-z-]+/g))return new j.Keyword(m)},call:function(){var m,w;if(m=e(/([a-zA-Z0-9_-]+|%)\(/g)){if(m[1].toLowerCase()==="alpha")return e(this.alpha);w=e(this.entities.arguments);if(e(")"))if(m)return new j.Call(m[1],w)}},arguments:function(){for(var m=[],w;w=e(this.expression);){m.push(w);if(!e(","))break}return m},literal:function(){return e(this.entities.dimension)||e(this.entities.color)||e(this.entities.quoted)},url:function(){var m;if(!(h.charAt(i)!==
"u"||!e(/url\(/g))){m=e(this.entities.quoted)||e(/[-a-zA-Z0-9_%@$\/.&=:;#+?]+/g);if(!e(")"))throw new Error("missing closing ) for url()");return new j.URL(m.value?m:new j.Anonymous(m))}},variable:function(){var m,w=i;if(h.charAt(i)==="@"&&(m=e(/@[a-zA-Z0-9_-]+/g)))return new j.Variable(m,w)},color:function(){var m;if(h.charAt(i)==="#"&&(m=e(/#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})/g)))return new j.Color(m[1])},dimension:function(){var m;m=h.charCodeAt(i);if(!(m>57||m<45||m===47))if(m=e(/(-?[0-9]*\.?[0-9]+)(px|%|em|pc|ex|in|deg|s|ms|pt|cm|mm)?/g))return new j.Dimension(m[1],
m[2])}},variable:function(){var m;if(h.charAt(i)==="@"&&(m=e(/(@[a-zA-Z0-9_-]+)\s*:/g)))return m[1]},shorthand:function(){var m,w;if(l(/[@\w.-]+\/[@\w.-]+/g))if((m=e(this.entity))&&e("/")&&(w=e(this.entity)))return new j.Shorthand(m,w)},mixin:{call:function(){for(var m=[],w,D,H,R=i;w=e(/[#.][a-zA-Z0-9_-]+/g);){m.push(new j.Element(D,w));D=e(">")}e("(")&&(H=e(this.entities.arguments))&&e(")");if(m.length>0&&(e(";")||l("}")))return new j.mixin.Call(m,H,R)},definition:function(){var m,w=[],D,H;if(!(h.charAt(i)!==
"."||l(/[^{]*(;|})/g)))if(m=e(/([#.][a-zA-Z0-9_-]+)\s*\(/g)){for(m=m[1];D=e(/@[\w-]+/g)||e(this.entities.literal)||e(this.entities.keyword);){if(D[0]==="@")if(e(":"))if(H=e(this.expression))w.push({name:D,value:H});else throw new Error("Expected value");else w.push({name:D});else w.push({value:D});if(!e(","))break}if(!e(")"))throw new Error("Expected )");if(D=e(this.block))return new j.mixin.Definition(m,w,D)}}},entity:function(){return e(this.entities.literal)||e(this.entities.variable)||e(this.entities.url)||
e(this.entities.call)||e(this.entities.keyword)},end:function(){return e(";")||l("}")},alpha:function(){var m;if(e(/opacity=/gi))if(m=e(/[0-9]+/g)||e(this.entities.variable)){if(!e(")"))throw new Error("missing closing ) for alpha()");return new j.Alpha(m)}},element:function(){var m;c=e(this.combinator);if(m=e(/[.#:]?[a-zA-Z0-9_-]+/g)||e("*")||e(this.attribute)||e(/\([^)@]+\)/g))return new j.Element(c,m)},combinator:function(){var m;return(m=e(/[+>~]/g)||e("&")||e(/::/g))?new j.Combinator(m):new j.Combinator(h.charAt(i-
1)===" "?" ":null)},selector:function(){for(var m,w=[];m=e(this.element);)w.push(m);if(w.length>0)return new j.Selector(w)},tag:function(){return e(/[a-zA-Z][a-zA-Z-]*[0-9]?/g)||e("*")},attribute:function(){var m="",w,D,H;if(e("[")){if(w=e(/[a-z-]+/g)||e(this.entities.quoted))m=(H=e(/[|~*$^]?=/g))&&(D=e(this.entities.quoted)||e(/[\w-]+/g))?[w,H,D.toCSS?D.toCSS():D].join(""):w;if(e("]"))if(m)return"["+m+"]"}},block:function(){var m;if(e("{")&&(m=e(this.primary))&&e("}"))return m},ruleset:function(){var m=
[],w,D,H=i;if(w=l(/([a-z.#: _-]+)[\s\n]*\{/g)){i+=w[0].length-1;m=[new j.Selector([new j.Element(null,w[1])])]}else{for(;w=e(this.selector);){m.push(w);if(!e(","))break}w&&e(this.comment)}if(m.length>0&&(D=e(this.block)))return new j.Ruleset(m,D);else{q=i;i=H}},rule:function(){var m,w=i;if(name=e(this.property)||e(this.variable)){if(name.charAt(0)!="@"&&(match=l(/([^@+\/*(;{}-]*);/g))){i+=match[0].length-1;m=new j.Anonymous(match[1])}else m=name==="font"?e(this.font):e(this.value);if(e(this.end))return new j.Rule(name,
m,w);else{q=i;i=w}}},"import":function(){var m;if(e(/@import\s+/g)&&(m=e(this.entities.quoted)||e(this.entities.url))&&e(";"))return new j.Import(m,M)},directive:function(){var m,w,D;if(h.charAt(i)==="@")if(w=e(this["import"]))return w;else if(m=e(/@media|@page/g)){D=e(/[^{]+/g).trim();if(w=e(this.block))return new j.Directive(m+" "+D,w)}else if(m=e(/@[-a-z]+/g))if(m==="@font-face"){if(w=e(this.block))return new j.Directive(m,w)}else if((w=e(this.entity))&&e(";"))return new j.Directive(m,w)},font:function(){for(var m=
[],w=[],D;D=e(this.shorthand)||e(this.entity);)w.push(D);m.push(new j.Expression(w));if(e(","))for(;D=e(this.expression);){m.push(D);if(!e(","))break}return new j.Value(m,e(this.important))},value:function(){for(var m,w=[];m=e(this.expression);){w.push(m);if(!e(","))break}m=e(this.important);if(w.length>0)return new j.Value(w,m)},important:function(){return e(/!\s*important/g)},sub:function(){var m;if(e("(")&&(m=e(this.expression))&&e(")"))return m},multiplication:function(){var m,w,D,H;if(m=e(this.operand)){for(;(D=
e(/[\/*]/g))&&(w=e(this.operand));)H=new j.Operation(D,[H||m,w]);return H||m}},addition:function(){var m,w,D,H;if(m=e(this.multiplication)){for(;(D=e(/[-+]\s+/g)||h.charAt(i-1)!=" "&&e(/[-+]/g))&&(w=e(this.multiplication));)H=new j.Operation(D,[H||m,w]);return H||m}},operand:function(){return e(this.sub)||e(this.entities.dimension)||e(this.entities.color)||e(this.entities.variable)},expression:function(){for(var m,w=[];m=e(this.addition)||e(this.entity);)w.push(m);if(w.length>0)return new j.Expression(w)},
property:function(){var m;if(m=e(/(\*?-?[-a-z_0-9]+)\s*:/g))return m[1]}}}};n.Parser.importer=null;j.functions={rgb:function(b,e,l){return this.rgba(b,e,l,1)},rgba:function(b,e,l,h){b=[b,e,l].map(function(i){return v(i)});h=v(h);return new j.Color(b,h)},hsl:function(b,e,l){return this.hsla(b,e,l,1)},hsla:function(b,e,l,h){function i(r){r=r<0?r+1:r>1?r-1:r;return r*6<1?q+(g-q)*r*6:r*2<1?g:r*3<2?q+(g-q)*(2/3-r)*6:q}b=(v(b)%360+360)%360/360;e=v(e);l=v(l);h=v(h);var g=l<=0.5?l*(e+1):l+e-l*e,q=l*2-g;return this.rgba(i(b+
1/3)*255,i(b)*255,i(b-1/3)*255,h)},opacity:function(b,e){v(e);return new j.Color(b.rgb,v(e))},saturate:function(b,e){b=b.toHSL();b.s+=e.value/100;b.s=s(b.s);return this.hsl(b.h,b.s,b.l)},desaturate:function(b,e){b=b.toHSL();b.s-=e.value/100;b.s=s(b.s);return this.hsl(b.h,b.s,b.l)},lighten:function(b,e){b=b.toHSL();b.l*=1+e.value/100;b.l=s(b.l);return this.hsl(b.h,b.s,b.l)},darken:function(b,e){b=b.toHSL();b.l*=1-e.value/100;b.l=s(b.l);return this.hsl(b.h,b.s,b.l)},greyscale:function(b){return this.desaturate(b,
new j.Dimension(100))},e:function(b){return new j.Anonymous(b)},"%":function(b){for(var e=Array.prototype.slice.call(arguments,1),l=b.content,h=0;h<e.length;h++)l=l.replace(/%s/,e[h].content).replace(/%[da]/,e[h].toCSS());l=l.replace(/%%/g,"%");return new j.Quoted('"'+l+'"',l)}};j.Alpha=function(b){this.value=b};j.Alpha.prototype={toCSS:function(){return"alpha(opacity="+this.value.toCSS()+")"},eval:function(){return this}};j.Anonymous=function(b){this.value=b.content||b};j.Anonymous.prototype={toCSS:function(){return this.value},
eval:function(){return this}};j.Call=function(b,e){this.name=b;this.args=e};j.Call.prototype={eval:function(b){var e=this.args.map(function(l){return l.eval(b)});return this.name in j.functions?j.functions[this.name].apply(j.functions,e):new j.Anonymous(this.name+"("+e.map(function(l){return l.toCSS()}).join(", ")+")")},toCSS:function(b){return this.eval(b).toCSS()}};j.Color=function(b,e){if(Array.isArray(b)){this.rgb=b;this.alpha=e}else this.rgb=b.length==6?b.match(/.{2}/g).map(function(l){return parseInt(l,
16)}):b.split("").map(function(l){return parseInt(l+l,16)})};j.Color.prototype={eval:function(){return this},toCSS:function(){return this.alpha&&this.alpha<1?"rgba("+this.rgb.concat(this.alpha).join(", ")+")":"#"+this.rgb.map(function(b){b=Math.round(b);b=(b>255?255:b<0?0:b).toString(16);return b.length===1?"0"+b:b}).join("")},operate:function(b,e){var l=[];e instanceof j.Color||(e=e.toColor());for(var h=0;h<3;h++)l[h]=j.operate(b,this.rgb[h],e.rgb[h]);return new j.Color(l)},toHSL:function(){var b=
this.rgb[0]/255,e=this.rgb[1]/255,l=this.rgb[2]/255,h=Math.max(b,e,l),i=Math.min(b,e,l),g,q=(h+i)/2,r=h-i;if(h===i)g=i=0;else{i=q>0.5?r/(2-h-i):r/(h+i);switch(h){case b:g=(e-l)/r+(e<l?6:0);break;case e:g=(l-b)/r+2;break;case l:g=(b-e)/r+4;break}g/=6}return{h:g*360,s:i,l:q}}};j.Comment=function(b){this.value=b};j.Comment.prototype={toCSS:function(){return this.value}};j.Dimension=function(b,e){this.value=parseFloat(b);this.unit=e||null};j.Dimension.prototype={eval:function(){return this},toColor:function(){return new j.Color([this.value,
this.value,this.value])},toCSS:function(){return this.value+this.unit},operate:function(b,e){return new j.Dimension(j.operate(b,this.value,e.value),this.unit||e.unit)}};j.Directive=function(b,e){this.name=b;if(Array.isArray(e))this.ruleset=new j.Ruleset([],e);else this.value=e};j.Directive.prototype={toCSS:function(b,e){if(this.ruleset){this.ruleset.root=true;return this.name+" {\n  "+this.ruleset.toCSS(b,e).trim().replace(/\n/g,"\n  ")+"\n}\n"}else return this.name+" "+this.value.toCSS()+";\n"},
eval:function(b){b.frames.unshift(this);this.ruleset&&this.ruleset.evalRules(b);b.frames.shift();return this},variable:function(b){return j.Ruleset.prototype.variable.call(this.ruleset,b)},find:function(){return j.Ruleset.prototype.find.apply(this.ruleset,arguments)},rulesets:function(){return j.Ruleset.prototype.rulesets.apply(this.ruleset)}};j.Element=function(b,e){this.combinator=b instanceof j.Combinator?b:new j.Combinator(b);this.value=e.trim()};j.Element.prototype.toCSS=function(){return this.combinator.toCSS()+
this.value};j.Combinator=function(b){this.value=b===" "?" ":b?b.trim():""};j.Combinator.prototype.toCSS=function(){switch(this.value){case "":return"";case " ":return" ";case "&":return"";case ":":return" :";case "::":return"::";case "+":return" + ";case "~":return" ~ ";case ">":return" > "}};j.Expression=function(b){this.value=b};j.Expression.prototype={eval:function(b){return this.value.length>1?new j.Expression(this.value.map(function(e){return e.eval(b)})):this.value[0].eval(b)},toCSS:function(){return this.value.map(function(b){return b.toCSS()}).join(" ")}};
j.Import=function(b,e){var l=this;this._path=b;this.path=b instanceof j.Quoted?/\.(le?|c)ss$/.test(b.content)?b.content:b.content+".less":b.value.content||b.value;(this.css=/css$/.test(this.path))||e.push(this.path,function(h){l.root=h})};j.Import.prototype={toCSS:function(){return this.css?"@import "+this._path.toCSS()+";\n":""},eval:function(){if(this.css)return this;else{for(var b=0;b<this.root.rules.length;b++)this.root.rules[b]instanceof j.Import&&Array.prototype.splice.apply(this.root.rules,
[b,1].concat(this.root.rules[b].eval()));return this.root.rules}}};j.Keyword=function(b){this.value=b};j.Keyword.prototype={eval:function(){return this},toCSS:function(){return this.value}};j.mixin={};j.mixin.Call=function(b,e,l){this.selector=new j.Selector(b);this.arguments=e;this.index=l};j.mixin.Call.prototype={eval:function(b){for(var e,l=[],h=false,i=0;i<b.frames.length;i++)if((e=b.frames[i].find(this.selector)).length>0){for(i=0;i<e.length;i++)if(e[i].match(this.arguments,b))try{Array.prototype.push.apply(l,
e[i].eval(this.arguments,b).rules);h=true}catch(g){throw{message:g.message,index:this.index};}if(h)return l;else throw{message:"No matching definition was found for `"+this.selector.toCSS().trim()+"("+this.arguments.map(function(q){return q.toCSS()}).join(", ")+")`",index:this.index};}throw{message:this.selector.toCSS().trim()+" is undefined",index:this.index};}};j.mixin.Definition=function(b,e,l){this.name=b;this.selectors=[new j.Selector([new j.Element(null,b)])];this.params=e;this.arity=e.length;
this.rules=l;this._lookups={};this.required=e.reduce(function(h,i){return i.name&&!i.value?h+1:h},0)};j.mixin.Definition.prototype={toCSS:function(){return""},variable:function(b){return j.Ruleset.prototype.variable.call(this,b)},find:function(){return j.Ruleset.prototype.find.apply(this,arguments)},rulesets:function(){return j.Ruleset.prototype.rulesets.apply(this)},eval:function(b,e){for(var l=new j.Ruleset(null,[]),h=0,i;h<this.params.length;h++)if(this.params[h].name)if(i=b&&b[h]||this.params[h].value)l.rules.unshift(new j.Rule(this.params[h].name,
i.eval(e)));else throw{message:"wrong number of arguments for "+this.name+" ("+b.length+" for "+this.arity+")"};return(new j.Ruleset(null,this.rules)).evalRules({frames:[this,l].concat(e.frames)})},match:function(b,e){var l=b&&b.length||0;if(l<this.required)return false;for(var h=0;h<Math.min(l,this.arity);h++)if(!this.params[h].name)if(!b[h].wildcard)if(b[h].eval(e).toCSS()!=this.params[h].value.eval(e).toCSS())return false;return true}};j.Operation=function(b,e){this.op=b.trim();this.operands=e};
j.Operation.prototype.eval=function(b){var e=this.operands[0].eval(b);b=this.operands[1].eval(b);var l;if(e instanceof j.Dimension&&b instanceof j.Color)if(this.op==="*"||this.op==="+"){l=b;b=e;e=l}else throw{name:"OperationError",message:"Can't substract or divide a color from a number"};return e.operate(this.op,b)};j.operate=function(b,e,l){switch(b){case "+":return e+l;case "-":return e-l;case "*":return e*l;case "/":return e/l}};j.Quoted=function(b,e){this.value=b;this.content=e};j.Quoted.prototype=
{toCSS:function(){return this.value},eval:function(){return this}};j.Rule=function(b,e,l){this.name=b;this.value=e instanceof j.Value?e:new j.Value([e]);this.index=l;this.variable=b.charAt(0)==="@"?true:false};j.Rule.prototype.toCSS=function(){return this.variable?"":this.name+": "+this.value.toCSS()+";"};j.Rule.prototype.eval=function(b){return new j.Rule(this.name,this.value.eval(b))};j.Value=function(b){this.value=b;this.is="value"};j.Value.prototype={eval:function(b){return this.value.length===
1?this.value[0].eval(b):new j.Value(this.value.map(function(e){return e.eval(b)}))},toCSS:function(){return this.value.map(function(b){return b.toCSS()}).join(", ")}};j.Shorthand=function(b,e){this.a=b;this.b=e};j.Shorthand.prototype={toCSS:function(b){return this.a.toCSS(b)+"/"+this.b.toCSS(b)},eval:function(){return this}};j.Ruleset=function(b,e){this.selectors=b;this.rules=e;this._lookups={}};j.Ruleset.prototype={eval:function(){return this},evalRules:function(b){var e=[];this.rules.forEach(function(l){if(l.evalRules)e.push(l.evalRules(b));
else l instanceof j.mixin.Call?Array.prototype.push.apply(e,l.eval(b)):e.push(l.eval(b))});this.rules=e;return this},match:function(b){return!b||b.length===0},variable:function(b){return this._variables?this._variables[b]:(this._variables=this.rules.reduce(function(e,l){if(l instanceof j.Rule&&l.variable===true)e[l.name]=l;return e},{}))[b]},rulesets:function(){return this._rulesets?this._rulesets:(this._rulesets=this.rules.filter(function(b){if(b instanceof j.Ruleset||b instanceof j.mixin.Definition)return b}))},
find:function(b,e){e=e||this;var l=[],h=b.toCSS();if(h in this._lookups)return this._lookups[h];this.rulesets().forEach(function(i){if(i!==e)for(var g=0;g<i.selectors.length;g++)if(b.match(i.selectors[g])){b.elements.length>1?Array.prototype.push.apply(l,i.find(new j.Selector(b.elements.slice(1)),e)):l.push(i);break}});return this._lookups[h]=l},toCSS:function(b,e){var l=[],h=[],i=[],g=[];if(this.root){b=[];e={frames:[]};for(var q=0;q<this.rules.length;q++)this.rules[q]instanceof j.Import&&Array.prototype.splice.apply(this.rules,
[q,1].concat(this.rules[q].eval(e)))}else if(b.length===0)g=this.selectors.map(function(z){return[z]});else for(q=0;q<this.selectors.length;q++)for(var r=0;r<b.length;r++)g.push(b[r].concat([this.selectors[q]]));e.frames.unshift(this);for(q=0;q<this.rules.length;q++)this.rules[q]instanceof j.mixin.Call&&Array.prototype.splice.apply(this.rules,[q,1].concat(this.rules[q].eval(e)));for(q=0;q<this.rules.length;q++){b=this.rules[q];if(b instanceof j.Directive)i.push(b.eval(e).toCSS(g,e));else if(b.rules)i.push(b.toCSS(g,
e));else if(b instanceof j.Comment)this.root?i.push(b.toCSS()):h.push(b.toCSS());else if(b.toCSS&&!b.variable)h.push(b.eval(e).toCSS());else b.value&&!b.variable&&h.push(b.value.toString())}i=i.join("");if(this.root)l.push(h.join("\n"));else if(h.length>0){g=g.map(function(z){return z.map(function(C){return C.toCSS()}).join("").trim()}).join(g.length>3?",\n":", ");l.push(g," {\n  "+h.join("\n  ")+"\n}\n")}l.push(i);e.frames.shift();return l.join("")}};j.Selector=function(b){this.elements=b;if(this.elements[0].combinator.value===
"")this.elements[0].combinator.value=" "};j.Selector.prototype.match=function(b){return this.elements[0].value===b.elements[0].value?true:false};j.Selector.prototype.toCSS=function(){if(this._css)return this._css;return this._css=this.elements.map(function(b){return typeof b==="string"?" "+b.trim():b.toCSS()}).join("")};j.URL=function(b){this.value=b};j.URL.prototype={toCSS:function(){return"url("+this.value.toCSS()+")"},eval:function(){return this}};j.Variable=function(b,e){this.name=b;this.index=
e};j.Variable.prototype={eval:function(b){var e,l,h=this.name;if(e=j.find(b.frames,function(i){if(l=i.variable(h))return l.value.eval(b)}))return e;else throw{message:"variable "+this.name+" is undefined",index:this.index};}};j.find=function(b,e){for(var l=0,h;l<b.length;l++)if(h=e.call(b,b[l]))return h;return null};(function(){function b(C){for(var f=0;f<r.length;f++)e(r[f],C)}function e(C,f){var K=typeof localStorage!=="undefined"&&localStorage.getItem(C.href),M=K&&JSON.parse(K);h(C.href,function(m,
w){if(M&&(new Date(w)).valueOf()===(new Date(M.timestamp)).valueOf()){l(M.css,C);f(null,C,{local:true})}else(new n.Parser({optimization:3})).parse(m,function(D,H){if(D)return q(D,C.href);try{f(H,C,{local:false,lastModified:w})}catch(R){q(R,C.href)}})},function(m){throw new Error("Couldn't load "+C.href+" ("+m+")");})}function l(C,f,K){var M=document.createElement("style");M.type="text/css";M.media="screen";M.title="less-sheet";if(f){M.title=f.title||f.href.match(/(?:^|\/)([-\w]+)\.[a-z]+$/i)[1];K&&
typeof localStorage!=="undefined"&&localStorage.setItem(f.href,JSON.stringify({timestamp:K,css:C}))}if(M.styleSheet)M.styleSheet.cssText=C;else M.appendChild(document.createTextNode(C));document.getElementsByTagName("head")[0].appendChild(M)}function h(C,f,K){var M=i();if(window.location.protocol==="file:"){M.open("GET",C,false);M.send(null);M.status===0?f(M.responseText):K(M.status)}else{M.open("GET",C,true);M.onreadystatechange=function(){if(M.readyState==4)if(M.status>=200&&M.status<300)f(M.responseText,
M.getResponseHeader("Last-Modified"));else typeof K==="function"&&K(M.status)};M.send(null)}}function i(){if(window.XMLHttpRequest)return new XMLHttpRequest;else try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(C){g("less: browser doesn't support AJAX.");return null}}function g(C){n.env=="development"&&typeof console!=="undefined"&&console.log(C)}function q(C,f){var K=document.createElement("div"),M;K.id="less-error-message";K.innerHTML="<h3>"+(C.message||"There is an error in your .less file")+
'</h3><p><a href="'+f+'">'+f+"</a> on line "+C.line+", column "+(C.column+1)+":</p>"+'<div>\n<pre class="ctx"><span>[-1]</span>{0}</pre>\n<pre><span>[0]</span>{current}</pre>\n<pre class="ctx"><span>[1]</span>{2}</pre>\n</div>'.replace(/\[(-?\d)\]/g,function(m,w){return C.line+parseInt(w)}).replace(/\{(\d)\}/g,function(m,w){return C.extract[parseInt(w)]}).replace(/\{current\}/,C.extract[1].slice(0,C.column)+'<span class="error">'+C.extract[1].slice(C.column)+"</span>");l("#less-error-message span {margin-right: 15px;}#less-error-message pre {color: #ee4444;padding: 4px 0;margin: 0;}#less-error-message pre.ctx {color: #dd7777;}#less-error-message h3 {padding: 15px 0 5px 0;margin: 0;}#less-error-message a {color: #10a}#less-error-message .error {color: red;font-weight: bold;padding-bottom: 2px;border-bottom: 1px dashed red;}");
K.style.cssText="font-family: Arial, sans-serif;border: 1px solid #e00;background-color: #eee;border-radius: 5px;color: #e00;padding: 15px;margin-bottom: 15px";if(n.env=="development")M=setInterval(function(){if(document.body){document.body.insertBefore(K,document.body.childNodes[0]);clearInterval(M)}},10)}var r=[];n.env=location.hostname=="127.0.0.1"||location.hostname=="0.0.0.0"||location.hostname=="localhost"||location.protocol=="file:"?"development":"production";var z=setInterval(function(){if(document.body){if(!document.querySelectorAll&&
typeof jQuery==="undefined")g("No selector method found");else r=(document.querySelectorAll||jQuery).call(document,'link[rel="stylesheet/less"]');clearInterval(z);b(function(C,f,K){l(C.toCSS(),f,K.lastModified);K.local?g("less: loading "+f.href+" from local storage."):g("less: parsed "+f.href+" successfully.")})}},10);if(n.env==="development")refreshTimer=setInterval(function(){/!refresh/.test(location.hash)&&b(function(C,f,K){l(C.toCSS(),f,K)})},1E3);n.Parser.importer=function(C,f,K){e({href:C,title:C},
function(M){K(M)})}})()});bespin.tiki.register("::theme_manager_base",{name:"theme_manager_base",dependencies:{}});bespin.tiki.module("theme_manager_base:index",function(){});bespin.tiki.register("::canon",{name:"canon",dependencies:{environment:"0.0.0",events:"0.0.0",settings:"0.0.0"}});
bespin.tiki.module("canon:history",function(x,t){var v=x("bespin:util/stacktrace").Trace,s=x("bespin:plugins").catalog,n=x("bespin:console").console;t.requests=[];t.addRequestOutput=function(j){for(t.requests.push(j);t.requests.length>100;)t.requests.shiftObject();s.publish(this,"addedRequestOutput",null,j)};t.execute=function(j,b){if(b.command)try{b.command(j,b)}catch(e){var l=new v(e,true);n.group("Error executing command '"+b.typed+"'");n.log("command=",b.commandExt);n.log("args=",j);n.error(e);
l.log(3);n.groupEnd();b.doneWithError(e)}else b.doneWithError("Command not found.")}});
bespin.tiki.module("canon:request",function(x,t){var v=x("events").Event,s=x("canon:history");t.Request=function(n){n=n||{};this.command=n.command;this.commandExt=n.commandExt;this.args=n.args;this.typed=n.typed;this._begunOutput=false;this.start=new Date;this.end=null;this.error=this.completed=false;this.changed=new v};t.Request.prototype._beginOutput=function(){this._begunOutput=true;this.outputs=[];s.addRequestOutput(this)};t.Request.prototype.doneWithError=function(n){this.error=true;this.done(n)};
t.Request.prototype.async=function(){this._begunOutput||this._beginOutput()};t.Request.prototype.output=function(n){this._begunOutput||this._beginOutput();if(typeof n!=="string"&&!(n instanceof Node))n=n.toString();this.outputs.push(n);this.changed();return this};t.Request.prototype.done=function(n){this.completed=true;this.end=new Date;this.duration=this.end.getTime()-this.start.getTime();n?this.output(n):this.changed()}});bespin.tiki.module("canon:index",function(){});
bespin.tiki.register("::traits",{name:"traits",dependencies:{}});
bespin.tiki.module("traits:index",function(x,t){x=function(){function v(){try{if(Object.getOwnPropertyDescriptor)return!!Object.getOwnPropertyDescriptor({x:0},"x")}catch(L){}return false}function s(){try{if(Object.defineProperty){var L={};Object.defineProperty(L,"x",{value:0});return L.x===0}}catch(P){}return false}function n(L){var P=function(){throw new Error("Conflicting property: "+L);};Y(P.prototype);return Y(P)}function j(){return Y({value:undefined,enumerable:false,required:true})}function b(L){L=
n(L);return D?Y({get:L,set:L,enumerable:false,conflict:true}):Y({value:L,enumerable:false,conflict:true})}function e(L,P){return L===P?L!==0||1/L===1/P:L!==L&&P!==P}function l(L,P){return L.conflict&&P.conflict?true:L.get===P.get&&L.set===P.set&&e(L.value,P.value)&&L.enumerable===P.enumerable&&L.required===P.required&&L.conflict===P.conflict}function h(L,P){return Y(R(L,P))}function i(L){var P={};ea(L,function(S){P[S]=true});return Y(P)}function g(L){var P={};ea(da(L),function(S){var T=ia(L,S);if(T.value===
ta)T=j(S);else if(typeof T.value==="function"){T.method=true;"prototype"in T.value&&Y(T.value.prototype)}else{T.get&&T.get.prototype&&Y(T.get.prototype);T.set&&T.set.prototype&&Y(T.set.prototype)}P[S]=T});return P}function q(){var L=$(arguments,0),P={};ea(L,function(S){ea(da(S),function(T){var aa=S[T];if(W(P,T)&&!P[T].required)aa.required||l(P[T],aa)||(P[T]=b(T));else P[T]=aa})});return Y(P)}function r(L,P){var S=i(L),T={};ea(da(P),function(aa){T[aa]=!W(S,aa)||P[aa].required?P[aa]:j(aa)});return Y(T)}
function z(){var L=$(arguments,0),P={};ea(L,function(S){ea(da(S),function(T){var aa=S[T];if(!W(P,T)||P[T].required)P[T]=aa})});return Y(P)}function C(L,P){var S={};ea(da(P),function(T){if(W(L,T)&&!P[T].required){var aa=L[T];S[aa]=W(S,aa)&&!S[aa].required?b(aa):P[T];W(S,T)||(S[T]=j(T))}else if(W(S,T))P[T].required||(S[T]=b(T));else S[T]=P[T]});return Y(S)}function f(L,P){var S={},T=[];for(var aa in L)if(W(L,aa))if(L[aa])S[aa]=L[aa];else T.push(aa);return C(S,r(T,P))}function K(L,P){var S=oa(L),T={};
ea(da(P),function(aa){var ha=P[aa];if(ha.required){if(!(aa in L))throw new Error("Missing required property: "+aa);}else if(ha.conflict)throw new Error("Remaining conflicting property: "+aa);else T[aa]="value"in ha?ha.method?{value:h(ha.value,S),enumerable:ha.enumerable,configurable:ha.configurable,writable:ha.writable}:ha:{get:ha.get?h(ha.get,S):undefined,set:ha.set?h(ha.set,S):undefined,enumerable:ha.enumerable,configurable:ha.configurable,writable:ha.writable}});na(S,T);return Y(S)}function M(L,
P){return K(Object.prototype,g(L),P)}function m(L,P){var S=da(L),T=da(P);if(S.length!==T.length)return false;for(var aa=0;aa<S.length;aa++){T=S[aa];if(!P[T]||!l(L[T],P[T]))return false}return true}function w(L){return g(L)}var D=function(){try{var L={};Object.defineProperty(L,"x",{get:function(){return 0}});return L.x===0}catch(P){return false}}(),H=Function.prototype.call,R=Function.prototype.bind?function(L,P){return Function.prototype.bind.call(L,P)}:function(L,P){function S(){return L.apply(P,
arguments)}return S},W=R(H,Object.prototype.hasOwnProperty),$=R(H,Array.prototype.slice),ea=Array.prototype.forEach?R(H,Array.prototype.forEach):function(L,P){for(var S=0,T=L.length;S<T;S++)P(L[S])},Y=Object.freeze?function(L){Object.freeze(L);return L}:function(L){return L},da=Object.getOwnPropertyNames||function(L){var P=[];for(var S in L)W(L,S)&&P.push(S);return P},ia=v()?Object.getOwnPropertyDescriptor:function(L,P){return{value:L[P],enumerable:true,writable:true,configurable:true}},ma=s()?Object.defineProperty:
function(L,P,S){L[P]=S.value},na=Object.defineProperties||function(L,P){for(var S in P)W(P,S)&&ma(L,S,P[S])},oa=Object.create||function(L,P){function S(){}S.prototype=L||Object.prototype;L=new S;P&&na(L,P);return L};H=Object.getOwnProperties||function(L){var P={};ea(da(L),function(S){P[S]=ia(L,S)});return P};var ta=Y({toString:function(){return"<Trait.required>"}});if(!Object.create)Object.create=oa;if(!Object.getOwnProperties)Object.getOwnProperties=H;w.required=Y(ta);w.compose=Y(q);w.resolve=Y(f);
w.override=Y(z);w.create=Y(K);w.eqv=Y(m);w.object=Y(M);return Y(w)}();if(typeof t!=="undefined")t.Trait=x});bespin.tiki.register("::keyboard",{name:"keyboard",dependencies:{canon:"0.0.0",settings:"0.0.0"}});
bespin.tiki.module("keyboard:keyboard",function(x,t){var v=x("bespin:plugins").catalog;x("bespin:console");x("bespin:util/stacktrace");var s=x("bespin:util/util"),n=x("settings").settings,j=x("keyboard:keyutil"),b=x("canon:history"),e=x("canon:request").Request,l=x("environment").env;t.buildFlags=function(h){h.context=l.contexts[0];return h};x=function(){};s.mixin(x.prototype,{_customKeymappingCache:{states:{}},processKeyEvent:function(h,i,g){h=j.commandCodes(h,true)[0];if(s.none(h))return false;
t.buildFlags(g);g.isCommandKey=true;return this._matchCommand(h,i,g)},_matchCommand:function(h,i,g){var q=this._findCommandExtension(h,i,g);if(q&&q.commandExt!=="no command"){g.isTextView&&i.resetKeyBuffers();var r=q.commandExt;r.load(function(z){z=new e({command:z,commandExt:r});b.execute(q.args,z)});return true}return q&&q.commandExt==="no command"?true:false},_buildBindingsRegex:function(h){h.forEach(function(i){if(s.none(i.key))if(Array.isArray(i.regex)){i.key=new RegExp("^"+i.regex[1]+"$");i.regex=
new RegExp(i.regex.join("")+"$")}else i.regex=new RegExp(i.regex+"$");else i.key=new RegExp("^"+i.key+"$")})},_buildKeymappingRegex:function(h){for(state in h.states)this._buildBindingsRegex(h.states[state]);h._convertedRegExp=true},_findCommandExtension:function(h,i,g){if(g.isTextView){var q=i._keyState;if(!g.isCommandKey||h.indexOf("alt_")===-1){i._keyBuffer+=h.replace(/ctrl_meta|meta/,"ctrl");i._keyMetaBuffer+=h}var r=[this._customKeymappingCache];r=r.concat(v.getExtensions("keymapping"));for(var z=
0;z<r.length;z++)if(!s.none(r[z].states[q])){s.none(r[z]._convertedRegExp)&&this._buildKeymappingRegex(r[z]);var C=this._bindingsMatch(h,g,i,r[z]);if(!s.none(C))return C}}i=v.getExtensions("command");var f=null;q={};h=h.replace(/ctrl_meta|meta/,"ctrl");i.some(function(K){if(this._commandMatches(K,h,g)){f=K;return true}return false}.bind(this));return s.none(f)?null:{commandExt:f,args:q}},_bindingsMatch:function(h,i,g,q){var r,z=null,C={},f;f=s.none(q.hasMetaKey)?g._keyMetaBuffer:g._keyBuffer;if(h.indexOf("alt_")===
0&&i.isCommandKey)f+=h;q.states[g._keyState].some(function(K){if(K.key&&!K.key.test(h))return false;if(K.regex&&!(r=K.regex.exec(f)))return false;if(K.disallowMatches)for(var M=0;M<K.disallowMatches.length;M++)if(r[K.disallowMatches[M]])return true;if(!t.flagsMatch(K.predicates,i))return false;if(K.exec){z=v.getExtensionByKey("command",K.exec);if(s.none(z))throw new Error("Can't find command "+K.exec+" in state="+g._keyState+", symbolicName="+h);if(K.params){var m;K.params.forEach(function(w){m=!s.none(w.match)&&
!s.none(r)?r[w.match]||w.defaultValue:w.defaultValue;if(w.type==="number")m=parseInt(m);C[w.name]=m})}g.resetKeyBuffers()}if(K.then){g._keyState=K.then;g.resetKeyBuffers()}if(s.none(z))z="no command";return true});if(s.none(z))return null;return{commandExt:z,args:C}},_commandMatches:function(h,i,g){var q=h.key;if(!q)return false;if(!t.flagsMatch(h.predicates,g))return false;if(typeof q==="string"){if(q!=i)return false;return true}if(!Array.isArray(q)){q=[q];h.key=q}for(h=0;h<q.length;h++){var r=q[h];
if(typeof r==="string"){if(r==i)return true}else if(r.key==i)return t.flagsMatch(r.predicates,g)}return false},_customKeymappingChanged:function(){var h=this._customKeymappingCache=JSON.parse(n.get("customKeymapping"));h.states=h.states||{};for(state in h.states)this._buildBindingsRegex(h.states[state]);h._convertedRegExp=true}});t.flagsMatch=function(h,i){if(s.none(h))return true;if(!i)return false;for(var g in h)if(i[g]!==h[g])return false;return true};t.keyboardManager=new x;v.registerExtension("settingChange",
{match:"customKeymapping",pointer:t.keyboardManager._customKeymappingChanged.bind(t.keyboardManager)})});
bespin.tiki.module("keyboard:keyutil",function(x,t){var v=x("bespin:util/util");t.KeyHelper=function(){var n={MODIFIER_KEYS:{16:"shift",17:"ctrl",18:"alt",224:"meta"},FUNCTION_KEYS:{8:"backspace",9:"tab",13:"return",19:"pause",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"printscreen",45:"insert",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock"},PRINTABLE_KEYS:{32:" ",
48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:'"'},PRINTABLE_KEYS_CHARCODE:{},KEY:{}};for(var j in n.PRINTABLE_KEYS){var b=n.PRINTABLE_KEYS[j];n.PRINTABLE_KEYS_CHARCODE[b.charCodeAt(0)]=j;if(b.toUpperCase()!=
b)n.PRINTABLE_KEYS_CHARCODE[b.toUpperCase().charCodeAt(0)]=j}for(j in n.FUNCTION_KEYS){b=n.FUNCTION_KEYS[j].toUpperCase();n.KEY[b]=parseInt(j,10)}return n}();var s=function(n){return!!(n.altKey||n.ctrlKey||n.metaKey||n.charCode!==n.which&&t.KeyHelper.FUNCTION_KEYS[n.which])};t.commandCodes=function(n,j){var b=n._keyCode||n.keyCode,e=n._charCode===undefined?n.charCode:n._charCode,l=null,h=null,i="",g=true;if(b===0&&n.which===0)return false;if(e!==0)return false;if(t.KeyHelper.MODIFIER_KEYS[e])return[t.KeyHelper.MODIFIER_KEYS[e],
null];if(b){l=t.KeyHelper.FUNCTION_KEYS[b];if(!l&&(n.altKey||n.ctrlKey||n.metaKey)){l=t.KeyHelper.PRINTABLE_KEYS[b];if(b>47&&b<58)g=n.altKey}if(l){if(n.altKey)i+="alt_";if(n.ctrlKey)i+="ctrl_";if(n.metaKey)i+="meta_"}else if(n.ctrlKey||n.metaKey)return false}if(!l){b=n.which;h=l=String.fromCharCode(b);b=l.toLowerCase();if(n.metaKey){i="meta_";l=b}else l=null}if(n.shiftKey&&l&&g)i+="shift_";if(l)l=i+l;if(!j&&l)l=l.replace(/ctrl_meta|meta/,"ctrl");return[l,h]};t.addKeyDownListener=function(n,j){var b=
function(e){var l=j(e);l&&v.stopEvent(e);return l};n.addEventListener("keydown",function(e){if(v.isMozilla)if(t.KeyHelper.FUNCTION_KEYS[e.keyCode])return true;else if((e.ctrlKey||e.metaKey)&&t.KeyHelper.PRINTABLE_KEYS[e.keyCode])return true;if(s(e))return b(e);return true},false);n.addEventListener("keypress",function(e){if(v.isMozilla)if(t.KeyHelper.FUNCTION_KEYS[e.keyCode])return b(e);else if((e.ctrlKey||e.metaKey)&&t.KeyHelper.PRINTABLE_KEYS_CHARCODE[e.charCode]){e._keyCode=t.KeyHelper.PRINTABLE_KEYS_CHARCODE[e.charCode];
e._charCode=0;return b(e)}if(e.charCode!==undefined&&e.charCode===0)return true;return b(e)},false)}});bespin.tiki.module("keyboard:index",function(){});bespin.tiki.register("::worker_manager",{name:"worker_manager",dependencies:{canon:"0.0.0",events:"0.0.0",underscore:"0.0.0"}});
bespin.tiki.module("worker_manager:index",function(x,t){function v(i){var g=/^([^#:]+)(?::([^#:]+))?#([^#:]+)$/.exec(i);if(g==null)throw new Error('WorkerSupervisor: invalid pointer specification: "'+i+'"');i=g[1];var q=g[3];g=i+":"+(g[2]!=null?g[2]:"index");var r=bespin!=null&&bespin.base!=null?bespin.base:"";this._packageId=i;this._moduleId=g;this._base=r;this._target=q;this._worker=null;this._currentId=0;this.started=new e}function s(){h.restartAll()}if(window==null)throw new Error('The "worker_manager" plugin can only be loaded in the browser, not a web worker. Use "worker" instead.');
var n=x("bespin:proxy");x("bespin:plugins");var j=x("bespin:console").console,b=x("underscore")._,e=x("events").Event,l=x("bespin:promise").Promise;x("environment");var h={_workers:[],add:function(i){this._workers.push(i)},remove:function(i){this._workers=b(this._workers).without(i)},restartAll:function(){var i=this._workers;b(i).invoke("kill");b(i).invoke("start")}};v.prototype={_onError:function(i){this._worker=null;h.remove(this);j.error("WorkerSupervisor: worker failed at file "+i.filename+":"+
i.lineno+"; fix the worker and use 'worker restart' to restart it")},_onMessage:function(i){i=JSON.parse(i.data);switch(i.op){case "finish":if(i.id===this._currentId){var g=this._promise;this._promise=null;g.resolve(i.result)}break;case "log":j[i.method].apply(j,i.args);break}},_promise:null,started:null,kill:function(){var i=this._promise;if(i!=null){i.reject("killed");this._promise=null}this._worker.terminate();this._worker=null;h.remove(this)},send:function(i,g){var q=this._promise;if(q!=null){q.reject("interrupted");
this._currentId++}q=this._currentId;var r=new l;this._promise=r;this._worker.postMessage(JSON.stringify({op:"invoke",id:q,method:i,args:g}));return r},start:function(){if(this._worker!=null)throw new Error("WorkerSupervisor: worker already started");var i=this._base,g=this._target,q=this._packageId,r=this._moduleId,z=new n.Worker(i+"BespinEmbedded.js");z.onmessage=this._onMessage.bind(this);z.onerror=this._onError.bind(this);z.postMessage(JSON.stringify({op:"load",base:i,pkg:q,module:r,target:g}));
this._worker=z;this._currentId=0;h.add(this);this.started()}};t.WorkerSupervisor=v;t.workerManager=h;t.workerRestartCommand=s});bespin.tiki.register("::edit_session",{name:"edit_session",dependencies:{events:"0.0.0"}});
bespin.tiki.module("edit_session:index",function(x,t){x("bespin:promise");x("bespin:plugins");x("bespin:util/util");x("events");t.EditSession=function(){};t.EditSession.prototype={_currentView:null,currentUser:null,history:null,getCompletePath:function(v){if(v==null)v="";if(v==null||v.substring(0,1)!="/"){var s;if(this._currentView&&this._currentView.buffer)s=this._currentView.buffer;var n;if(s)n=s.file;v=n?n.parentdir()+v:"/"+v}return v}};Object.defineProperties(t.EditSession.prototype,{currentView:{set:function(v){if(v!==
this._currentView)this._currentView=v},get:function(){return this._currentView}}});t.createSession=function(v,s){var n=new t.EditSession;if(v)n.currentView=v.textView;if(s)n.currentUser=s;return n}});bespin.tiki.register("::syntax_manager",{name:"syntax_manager",dependencies:{worker_manager:"0.0.0",syntax_directory:"0.0.0",events:"0.0.0",underscore:"0.0.0",settings:"0.0.0"}});
bespin.tiki.module("syntax_manager:index",function(x,t){function v(g,q,r,z){for(;g.length<q;)g.push(b(z).clone());q=[q,r.length].concat(r);Array.prototype.splice.apply(g,q);return g}function s(){this._lines=[];this._syms={}}function n(g,q){this._syntaxInfo=g;this._syntaxManager=q;this._invalidRow=0;this._states=[];this._active=false;this.symbols=new s}function j(g){this.layoutManager=g;this.attrsChanged=new e;this.syntaxChanged=new e;this._contextRanges=this._invalidRows=this._context=null;this._attrs=
[];this._symbols=new s;this._syntax="plain";this._reset()}var b=x("underscore")._,e=x("events").Event,l=x("worker_manager").WorkerSupervisor;x("bespin:console");x("rangeutils:utils/range");var h=x("settings").settings,i=x("syntax_directory").syntaxDirectory;s.prototype={get:function(g){return this._syms["-"+g]},replaceLine:function(g,q){function r(f){return f.substring(1)}var z=this._lines,C=this._syms;g<z.length&&b(z[g]).isArray()&&b(z[g]).each(function(f){delete C["-"+f]});z[g]=b(q).keys().map(r);
b(C).extend(q)}};n.prototype={_annotate:function(){if(this._invalidRow==null)throw new Error("syntax_manager.Context: attempt to annotate without any invalid row");if(!this._active)throw new Error("syntax_manager.Context: attempt to annotate while inactive");if(this._worker==null)this._createWorker();else{var g=this._syntaxManager.getTextLines(),q=this._invalidRow,r=q===0?this.getName()+":start":this._states[q],z=Math.min(g.length,q+100);g=g.slice(q,z);var C={start:{row:q,col:0},end:{row:z-1,col:b(g).last().length}};
this._worker.send("annotate",[r,g,C]).then(b(this._annotationFinished).bind(this,q,z))}},_annotationFinished:function(g,q,r){if(this._active){var z=this._syntaxManager;z.mergeAttrs(g,r.attrs);z.mergeSymbols(g,r.symbols);v(this._states,g,r.states);if(q>=this._getRowCount()){this._invalidRow=null;this._active=false}else{this._invalidRow=q;this._annotate()}}},_createWorker:function(){if(this._syntaxInfo==null)return false;var g=new l("syntax_worker#syntaxWorker");this._worker=g;g.started.add(this._workerStarted.bind(this));
g.start();return true},_getRowCount:function(){return this._syntaxManager.getTextLines().length},_workerStarted:function(){this._syntaxInfo.settings.forEach(function(g){var q=h.get(g);this._worker.send("setSyntaxSetting",[g,q])},this);this._worker.send("loadSyntax",[this._syntaxInfo.name]);this._active&&this._annotate()},activateAndAnnotate:function(){this._active=true;this._annotate()},contextsAtPosition:function(){var g=this._syntaxInfo;if(g==null)return["plain"];return[g.name]},cut:function(g){var q=
this._getRowCount();if(g<0||g>=q)throw new Error("Attempt to cut the context at an invalid row");if(!(this._invalidRow!=null&&this._invalidRow<g)){this._invalidRow=g;this._active=false}},getName:function(){return this._syntaxInfo.name},kill:function(){var g=this._worker;if(g!=null){g.kill();this._worker=null}}};j.prototype={_getTextStorage:function(){return this.layoutManager.textStorage},_reset:function(){var g=this._context;if(g!=null){g.kill();this._context=null}g=this._syntax;g=g==="plain"?null:
i.get(g);this._context=g=new n(g,this);g.activateAndAnnotate()},attrsChanged:null,syntaxChanged:null,contextsAtPosition:function(g){return this._context.contextsAtPosition(g)},getAttrsForRows:function(g,q){return this._attrs.slice(g,q)},getSymbol:function(g){return this._symbols.get(g)},getSyntax:function(){return this._syntax},getTextLines:function(){return this._getTextStorage().lines},invalidateRow:function(g){var q=this._context;q.cut(g);q.activateAndAnnotate()},mergeAttrs:function(g,q){v(this._attrs,
g,q,[]);this.attrsChanged(g,g+q.length)},mergeSymbols:function(g,q){var r=this._symbols;b(q).each(function(z,C){r.replaceLine(g+C,z)})},setSyntax:function(g){this._syntax=i.hasSyntax(g)?g:"plain";this.syntaxChanged(g);this._reset()},setSyntaxFromFileExt:function(g){return this.setSyntax(i.syntaxForFileExt(g))}};t.SyntaxManager=j});bespin.tiki.register("::completion",{name:"completion",dependencies:{jquery:"0.0.0",ctags:"0.0.0",rangeutils:"0.0.0",canon:"0.0.0",underscore:"0.0.0"}});
bespin.tiki.module("completion:ui",function(x,t){function v(l){var h=n.uniqueId("bespin-completion-panel"),i=document.createElement("div");i.id=h;i.className="bespin-completion-panel";i.style.display="none";i.innerHTML='<div class="bespin-completion-pointer"></div><div class="bespin-completion-bubble-outer"><div class="bespin-completion-bubble-inner"><div class="bespin-completion-highlight"></div><ul></ul></div></div>';s(l).append(i);this.panel=s(i);this.parent=s(l)}var s=x("jquery").$,n=x("underscore")._,
j=n.template('<span class="bespin-completion-container"> &mdash; <%= container %></span>'),b=n.template('<div class="bespin-completion-second-row"><%= type %></div>'),e=n.template('<li><div class="bespin-completion-top-row"><span class="bespin-completion-kind bespin-completion-kind-<%= kind %>"><%= kind %></span><span class="bespin-completion-ident"><%= ident %></span><%= container %></div><%= second_row %></li>');v.prototype={_fromBottom:false,_index:0,_tags:null,_getHighlightDimensions:function(l){var h=
l.position(),i=l.outerHeight()-2;l=l.outerWidth()-2;return{left:h.left,top:h.top,height:i,width:l}},_listItemForIndex:function(l){return this.panel.find("li:eq("+l+")")},_populate:function(){var l=n(this._tags).map(function(h){var i=h["class"],g=h.module,q=h.namespace;i=i!=null?i:q!=null?q:"";if(g!=null)i=g+(i!=""?"#"+i:"");g=i==""?"":j({container:i});i=h.type;i=i==null?"":b({type:i});return e({kind:h.kind,ident:h.name,container:g,second_row:i})});this.panel.find("ul").html(l.join("\n"))},panel:null,
visible:false,getCompletion:function(){return this.visible?this._tags[this._index]:null},hide:function(){if(this.visible){this.panel.fadeOut(100);this.visible=false}},move:function(l){var h=this._index,i=this._listItemForIndex(h),g=l==="up"?i.prev():i.next();if(g.length!==0){this._index=h=l==="up"?h-1:h+1;h=s(i).find(".bespin-completion-top-row");var q=s(i).find(".bespin-completion-second-row");i=s(g).find(".bespin-completion-top-row");var r=s(g).find(".bespin-completion-second-row");q.hide();r.show();
var z=this.panel.find(".bespin-completion-highlight");z.stop(true,true);g=this._getHighlightDimensions(g);z.animate(g,100);r.hide();if(l==="down"){l=q.height();i.css("top",l);i.animate({top:0},100)}else{l=r.height();h.css("top",-l);h.animate({top:0},100)}r.fadeIn()}},show:function(l,h,i){this._tags=l=n(l).clone();this._populate();var g=this.visible,q=this.panel;q.stop(true,true);g||q.show();var r=this.parent.offset(),z=r.left,C=z+h.x,f=r.top+h.y;r=q.outerWidth();var K=q.outerHeight(),M=s(window).width(),
m=s(window).height();this._fromBottom=f=f+K+i>m;if(this._index>=l.length)this._index=l.length-1;if(f){f=q.find(".bespin-completion-pointer");f.removeClass("bespin-completion-pointer-up");f.addClass("bespin-completion-pointer-down");q.css({bottom:-h.y,top:""});this._tags.reverse();this._populate();if(!g)this._index=l.length-1}else{f=q.find(".bespin-completion-pointer");f.removeClass("bespin-completion-pointer-down");f.addClass("bespin-completion-pointer-up");q.css({top:h.y+i,bottom:""});if(!g)this._index=
0}if(!g){if(C+h.x+r>M){f.css({left:"",right:32});q.css("left",Math.min(M-r-z,h.x-r+43))}else{f.css({left:32,right:""});q.css("left",Math.max(z,h.x-43))}q.hide().animate({opacity:"show"},100)}l=q.find(".bespin-completion-highlight");l.stop(true,true);h=this._listItemForIndex(this._index);h.find(".bespin-completion-second-row").show();h=this._getHighlightDimensions(h);l.css(h);this.visible=true}};t.CompletionUI=v});
bespin.tiki.module("completion:controller",function(x,t){function v(h){this._editorView=h;h.selectionChanged.add(this._selectionChanged.bind(this));h.willChangeBuffer.add(this._willChangeBuffer.bind(this));this._syntaxChanged=this._syntaxChanged.bind(this);this.tags=new n.Tags;this.ui=new b(h.element)}function s(h){return function(){return l.editor.completionController[h](l)}}var n=x("ctags"),j=x("rangeutils:utils/range"),b=x("completion:ui").CompletionUI,e=x("bespin:plugins").catalog,l=x("environment").env;
v.prototype={_buffer:null,_completionEngine:null,_completions:null,_stem:null,_hideCompletions:function(){this.ui.hide()},_selectionChanged:function(h){var i=this._completionEngine;if(!(i==null||!j.isZeroLength(h))){var g=this._buffer.layoutManager,q=g.syntaxManager,r=h.start;h=r.col;r=g.textStorage.lines[r.row];g=r.substring(0,h);h=r.substring(h);i=i.getCompletions(g,h,q);if(i==null)this._hideCompletions();else{q=i.tags;this._stem=i.stem;this._showCompletions(q)}}},_showCompletions:function(h){var i=
this._editorView,g=i.textView.getInsertionPointPosition();g=i.convertTextViewPoint(g);this.ui.show(h,g,i.layoutManager.fontDimension.lineHeight)},_syntaxChanged:function(h){h=e.getExtensionByKey("completion",h);if(h==null)this._completionEngine=null;else h.load().then(function(i){this._completionEngine=new i(this.tags)}.bind(this))},_willChangeBuffer:function(h){var i=this._buffer;i!=null&&i.layoutManager.syntaxManager.syntaxChanged.remove(this._syntaxChanged);h.layoutManager.syntaxManager.syntaxChanged.add(this._syntaxChanged);
this._buffer=h},cancel:function(){this.ui.hide()},complete:function(h){var i=this.ui,g=i.getCompletion().name;h.view.insertText(g.substring(this._stem.length));i.hide()},isCompleting:function(){return this.ui.visible},moveDown:function(){this.ui.move("down")},moveUp:function(){this.ui.move("up")},tags:null};t.CompletionController=v;t.completeCommand=s("complete");t.completeCancelCommand=s("cancel");t.completeDownCommand=s("moveDown");t.completeUpCommand=s("moveUp")});
bespin.tiki.module("completion:index",function(){});bespin.tiki.register("::rangeutils",{name:"rangeutils",dependencies:{}});
bespin.tiki.module("rangeutils:utils/range",function(x,t){var v=x("bespin:util/util");t.addPositions=function(s,n){return{row:s.row+n.row,col:s.col+n.col}};t.cloneRange=function(s){var n=s.start;s=s.end;return{start:{row:n.row,col:n.col},end:{row:s.row,col:s.col}}};t.comparePositions=function(s,n){var j=s.row-n.row;return j===0?s.col-n.col:j};t.equal=function(s,n){return t.comparePositions(s.start,n.start)===0&&t.comparePositions(s.end,n.end)===0};t.extendRange=function(s,n){var j=s.end;return{start:s.start,
end:{row:j.row+n.row,col:j.col+n.col}}};t.intersectRangeSets=function(s,n){s=v.clone(s);n=v.clone(n);for(var j=[];s.length>0&&n.length>0;){var b=s.shift(),e=n.shift(),l=t.comparePositions(b.start,e.start),h=t.comparePositions(b.end,e.end);if(t.comparePositions(b.end,e.start)<0){j.push(b);n.unshift(e)}else if(t.comparePositions(e.end,b.start)<0){j.push(e);s.unshift(b)}else if(l<0){j.push({start:b.start,end:e.start});s.unshift({start:e.start,end:b.end});n.unshift(e)}else if(l===0)if(h<0)n.unshift({start:b.end,
end:e.end});else h>0&&s.unshift({start:e.end,end:b.end});else if(l>0){j.push({start:e.start,end:b.start});s.unshift(b);n.unshift({start:b.start,end:e.end})}}return j.concat(s,n)};t.isZeroLength=function(s){return s.start.row===s.end.row&&s.start.col===s.end.col};t.maxPosition=function(s,n){return t.comparePositions(s,n)>0?s:n};t.normalizeRange=function(s){return this.comparePositions(s.start,s.end)<0?s:{start:s.end,end:s.start}};t.rangeSetBoundaries=function(s){return{start:s[0].start,end:s[s.length-
1].end}};t.toString=function(s){var n=s.start;s=s.end;return"[ "+n.row+", "+n.col+" "+s.row+","+ +s.col+" ]"};t.unionRanges=function(s,n){return{start:s.start.row<n.start.row||s.start.row===n.start.row&&s.start.col<n.start.col?s.start:n.start,end:s.end.row>n.end.row||s.end.row===n.end.row&&s.end.col>n.end.col?s.end:n.end}};t.isPosition=function(s){return!v.none(s)&&!v.none(s.row)&&!v.none(s.col)};t.isRange=function(s){return!v.none(s)&&t.isPosition(s.start)&&t.isPosition(s.end)}});
bespin.tiki.module("rangeutils:index",function(){});bespin.tiki.register("::undomanager",{name:"undomanager",dependencies:{}});
bespin.tiki.module("undomanager:index",function(x,t){var v=x("bespin:util/util");x("environment");t.UndoManager=function(){};v.mixin(t.UndoManager.prototype,{_redoStack:[],_undoStack:[],_undoOrRedo:function(s,n,j){if(n.length===0)return false;n=n.pop();if(!n.target[s](n.context)){this._redoStack=[];this._undoStack=[];return false}j.push(n);return true},redo:function(){return this._undoOrRedo("redo",this._redoStack,this._undoStack)},registerUndo:function(s,n){this._redoStack=[];this._undoStack.push({target:s,
context:n})},undo:function(){return this._undoOrRedo("undo",this._undoStack,this._redoStack)}});t.global=new t.UndoManager;t.undoManagerCommand=function(s,n){t.global[n.commandExt.name]()}});bespin.tiki.register("::environment",{name:"environment",dependencies:{settings:"0.0.0"}});
bespin.tiki.module("environment:index",function(x,t){var v=x("bespin:util/util"),s=x("bespin:console").console,n=x("bespin:plugins").catalog,j=x("settings").settings;t.Environment=function(){this.commandLine=null;window.addEventListener("resize",this.dimensionsChanged.bind(this),false)};Object.defineProperties(t.Environment.prototype,{settings:{value:{set:function(b,e){if(v.none(b))throw new Error("setSetting(): key must be supplied");if(v.none(e))throw new Error("setSetting(): value must be supplied");
j.set(b,e)},get:function(b){if(v.none(b))throw new Error("getSetting(): key must be supplied");return j.get(b)}}},dimensionsChanged:{value:function(){n.publish(this,"dimensionsChanged")}},session:{get:function(){return n.getObject("session")}},view:{get:function(){if(!this.session)return null;return this.session.currentView}},editor:{get:function(){if(!this.session)return null;return this.session.currentView.editor}},contexts:{get:function(){if(!this.view)return[];var b=this.view.editor.layoutManager.syntaxManager,
e=this.view.getSelectedRange().start;return b.contextsAtPosition(e)}},buffer:{get:function(){if(this.session)return this.view.editor.buffer;else s.error("command attempted to get buffer but there's no session")}},model:{get:function(){if(this.buffer)return this.view.editor.layoutManager.textStorage;else s.error("Session has no current buffer")}},file:{get:function(){if(this.buffer)return this.buffer.file;else s.error("Session has no current buffer")}},files:{get:function(){return n.getObject("files")}}});
t.env=new t.Environment});bespin.tiki.register("::ctags",{name:"ctags",dependencies:{traits:"0.0.0",underscore:"0.0.0"}});
bespin.tiki.module("ctags:index",function(x,t){var v=x("underscore")._,s=x("./reader").TagReader;x=x("traits").Trait;t.Tags=function(){this.tags=[]};t.Tags.prototype=Object.create(Object.prototype,x.compose(x({_search:function(n,j){var b={name:n};n=this.tags;var e=v(n).sortedIndex(b,function(l){return l.name});for(e=b=e;b>=0&&b<n.length&&j(n[b]);)b--;for(;e>=0&&e<n.length&&j(n[e]);)e++;return n.slice(b+1,e)},add:function(n){var j=this.tags;Array.prototype.push.apply(j,n);j.sort(function(b,e){b=b.name;
e=e.name;if(b<e)return-1;if(b===e)return 0;return 1})},get:function(n){return this._search(n,function(j){return j.name===n})},scan:function(n,j,b){if(b===null||b===undefined)b={};var e=n.split("\n");n=parse(n,j,1);j=new Interpreter(n,j,e,b);j.interpret();this.add(j.tags)},stem:function(n){var j=n.length;return this._search(n,function(b){return b.name.substring(0,j)===n})}}),s))});
bespin.tiki.module("ctags:reader",function(x,t){var v=x("underscore")._;x=x("traits").Trait;t.TagReader=x({readLines:function(s){var n=[];v(s).each(function(j){j=j.split("\t");if(!(j.length<3)){var b=j[0];if(!/^!_TAG_/.test(b)){b={name:b,tagfile:j[1],addr:j[2]};var e;if(j.length>3&&j[3].indexOf(":")===-1){b.kind=j[3];e=4}else e=3;var l={};v(j.slice(e)).each(function(h){h=/^([^:]+):(.*)/.exec(h);l[h[1]]=h[2]});b.fields=l;n.push(b)}}});this.add(n)},readString:function(s){this.readLines(s.split("\n"))}})});
bespin.tiki.register("::theme_manager",{name:"theme_manager",dependencies:{theme_manager_base:"0.0.0",settings:"0.0.0",events:"0.0.0",less:"0.0.0"}});
bespin.tiki.module("theme_manager:index",function(x,t){x("bespin:promise");var v=x("bespin:plugins").catalog;x("events");var s=x("themestyles"),n=x("settings").settings,j=null,b=null;t.themestyles=s;t.themeSettingChanged=function(e,l,h){var i=v.getExtensionByKey("theme",h);if(h==="standard"||!h||!i){i=null;if(b!==null)i=v.getExtensionByKey("theme",b)}if(i)i.load().then(function(g){j&&s.unregisterThemeStyles(j);s.currentThemeVariables=g();j=i;s.parseGlobalVariables();s.reparse();i.url&&s.registerThemeStyles(i);
v.publish(t,"themeChange")});else if(j){s.unregisterThemeStyles(j);j=null;s.currentThemeVariables=null;s.parseGlobalVariables();s.reparse();v.publish(this,"themeChange")}};v.registerExtension("settingChange",{match:"theme",pointer:t.themeSettingChanged.bind(t)});t.setStandardTheme=function(e){b=e;e!==n.get("theme")&&t.themeSettingChanged(this)};t.setBasePlugin=function(e){s.basePluginName=e};t.startParsing=function(){s.preventParsing=false;return s.reparse()};t.registerTheme=function(e){var l=n.get("theme");
e.name===l&&t.themeSettingChanged(this,"theme",e.name)};t.unregisterTheme=function(e){e.name===n.get("theme")&&t.themeSettingChanged(this)};t.appLaunched=function(){v.publish(t,"themeChange")}});
bespin.tiki.module("theme_manager:themestyles",function(x,t){var v=x("bespin:util/util"),s=x("bespin:plugins").catalog,n=x("bespin:console").console,j=x("bespin:promise").Promise,b=x("bespin:promise").group,e=x("bespin:proxy"),l=new (x("less").Parser)({optimization:3}),h=1;t.currentThemeVariables=null;t.basePluginName=null;t.preventParsing=true;var i="";t.globalThemeVariables={};var g={},q={},r=function(w){var D={},H=[],R=function(W,$){H.push(W);if(typeof $!="object")D[H.join("_")]=$;else for(prop in $)R(prop,
$[prop]);H.pop()};R("global",w);return D},z={},C={font:"arial, lucida, helvetica, sans-serif",font_size:"14px",line_height:"1.8em",color:"#DAD4BA",text_shadow:"1px 1px rgba(0, 0, 0, 0.4)",error_color:"#F99",header_color:"white",link_color:"#ACF",control:{color:"#E1B41F",border:"1px solid rgba(0, 0, 0, 0.2)",border_radius:"0.25em",background:"rgba(0, 0, 0, 0.2)",active:{color:"#FF9600",border:"1px solid #E1B41F",inset_color:"#ff9600",background:"rgba(0, 0, 0, 0.2)"}},pane:{h1:{font:"'MuseoSans', Helvetica",
font_size:"2.8em",color:"white"},color:"#DAD4BA",text_shadow:"1px 1px rgba(0, 0, 0, 0.4)",link_color:"white",background:"#45443C",border_radius:".5em"},form:{color:"white",text_shadow:"1px 1px rgba(0, 0, 0, 0.4)",font:"'Lucida Sans','Lucida Grande',Verdana,Arial,sans-serif",font_size:"@global_font_size",line_height:"@global_line_height"},button:{color:"white",background:"#3E6CB9"},container:{background:"#1E1916",border:"1px solid black"},selectable:{color:"white",border:"0px solid transparent",background:"transparent",
active:{color:"black",border:"0px solid transparent",background:"#FF8E00"},hover:{color:"black",border:"0px solid transparent",background:"#FF8E00"}},hint:{color:"#AAA",active:{color:"black"},hover:{color:"black"}},accelerator:{color:"#996633",active:{color:"black"},hover:{color:"black"}},menu:{border_color:"black",inset_color_right:"#1E1916",inset_color_top_left:"#3E3936",background:"transparent"}};C=r(C);t.getPluginThemeVariables=function(w){var D=s.plugins[w];if(!D)return null;var H={};if(t.currentThemeVariables&&
t.currentThemeVariables[w])H=t.currentThemeVariables[w];D.provides.forEach(function(R){if(R.ep==="themevariable"){var W=R.name;H[W]=H[W]||R.defaultValue}});return H};t.parseGlobalVariables=function(){var w={},D="",H=t.currentThemeVariables;v.mixin(w,C);H&&H.global&&v.mixin(w,r(H.global));t.globalThemeVariables=w;for(prop in w)D+="@"+prop+":"+w[prop]+";";i=D};t.parseGlobalVariables();var f=function(w,D,H){if(g[D])styleElem=document.getElementById("_bespin_theme_style_"+g[D]);else{styleElem=document.createElement("style");
styleElem.setAttribute("id","_bespin_theme_style_"+h);g[D]=h;h++;document.body.appendChild(styleElem)}l.parse(i+H+q[D],function(R,W){if(R){R="Error less parsing "+D+" "+R.message;n.error(R);w.reject(R)}else{try{var $=W.toCSS()}catch(ea){R="Error less parsing "+D+" "+ea;n.error(R);w.reject(R);return}if(styleElem&&styleElem.firstChild)styleElem.firstChild.textContent=$;else{R=document.createTextNode($);styleElem.appendChild(R)}w.resolve()}})},K={};t.parsePlugin=function(w){if(t.preventParsing)return(new j).resolve();
var D=s.plugins[w];if(!D)throw"reparsePlugin: plugin "+w+" is not defined!";if(!K[w]){K[w]=new j;setTimeout(function(){var H=t.getPluginThemeVariables(w),R="";for(prop in H)R+="@"+prop+":"+H[prop]+";";H=new j;H.then(function(W){K[this.name].resolve(W);K[this.name]=null}.bind(this),function(){K[this.name].reject(data);K[this.name]=null}.bind(this));f(H,w,R)}.bind(D),0)}return K[w]};var M=function(w,D,H,R){H=H.replace(/url\(['"]*([^'")]*)(['"]*)\)/g,"url("+w+"$1)");q[D]+=H;R&&R.resolve()},m=null;t.registerThemeStyles=
function(w){var D=w.getPluginName(),H=s.getResourceURL(D);if(!(w.url instanceof Array))w.url=[w.url];q[D]="";var R=[],W=t.preventParsing;w.url.forEach(function($){if(z[D]&&z[D][$])M(H,D,z[D][$]);else{var ea=new j;R.push(ea);var Y=H+$+"?"+(new Date).getTime();e.xhr("GET",Y,true,function(da){da.overrideMimeType("text/plain")}).then(function(da){M(H,D,da,ea)},function(){n.error("registerLessFile: Could not load "+H+$);ea.resolve()})}});if(R.length===0)t.parsePlugin(D);else{W||b(R).then(function(){t.parsePlugin(D)});
if(m!==null)R=R.concat(m);m=b(R)}};t.reparse=function(){var w=new j;if(t.preventParsing)return w.resolve();m?m.then(function(){var D=[],H=t.basePluginName;H!==null&&q[H]&&D.push(t.parsePlugin(H));for(var R in q)R!==H&&D.push(t.parsePlugin(R));b(D).then(w.resolve.bind(w),w.reject.bind(w))},function(D){w.reject(D)}):w.resolve();return w};t.unregisterThemeStyles=function(w){w=w.getPluginName();if(g[w]){var D=document.getElementById("_bespin_theme_style_"+g[w]);D.parentNode.removeChild(D);delete g[w];
delete q[w]}}});bespin.tiki.register("::types",{name:"types",dependencies:{}});
bespin.tiki.module("types:basic",function(x,t){var v=x("bespin:plugins").catalog,s=x("bespin:console").console,n=x("bespin:promise").Promise;t.text={isValid:function(j){return typeof j=="string"},toString:function(j){return j},fromString:function(j){return j}};t.number={isValid:function(j){if(isNaN(j))return false;if(j===null)return false;if(j===undefined)return false;if(j===Infinity)return false;return typeof j=="number"},toString:function(j){if(!j)return null;return""+j},fromString:function(j){if(!j)return null;
var b=parseInt(j,10);if(isNaN(b))throw new Error("Can't convert \""+j+'" to a number.');return b}};t.bool={isValid:function(j){return typeof j=="boolean"},toString:function(j){return""+j},fromString:function(j){if(j===null)return null;if(!j.toLowerCase)return!!j;var b=j.toLowerCase();if(b=="true")return true;else if(b=="false")return false;return!!j}};t.object={isValid:function(j){return typeof j=="object"},toString:function(j){return JSON.stringify(j)},fromString:function(j){return JSON.parse(j)}};
t.selection={isValid:function(j,b){if(typeof j!="string")return false;if(!b.data){s.error("Missing data on selection type extension. Skipping");return true}var e=false;b.data.forEach(function(l){if(j==l)e=true});return e},toString:function(j){return j},fromString:function(j){return j},resolveTypeSpec:function(j,b){var e=new n;if(b.data){j.data=b.data;e.resolve()}else if(b.pointer)v.loadObjectForPropertyPath(b.pointer).then(function(l){l=l(b);if(typeof l.then==="function")l.then(function(h){j.data=
h;e.resolve()});else{j.data=l;e.resolve()}},function(l){e.reject(l)});else{s.warn("Missing data/pointer for selection",b);e.resolve()}return e}}});
bespin.tiki.module("types:types",function(x,t){function v(b){var e=new j,l=n.getExtensionByKey("type",b.name);l?e.resolve({ext:l,typeSpec:b}):e.reject(new Error("Unknown type: "+b.name));return e}function s(b){if(typeof b==="string")return v({name:b});if(typeof b==="object")if(b.name==="deferred"){var e=new j;t.undeferTypeSpec(b).then(function(l){s(l).then(function(h){e.resolve(h)},function(h){e.reject(h)})});return e}else return v(b);throw new Error("Unknown typeSpec type: "+typeof b);}var n=x("bespin:plugins").catalog;
x("bespin:console");var j=x("bespin:promise").Promise;t.getSimpleName=function(b){if(!b)throw new Error("null|undefined is not a valid typeSpec");if(typeof b=="string")return b;if(typeof b=="object"){if(!b.name)throw new Error("Missing name member to typeSpec");return b.name}throw new Error("Not a typeSpec: "+b);};t.equals=function(b,e){return t.getSimpleName(b)==t.getSimpleName(e)};t.undeferTypeSpec=function(b){var e=new j;if(!b.pointer){e.reject(new Error("Missing deferred pointer"));return e}n.loadObjectForPropertyPath(b.pointer).then(function(l){l=
l(b);typeof l.then==="function"?l.then(function(h){e.resolve(h)},function(h){e.reject(h)}):e.resolve(l)},function(l){e.reject(l)});return e};t.resolveType=function(b){var e=new j;s(b).then(function(l){l.ext.load(function(h){typeof h.resolveTypeSpec==="function"?h.resolveTypeSpec(l.ext,l.typeSpec).then(function(){e.resolve({type:h,ext:l.ext})},function(i){e.reject(i)}):e.resolve({type:h,ext:l.ext})})},function(l){e.reject(l)});return e};t.fromString=function(b,e){var l=new j;t.resolveType(e).then(function(h){l.resolve(h.type.fromString(b,
h.ext))});return l};t.toString=function(b,e){var l=new j;t.resolveType(e).then(function(h){l.resolve(h.type.toString(b,h.ext))});return l};t.isValid=function(b,e){var l=new j;t.resolveType(e).then(function(h){l.resolve(h.type.isValid(b,h.ext))});return l}});bespin.tiki.module("types:index",function(){});bespin.tiki.register("::jquery",{name:"jquery",dependencies:{}});
bespin.tiki.module("jquery:index",function(x,t){function v(){if(!f.isReady){try{m.documentElement.doScroll("left")}catch(a){setTimeout(v,1);return}f.ready()}}function s(a,d){d.src?f.ajax({url:d.src,async:false,dataType:"script"}):f.globalEval(d.text||d.textContent||d.innerHTML||"");d.parentNode&&d.parentNode.removeChild(d)}function n(a,d,k,p,o,A){var B=a.length;if(typeof d==="object"){for(var J in d)n(a,J,d[J],p,o,k);return a}if(k!==undefined){p=!A&&p&&f.isFunction(k);for(J=0;J<B;J++)o(a[J],d,p?k.call(a[J],
J,o(a[J],d)):k,A);return a}return B?o(a[0],d):undefined}function j(){return(new Date).getTime()}function b(){return false}function e(){return true}function l(a,d,k){k[0].type=a;return f.event.handle.apply(d,k)}function h(a){var d,k=[],p=[],o=arguments,A,B,J,E,I,Q;B=f.data(this,"events");if(!(a.liveFired===this||!B||!B.live||a.button&&a.type==="click")){a.liveFired=this;var V=B.live.slice(0);for(E=0;E<V.length;E++){B=V[E];B.origType.replace(ua,"")===a.type?p.push(B.selector):V.splice(E--,1)}A=f(a.target).closest(p,
a.currentTarget);I=0;for(Q=A.length;I<Q;I++)for(E=0;E<V.length;E++){B=V[E];if(A[I].selector===B.selector){J=A[I].elem;p=null;if(B.preType==="mouseenter"||B.preType==="mouseleave")p=f(a.relatedTarget).closest(B.selector)[0];if(!p||p!==J)k.push({elem:J,handleObj:B})}}I=0;for(Q=k.length;I<Q;I++){A=k[I];a.currentTarget=A.elem;a.data=A.handleObj.data;a.handleObj=A.handleObj;if(A.handleObj.origHandler.apply(A.elem,o)===false){d=false;break}}return d}}function i(a,d){return"live."+(a&&a!=="*"?a+".":"")+
d.replace(/\./g,"`").replace(/ /g,"&")}function g(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function q(a,d){var k=0;d.each(function(){if(this.nodeName===(a[k]&&a[k].nodeName)){var p=f.data(a[k++]),o=f.data(this,p);if(p=p&&p.events){delete o.handle;o.events={};for(var A in p)for(var B in p[A])f.event.add(this,A,p[A][B],p[A][B].data)}}})}function r(a,d,k){var p,o,A;d=d&&d[0]?d[0].ownerDocument||d[0]:m;if(a.length===1&&typeof a[0]==="string"&&a[0].length<512&&d===m&&!Ia.test(a[0])&&(f.support.checkClone||
!Ja.test(a[0]))){o=true;if(A=f.fragments[a[0]])if(A!==1)p=A}if(!p){p=d.createDocumentFragment();f.clean(a,d,p,k)}if(o)f.fragments[a[0]]=A?p:1;return{fragment:p,cacheable:o}}function z(a,d){var k={};f.each(Ka.concat.apply([],Ka.slice(0,d)),function(){k[this]=a});return k}function C(a){return"scrollTo"in a&&a.document?a:a.nodeType===9?a.defaultView||a.parentWindow:false}var f=function(a,d){return new f.fn.init(a,d)},K=window.jQuery,M=window.$,m=window.document,w,D=/^[^<]*(<[\w\W]+>)[^>]*$|^#([\w-]+)$/,
H=/^.[^:#\[\.,]*$/,R=/\S/,W=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,$=/^<(\w+)\s*\/?>(?:<\/\1>)?$/;x=navigator.userAgent;var ea=false,Y=[],da,ia=Object.prototype.toString,ma=Object.prototype.hasOwnProperty,na=Array.prototype.push,oa=Array.prototype.slice,ta=Array.prototype.indexOf;f.fn=f.prototype={init:function(a,d){var k,p;if(!a)return this;if(a.nodeType){this.context=this[0]=a;this.length=1;return this}if(a==="body"&&!d){this.context=m;this[0]=m.body;this.selector="body";this.length=1;return this}if(typeof a===
"string")if((k=D.exec(a))&&(k[1]||!d))if(k[1]){p=d?d.ownerDocument||d:m;if(a=$.exec(a))if(f.isPlainObject(d)){a=[m.createElement(a[1])];f.fn.attr.call(a,d,true)}else a=[p.createElement(a[1])];else{a=r([k[1]],[p]);a=(a.cacheable?a.fragment.cloneNode(true):a.fragment).childNodes}return f.merge(this,a)}else{if(d=m.getElementById(k[2])){if(d.id!==k[2])return w.find(a);this.length=1;this[0]=d}this.context=m;this.selector=a;return this}else if(!d&&/^\w+$/.test(a)){this.selector=a;this.context=m;a=m.getElementsByTagName(a);
return f.merge(this,a)}else return!d||d.jquery?(d||w).find(a):f(d).find(a);else if(f.isFunction(a))return w.ready(a);if(a.selector!==undefined){this.selector=a.selector;this.context=a.context}return f.makeArray(a,this)},selector:"",jquery:"1.4.2",length:0,size:function(){return this.length},toArray:function(){return oa.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this.slice(a)[0]:this[a]},pushStack:function(a,d,k){var p=f();f.isArray(a)?na.apply(p,a):f.merge(p,a);p.prevObject=this;
p.context=this.context;if(d==="find")p.selector=this.selector+(this.selector?" ":"")+k;else if(d)p.selector=this.selector+"."+d+"("+k+")";return p},each:function(a,d){return f.each(this,a,d)},ready:function(a){f.bindReady();if(f.isReady)a.call(m,f);else Y&&Y.push(a);return this},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(oa.apply(this,arguments),"slice",oa.call(arguments).join(","))},
map:function(a){return this.pushStack(f.map(this,function(d,k){return a.call(d,k,d)}))},end:function(){return this.prevObject||f(null)},push:na,sort:[].sort,splice:[].splice};f.fn.init.prototype=f.fn;f.extend=f.fn.extend=function(){var a=arguments[0]||{},d=1,k=arguments.length,p=false,o,A,B,J;if(typeof a==="boolean"){p=a;a=arguments[1]||{};d=2}if(typeof a!=="object"&&!f.isFunction(a))a={};if(k===d){a=this;--d}for(;d<k;d++)if((o=arguments[d])!=null)for(A in o){B=a[A];J=o[A];if(a!==J)if(p&&J&&(f.isPlainObject(J)||
f.isArray(J))){B=B&&(f.isPlainObject(B)||f.isArray(B))?B:f.isArray(J)?[]:{};a[A]=f.extend(p,B,J)}else if(J!==undefined)a[A]=J}return a};f.extend({noConflict:function(a){window.$=M;if(a)window.jQuery=K;return f},isReady:false,ready:function(){if(!f.isReady){if(!m.body)return setTimeout(f.ready,13);f.isReady=true;if(Y){for(var a,d=0;a=Y[d++];)a.call(m,f);Y=null}f.fn.triggerHandler&&f(m).triggerHandler("ready")}},bindReady:function(){if(!ea){ea=true;if(m.readyState==="complete")return f.ready();if(m.addEventListener){m.addEventListener("DOMContentLoaded",
da,false);window.addEventListener("load",f.ready,false)}else if(m.attachEvent){m.attachEvent("onreadystatechange",da);window.attachEvent("onload",f.ready);var a=false;try{a=window.frameElement==null}catch(d){}m.documentElement.doScroll&&a&&v()}}},isFunction:function(a){return ia.call(a)==="[object Function]"},isArray:function(a){return ia.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||ia.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!ma.call(a,
"constructor")&&!ma.call(a.constructor.prototype,"isPrototypeOf"))return false;var d;for(d in a);return d===undefined||ma.call(a,d)},isEmptyObject:function(a){for(var d in a)return false;return true},error:function(a){throw a;},parseJSON:function(a){if(typeof a!=="string"||!a)return null;a=f.trim(a);if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return window.JSON&&
window.JSON.parse?window.JSON.parse(a):(new Function("return "+a))();else f.error("Invalid JSON: "+a)},noop:function(){},globalEval:function(a){if(a&&R.test(a)){var d=m.getElementsByTagName("head")[0]||m.documentElement,k=m.createElement("script");k.type="text/javascript";if(f.support.scriptEval)k.appendChild(m.createTextNode(a));else k.text=a;d.insertBefore(k,d.firstChild);d.removeChild(k)}},nodeName:function(a,d){return a.nodeName&&a.nodeName.toUpperCase()===d.toUpperCase()},each:function(a,d,k){var p,
o=0,A=a.length,B=A===undefined||f.isFunction(a);if(k)if(B)for(p in a){if(d.apply(a[p],k)===false)break}else for(;o<A;){if(d.apply(a[o++],k)===false)break}else if(B)for(p in a){if(d.call(a[p],p,a[p])===false)break}else for(k=a[0];o<A&&d.call(k,o,k)!==false;k=a[++o]);return a},trim:function(a){return(a||"").replace(W,"")},makeArray:function(a,d){d=d||[];if(a!=null)a.length==null||typeof a==="string"||f.isFunction(a)||typeof a!=="function"&&a.setInterval?na.call(d,a):f.merge(d,a);return d},inArray:function(a,
d){if(d.indexOf)return d.indexOf(a);for(var k=0,p=d.length;k<p;k++)if(d[k]===a)return k;return-1},merge:function(a,d){var k=a.length,p=0;if(typeof d.length==="number")for(var o=d.length;p<o;p++)a[k++]=d[p];else for(;d[p]!==undefined;)a[k++]=d[p++];a.length=k;return a},grep:function(a,d,k){for(var p=[],o=0,A=a.length;o<A;o++)!k!==!d(a[o],o)&&p.push(a[o]);return p},map:function(a,d,k){for(var p=[],o,A=0,B=a.length;A<B;A++){o=d(a[A],A,k);if(o!=null)p[p.length]=o}return p.concat.apply([],p)},guid:1,proxy:function(a,
d,k){if(arguments.length===2)if(typeof d==="string"){k=a;a=k[d];d=undefined}else if(d&&!f.isFunction(d)){k=d;d=undefined}if(!d&&a)d=function(){return a.apply(k||this,arguments)};if(a)d.guid=a.guid=a.guid||d.guid||f.guid++;return d},uaMatch:function(a){a=a.toLowerCase();a=/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version)?[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||!/compatible/.test(a)&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(a)||[];return{browser:a[1]||"",version:a[2]||"0"}},browser:{}});
x=f.uaMatch(x);if(x.browser){f.browser[x.browser]=true;f.browser.version=x.version}if(f.browser.webkit)f.browser.safari=true;if(ta)f.inArray=function(a,d){return ta.call(d,a)};w=f(m);if(m.addEventListener)da=function(){m.removeEventListener("DOMContentLoaded",da,false);f.ready()};else if(m.attachEvent)da=function(){if(m.readyState==="complete"){m.detachEvent("onreadystatechange",da);f.ready()}};(function(){f.support={};var a=m.documentElement,d=m.createElement("script"),k=m.createElement("div"),p=
"script"+j();k.style.display="none";k.innerHTML="   <link/><table></table><a href='/a' style='color:red;float:left;opacity:.55;'>a</a><input type='checkbox'/>";var o=k.getElementsByTagName("*"),A=k.getElementsByTagName("a")[0];if(!(!o||!o.length||!A)){f.support={leadingWhitespace:k.firstChild.nodeType===3,tbody:!k.getElementsByTagName("tbody").length,htmlSerialize:!!k.getElementsByTagName("link").length,style:/red/.test(A.getAttribute("style")),hrefNormalized:A.getAttribute("href")==="/a",opacity:/^0.55$/.test(A.style.opacity),
cssFloat:!!A.style.cssFloat,checkOn:k.getElementsByTagName("input")[0].value==="on",optSelected:m.createElement("select").appendChild(m.createElement("option")).selected,parentNode:k.removeChild(k.appendChild(m.createElement("div"))).parentNode===null,deleteExpando:true,checkClone:false,scriptEval:false,noCloneEvent:true,boxModel:null};d.type="text/javascript";try{d.appendChild(m.createTextNode("window."+p+"=1;"))}catch(B){}a.insertBefore(d,a.firstChild);if(window[p]){f.support.scriptEval=true;delete window[p]}try{delete d.test}catch(J){f.support.deleteExpando=
false}a.removeChild(d);if(k.attachEvent&&k.fireEvent){k.attachEvent("onclick",function E(){f.support.noCloneEvent=false;k.detachEvent("onclick",E)});k.cloneNode(true).fireEvent("onclick")}k=m.createElement("div");k.innerHTML="<input type='radio' name='radiotest' checked='checked'/>";a=m.createDocumentFragment();a.appendChild(k.firstChild);f.support.checkClone=a.cloneNode(true).cloneNode(true).lastChild.checked;f(function(){var E=m.createElement("div");E.style.width=E.style.paddingLeft="1px";m.body.appendChild(E);
f.boxModel=f.support.boxModel=E.offsetWidth===2;m.body.removeChild(E).style.display="none"});a=function(E){var I=m.createElement("div");E="on"+E;var Q=E in I;if(!Q){I.setAttribute(E,"return;");Q=typeof I[E]==="function"}return Q};f.support.submitBubbles=a("submit");f.support.changeBubbles=a("change");a=d=k=o=A=null}})();f.props={"for":"htmlFor","class":"className",readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",colspan:"colSpan",tabindex:"tabIndex",usemap:"useMap",
frameborder:"frameBorder"};var L="jQuery"+j(),P=0,S={};f.extend({cache:{},expando:L,noData:{embed:true,object:true,applet:true},data:function(a,d,k){if(!(a.nodeName&&f.noData[a.nodeName.toLowerCase()])){a=a==window?S:a;var p=a[L],o=f.cache;if(!p&&typeof d==="string"&&k===undefined)return null;p||(p=++P);if(typeof d==="object"){a[L]=p;o[p]=f.extend(true,{},d)}else if(!o[p]){a[L]=p;o[p]={}}a=o[p];if(k!==undefined)a[d]=k;return typeof d==="string"?a[d]:a}},removeData:function(a,d){if(!(a.nodeName&&f.noData[a.nodeName.toLowerCase()])){a=
a==window?S:a;var k=a[L],p=f.cache,o=p[k];if(d){if(o){delete o[d];f.isEmptyObject(o)&&f.removeData(a)}}else{if(f.support.deleteExpando)delete a[f.expando];else a.removeAttribute&&a.removeAttribute(f.expando);delete p[k]}}}});f.fn.extend({data:function(a,d){if(typeof a==="undefined"&&this.length)return f.data(this[0]);else if(typeof a==="object")return this.each(function(){f.data(this,a)});var k=a.split(".");k[1]=k[1]?"."+k[1]:"";if(d===undefined){var p=this.triggerHandler("getData"+k[1]+"!",[k[0]]);
if(p===undefined&&this.length)p=f.data(this[0],a);return p===undefined&&k[1]?this.data(k[0]):p}else return this.trigger("setData"+k[1]+"!",[k[0],d]).each(function(){f.data(this,a,d)})},removeData:function(a){return this.each(function(){f.removeData(this,a)})}});f.extend({queue:function(a,d,k){if(a){d=(d||"fx")+"queue";var p=f.data(a,d);if(!k)return p||[];if(!p||f.isArray(k))p=f.data(a,d,f.makeArray(k));else p.push(k);return p}},dequeue:function(a,d){d=d||"fx";var k=f.queue(a,d),p=k.shift();if(p===
"inprogress")p=k.shift();if(p){d==="fx"&&k.unshift("inprogress");p.call(a,function(){f.dequeue(a,d)})}}});f.fn.extend({queue:function(a,d){if(typeof a!=="string"){d=a;a="fx"}if(d===undefined)return f.queue(this[0],a);return this.each(function(){var k=f.queue(this,a,d);a==="fx"&&k[0]!=="inprogress"&&f.dequeue(this,a)})},dequeue:function(a){return this.each(function(){f.dequeue(this,a)})},delay:function(a,d){a=f.fx?f.fx.speeds[a]||a:a;d=d||"fx";return this.queue(d,function(){var k=this;setTimeout(function(){f.dequeue(k,
d)},a)})},clearQueue:function(a){return this.queue(a||"fx",[])}});var T=/[\n\t]/g,aa=/\s+/,ha=/\r/g,$a=/href|src|style/,ab=/(button|input)/i,bb=/(button|input|object|select|textarea)/i,cb=/^(a|area)$/i,La=/radio|checkbox/;f.fn.extend({attr:function(a,d){return n(this,a,d,true,f.attr)},removeAttr:function(a){return this.each(function(){f.attr(this,a,"");this.nodeType===1&&this.removeAttribute(a)})},addClass:function(a){if(f.isFunction(a))return this.each(function(I){var Q=f(this);Q.addClass(a.call(this,
I,Q.attr("class")))});if(a&&typeof a==="string")for(var d=(a||"").split(aa),k=0,p=this.length;k<p;k++){var o=this[k];if(o.nodeType===1)if(o.className){for(var A=" "+o.className+" ",B=o.className,J=0,E=d.length;J<E;J++)if(A.indexOf(" "+d[J]+" ")<0)B+=" "+d[J];o.className=f.trim(B)}else o.className=a}return this},removeClass:function(a){if(f.isFunction(a))return this.each(function(E){var I=f(this);I.removeClass(a.call(this,E,I.attr("class")))});if(a&&typeof a==="string"||a===undefined)for(var d=(a||
"").split(aa),k=0,p=this.length;k<p;k++){var o=this[k];if(o.nodeType===1&&o.className)if(a){for(var A=(" "+o.className+" ").replace(T," "),B=0,J=d.length;B<J;B++)A=A.replace(" "+d[B]+" "," ");o.className=f.trim(A)}else o.className=""}return this},toggleClass:function(a,d){var k=typeof a,p=typeof d==="boolean";if(f.isFunction(a))return this.each(function(o){var A=f(this);A.toggleClass(a.call(this,o,A.attr("class"),d),d)});return this.each(function(){if(k==="string")for(var o,A=0,B=f(this),J=d,E=a.split(aa);o=
E[A++];){J=p?J:!B.hasClass(o);B[J?"addClass":"removeClass"](o)}else if(k==="undefined"||k==="boolean"){this.className&&f.data(this,"__className__",this.className);this.className=this.className||a===false?"":f.data(this,"__className__")||""}})},hasClass:function(a){a=" "+a+" ";for(var d=0,k=this.length;d<k;d++)if((" "+this[d].className+" ").replace(T," ").indexOf(a)>-1)return true;return false},val:function(a){if(a===undefined){var d=this[0];if(d){if(f.nodeName(d,"option"))return(d.attributes.value||
{}).specified?d.value:d.text;if(f.nodeName(d,"select")){var k=d.selectedIndex,p=[],o=d.options;d=d.type==="select-one";if(k<0)return null;var A=d?k:0;for(k=d?k+1:o.length;A<k;A++){var B=o[A];if(B.selected){a=f(B).val();if(d)return a;p.push(a)}}return p}if(La.test(d.type)&&!f.support.checkOn)return d.getAttribute("value")===null?"on":d.value;return(d.value||"").replace(ha,"")}}else{var J=f.isFunction(a);return this.each(function(E){var I=f(this),Q=a;if(this.nodeType===1){if(J)Q=a.call(this,E,I.val());
if(typeof Q==="number")Q+="";if(f.isArray(Q)&&La.test(this.type))this.checked=f.inArray(I.val(),Q)>=0;else if(f.nodeName(this,"select")){var V=f.makeArray(Q);f("option",this).each(function(){this.selected=f.inArray(f(this).val(),V)>=0});if(!V.length)this.selectedIndex=-1}else this.value=Q}})}}});f.extend({attrFn:{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true},attr:function(a,d,k,p){if(!(!a||a.nodeType===3||a.nodeType===8)){if(p&&d in f.attrFn)return f(a)[d](k);
p=a.nodeType!==1||!f.isXMLDoc(a);var o=k!==undefined;d=p&&f.props[d]||d;if(a.nodeType===1){var A=$a.test(d);if(d in a&&p&&!A){if(o){d==="type"&&ab.test(a.nodeName)&&a.parentNode&&f.error("type property can't be changed");a[d]=k}if(f.nodeName(a,"form")&&a.getAttributeNode(d))return a.getAttributeNode(d).nodeValue;if(d==="tabIndex")return(d=a.getAttributeNode("tabIndex"))&&d.specified?d.value:bb.test(a.nodeName)||cb.test(a.nodeName)&&a.href?0:undefined;return a[d]}if(!f.support.style&&p&&d==="style"){if(o)a.style.cssText=
""+k;return a.style.cssText}o&&a.setAttribute(d,""+k);a=!f.support.hrefNormalized&&p&&A?a.getAttribute(d,2):a.getAttribute(d);return a===null?undefined:a}return f.style(a,d,k)}}});var ua=/\.(.*)$/,db=function(a){return a.replace(/[^\w\s\.\|`]/g,function(d){return"\\"+d})};f.event={add:function(a,d,k,p){if(!(a.nodeType===3||a.nodeType===8)){if(a.setInterval&&a!==window&&!a.frameElement)a=window;var o,A;if(k.handler){o=k;k=o.handler}if(!k.guid)k.guid=f.guid++;if(A=f.data(a)){var B=A.events=A.events||
{},J=A.handle;if(!J)A.handle=J=function(){return typeof f!=="undefined"&&!f.event.triggered?f.event.handle.apply(J.elem,arguments):undefined};J.elem=a;d=d.split(" ");for(var E,I=0,Q;E=d[I++];){A=o?f.extend({},o):{handler:k,data:p};if(E.indexOf(".")>-1){Q=E.split(".");E=Q.shift();A.namespace=Q.slice(0).sort().join(".")}else{Q=[];A.namespace=""}A.type=E;A.guid=k.guid;var V=B[E],ca=f.event.special[E]||{};if(!V){V=B[E]=[];if(!ca.setup||ca.setup.call(a,p,Q,J)===false)if(a.addEventListener)a.addEventListener(E,
J,false);else a.attachEvent&&a.attachEvent("on"+E,J)}if(ca.add){ca.add.call(a,A);if(!A.handler.guid)A.handler.guid=k.guid}V.push(A);f.event.global[E]=true}a=null}}},global:{},remove:function(a,d,k,p){if(!(a.nodeType===3||a.nodeType===8)){var o,A=0,B,J,E,I,Q,V,ca=f.data(a),ga=ca&&ca.events;if(ca&&ga){if(d&&d.type){k=d.handler;d=d.type}if(!d||typeof d==="string"&&d.charAt(0)==="."){d=d||"";for(o in ga)f.event.remove(a,o+d)}else{for(d=d.split(" ");o=d[A++];){I=o;B=o.indexOf(".")<0;J=[];if(!B){J=o.split(".");
o=J.shift();E=new RegExp("(^|\\.)"+f.map(J.slice(0).sort(),db).join("\\.(?:.*\\.)?")+"(\\.|$)")}if(Q=ga[o])if(k){I=f.event.special[o]||{};for(fa=p||0;fa<Q.length;fa++){V=Q[fa];if(k.guid===V.guid){if(B||E.test(V.namespace)){p==null&&Q.splice(fa--,1);I.remove&&I.remove.call(a,V)}if(p!=null)break}}if(Q.length===0||p!=null&&Q.length===1){if(!I.teardown||I.teardown.call(a,J)===false)Ma(a,o,ca.handle);delete ga[o]}}else for(var fa=0;fa<Q.length;fa++){V=Q[fa];if(B||E.test(V.namespace)){f.event.remove(a,
I,V.handler,fa);Q.splice(fa--,1)}}}if(f.isEmptyObject(ga)){if(d=ca.handle)d.elem=null;delete ca.events;delete ca.handle;f.isEmptyObject(ca)&&f.removeData(a)}}}}},trigger:function(a,d,k,p){var o=a.type||a;if(!p){a=typeof a==="object"?a[L]?a:f.extend(f.Event(o),a):f.Event(o);if(o.indexOf("!")>=0){a.type=o=o.slice(0,-1);a.exclusive=true}if(!k){a.stopPropagation();f.event.global[o]&&f.each(f.cache,function(){this.events&&this.events[o]&&f.event.trigger(a,d,this.handle.elem)})}if(!k||k.nodeType===3||k.nodeType===
8)return;a.result=undefined;a.target=k;d=f.makeArray(d);d.unshift(a)}a.currentTarget=k;(p=f.data(k,"handle"))&&p.apply(k,d);p=k.parentNode||k.ownerDocument;try{if(!(k&&k.nodeName&&f.noData[k.nodeName.toLowerCase()]))if(k["on"+o]&&k["on"+o].apply(k,d)===false)a.result=false}catch(A){}if(!a.isPropagationStopped()&&p)f.event.trigger(a,d,p,true);else if(!a.isDefaultPrevented()){p=a.target;var B,J=f.nodeName(p,"a")&&o==="click",E=f.event.special[o]||{};if((!E._default||E._default.call(k,a)===false)&&!J&&
!(p&&p.nodeName&&f.noData[p.nodeName.toLowerCase()])){try{if(p[o]){if(B=p["on"+o])p["on"+o]=null;f.event.triggered=true;p[o]()}}catch(I){}if(B)p["on"+o]=B;f.event.triggered=false}}},handle:function(a){var d,k,p,o;a=arguments[0]=f.event.fix(a||window.event);a.currentTarget=this;d=a.type.indexOf(".")<0&&!a.exclusive;if(!d){k=a.type.split(".");a.type=k.shift();p=new RegExp("(^|\\.)"+k.slice(0).sort().join("\\.(?:.*\\.)?")+"(\\.|$)")}o=f.data(this,"events");k=o[a.type];if(o&&k){k=k.slice(0);o=0;for(var A=
k.length;o<A;o++){var B=k[o];if(d||p.test(B.namespace)){a.handler=B.handler;a.data=B.data;a.handleObj=B;B=B.handler.apply(this,arguments);if(B!==undefined){a.result=B;if(B===false){a.preventDefault();a.stopPropagation()}}if(a.isImmediatePropagationStopped())break}}}return a.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),
fix:function(a){if(a[L])return a;var d=a;a=f.Event(d);for(var k=this.props.length,p;k;){p=this.props[--k];a[p]=d[p]}if(!a.target)a.target=a.srcElement||m;if(a.target.nodeType===3)a.target=a.target.parentNode;if(!a.relatedTarget&&a.fromElement)a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement;if(a.pageX==null&&a.clientX!=null){d=m.documentElement;k=m.body;a.pageX=a.clientX+(d&&d.scrollLeft||k&&k.scrollLeft||0)-(d&&d.clientLeft||k&&k.clientLeft||0);a.pageY=a.clientY+(d&&d.scrollTop||
k&&k.scrollTop||0)-(d&&d.clientTop||k&&k.clientTop||0)}if(!a.which&&(a.charCode||a.charCode===0?a.charCode:a.keyCode))a.which=a.charCode||a.keyCode;if(!a.metaKey&&a.ctrlKey)a.metaKey=a.ctrlKey;if(!a.which&&a.button!==undefined)a.which=a.button&1?1:a.button&2?3:a.button&4?2:0;return a},guid:1E8,proxy:f.proxy,special:{ready:{setup:f.bindReady,teardown:f.noop},live:{add:function(a){f.event.add(this,a.origType,f.extend({},a,{handler:h}))},remove:function(a){var d=true,k=a.origType.replace(ua,"");f.each(f.data(this,
"events").live||[],function(){if(k===this.origType.replace(ua,""))return d=false});d&&f.event.remove(this,a.origType,h)}},beforeunload:{setup:function(a,d,k){if(this.setInterval)this.onbeforeunload=k;return false},teardown:function(a,d){if(this.onbeforeunload===d)this.onbeforeunload=null}}}};var Ma=m.removeEventListener?function(a,d,k){a.removeEventListener(d,k,false)}:function(a,d,k){a.detachEvent("on"+d,k)};f.Event=function(a){if(!this.preventDefault)return new f.Event(a);if(a&&a.type){this.originalEvent=
a;this.type=a.type}else this.type=a;this.timeStamp=j();this[L]=true};f.Event.prototype={preventDefault:function(){this.isDefaultPrevented=e;var a=this.originalEvent;if(a){a.preventDefault&&a.preventDefault();a.returnValue=false}},stopPropagation:function(){this.isPropagationStopped=e;var a=this.originalEvent;if(a){a.stopPropagation&&a.stopPropagation();a.cancelBubble=true}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=e;this.stopPropagation()},isDefaultPrevented:b,isPropagationStopped:b,
isImmediatePropagationStopped:b};var Na=function(a){var d=a.relatedTarget;try{for(;d&&d!==this;)d=d.parentNode;if(d!==this){a.type=a.data;f.event.handle.apply(this,arguments)}}catch(k){}},Oa=function(a){a.type=a.data;f.event.handle.apply(this,arguments)};f.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,d){f.event.special[a]={setup:function(k){f.event.add(this,d,k&&k.selector?Oa:Na,a)},teardown:function(k){f.event.remove(this,d,k&&k.selector?Oa:Na)}}});if(!f.support.submitBubbles)f.event.special.submit=
{setup:function(){if(this.nodeName.toLowerCase()!=="form"){f.event.add(this,"click.specialSubmit",function(a){var d=a.target,k=d.type;if((k==="submit"||k==="image")&&f(d).closest("form").length)return l("submit",this,arguments)});f.event.add(this,"keypress.specialSubmit",function(a){var d=a.target,k=d.type;if((k==="text"||k==="password")&&f(d).closest("form").length&&a.keyCode===13)return l("submit",this,arguments)})}else return false},teardown:function(){f.event.remove(this,".specialSubmit")}};if(!f.support.changeBubbles){var za=
/textarea|input|select/i,Aa,Pa=function(a){var d=a.type,k=a.value;if(d==="radio"||d==="checkbox")k=a.checked;else if(d==="select-multiple")k=a.selectedIndex>-1?f.map(a.options,function(p){return p.selected}).join("-"):"";else if(a.nodeName.toLowerCase()==="select")k=a.selectedIndex;return k},Ba=function(a,d){var k=a.target,p,o;if(!(!za.test(k.nodeName)||k.readOnly)){p=f.data(k,"_change_data");o=Pa(k);if(a.type!=="focusout"||k.type!=="radio")f.data(k,"_change_data",o);if(!(p===undefined||o===p))if(p!=
null||o){a.type="change";return f.event.trigger(a,d,k)}}};f.event.special.change={filters:{focusout:Ba,click:function(a){var d=a.target,k=d.type;if(k==="radio"||k==="checkbox"||d.nodeName.toLowerCase()==="select")return Ba.call(this,a)},keydown:function(a){var d=a.target,k=d.type;if(a.keyCode===13&&d.nodeName.toLowerCase()!=="textarea"||a.keyCode===32&&(k==="checkbox"||k==="radio")||k==="select-multiple")return Ba.call(this,a)},beforeactivate:function(a){a=a.target;f.data(a,"_change_data",Pa(a))}},
setup:function(){if(this.type==="file")return false;for(var a in Aa)f.event.add(this,a+".specialChange",Aa[a]);return za.test(this.nodeName)},teardown:function(){f.event.remove(this,".specialChange");return za.test(this.nodeName)}};Aa=f.event.special.change.filters}m.addEventListener&&f.each({focus:"focusin",blur:"focusout"},function(a,d){function k(p){p=f.event.fix(p);p.type=d;return f.event.handle.call(this,p)}f.event.special[d]={setup:function(){this.addEventListener(a,k,true)},teardown:function(){this.removeEventListener(a,
k,true)}}});f.each(["bind","one"],function(a,d){f.fn[d]=function(k,p,o){if(typeof k==="object"){for(var A in k)this[d](A,p,k[A],o);return this}if(f.isFunction(p)){o=p;p=undefined}var B=d==="one"?f.proxy(o,function(E){f(this).unbind(E,B);return o.apply(this,arguments)}):o;if(k==="unload"&&d!=="one")this.one(k,p,o);else{A=0;for(var J=this.length;A<J;A++)f.event.add(this[A],k,B,p)}return this}});f.fn.extend({unbind:function(a,d){if(typeof a==="object"&&!a.preventDefault)for(var k in a)this.unbind(k,
a[k]);else{k=0;for(var p=this.length;k<p;k++)f.event.remove(this[k],a,d)}return this},delegate:function(a,d,k,p){return this.live(d,k,p,a)},undelegate:function(a,d,k){return arguments.length===0?this.unbind("live"):this.die(d,null,k,a)},trigger:function(a,d){return this.each(function(){f.event.trigger(a,d,this)})},triggerHandler:function(a,d){if(this[0]){a=f.Event(a);a.preventDefault();a.stopPropagation();f.event.trigger(a,d,this[0]);return a.result}},toggle:function(a){for(var d=arguments,k=1;k<
d.length;)f.proxy(a,d[k++]);return this.click(f.proxy(a,function(p){var o=(f.data(this,"lastToggle"+a.guid)||0)%k;f.data(this,"lastToggle"+a.guid,o+1);p.preventDefault();return d[o].apply(this,arguments)||false}))},hover:function(a,d){return this.mouseenter(a).mouseleave(d||a)}});var Qa={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};f.each(["live","die"],function(a,d){f.fn[d]=function(k,p,o,A){var B,J=0,E,I,Q=A||this.selector,V=A?this:f(this.context);if(f.isFunction(p)){o=
p;p=undefined}for(k=(k||"").split(" ");(B=k[J++])!=null;){A=ua.exec(B);E="";if(A){E=A[0];B=B.replace(ua,"")}if(B==="hover")k.push("mouseenter"+E,"mouseleave"+E);else{I=B;if(B==="focus"||B==="blur"){k.push(Qa[B]+E);B+=E}else B=(Qa[B]||B)+E;d==="live"?V.each(function(){f.event.add(this,i(B,Q),{data:p,selector:Q,handler:o,origType:B,origHandler:o,preType:I})}):V.unbind(i(B,Q),o)}}return this}});f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" "),
function(a,d){f.fn[d]=function(k){return k?this.bind(d,k):this.trigger(d)};if(f.attrFn)f.attrFn[d]=true});window.attachEvent&&!window.addEventListener&&window.attachEvent("onunload",function(){for(var a in f.cache)if(f.cache[a].handle)try{f.event.remove(f.cache[a].handle.elem)}catch(d){}});(function(){function a(u){for(var y="",F,G=0;u[G];G++){F=u[G];if(F.nodeType===3||F.nodeType===4)y+=F.nodeValue;else if(F.nodeType!==8)y+=a(F.childNodes)}return y}function d(u,y,F,G,O,N){O=0;for(var X=G.length;O<
X;O++){var U=G[O];if(U){U=U[u];for(var ba=false;U;){if(U.sizcache===F){ba=G[U.sizset];break}if(U.nodeType===1&&!N){U.sizcache=F;U.sizset=O}if(U.nodeName.toLowerCase()===y){ba=U;break}U=U[u]}G[O]=ba}}}function k(u,y,F,G,O,N){O=0;for(var X=G.length;O<X;O++){var U=G[O];if(U){U=U[u];for(var ba=false;U;){if(U.sizcache===F){ba=G[U.sizset];break}if(U.nodeType===1){if(!N){U.sizcache=F;U.sizset=O}if(typeof y!=="string"){if(U===y){ba=true;break}}else if(E.filter(y,[U]).length>0){ba=U;break}}U=U[u]}G[O]=ba}}}
var p=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,o=0,A=Object.prototype.toString,B=false,J=true;[0,0].sort(function(){J=false;return 0});var E=function(u,y,F,G){F=F||[];var O=y=y||m;if(y.nodeType!==1&&y.nodeType!==9)return[];if(!u||typeof u!=="string")return F;for(var N=[],X,U,ba,va,pa=true,ra=Z(y),qa=u;(p.exec(""),X=p.exec(qa))!==null;){qa=X[3];N.push(X[1]);if(X[2]){va=X[3];break}}if(N.length>1&&Q.exec(u))if(N.length===
2&&I.relative[N[0]])U=Ca(N[0]+N[1],y);else for(U=I.relative[N[0]]?[y]:E(N.shift(),y);N.length;){u=N.shift();if(I.relative[u])u+=N.shift();U=Ca(u,U)}else{if(!G&&N.length>1&&y.nodeType===9&&!ra&&I.match.ID.test(N[0])&&!I.match.ID.test(N[N.length-1])){X=E.find(N.shift(),y,ra);y=X.expr?E.filter(X.expr,X.set)[0]:X.set[0]}if(y){X=G?{expr:N.pop(),set:ca(G)}:E.find(N.pop(),N.length===1&&(N[0]==="~"||N[0]==="+")&&y.parentNode?y.parentNode:y,ra);U=X.expr?E.filter(X.expr,X.set):X.set;if(N.length>0)ba=ca(U);
else pa=false;for(;N.length;){var ja=N.pop();X=ja;if(I.relative[ja])X=N.pop();else ja="";if(X==null)X=y;I.relative[ja](ba,X,ra)}}else ba=[]}ba||(ba=U);ba||E.error(ja||u);if(A.call(ba)==="[object Array]")if(pa)if(y&&y.nodeType===1)for(u=0;ba[u]!=null;u++){if(ba[u]&&(ba[u]===true||ba[u].nodeType===1&&ka(y,ba[u])))F.push(U[u])}else for(u=0;ba[u]!=null;u++)ba[u]&&ba[u].nodeType===1&&F.push(U[u]);else F.push.apply(F,ba);else ca(ba,F);if(va){E(va,O,F,G);E.uniqueSort(F)}return F};E.uniqueSort=function(u){if(fa){B=
J;u.sort(fa);if(B)for(var y=1;y<u.length;y++)u[y]===u[y-1]&&u.splice(y--,1)}return u};E.matches=function(u,y){return E(u,null,null,y)};E.find=function(u,y,F){var G,O;if(!u)return[];for(var N=0,X=I.order.length;N<X;N++){var U=I.order[N];if(O=I.leftMatch[U].exec(u)){var ba=O[1];O.splice(1,1);if(ba.substr(ba.length-1)!=="\\"){O[1]=(O[1]||"").replace(/\\/g,"");G=I.find[U](O,y,F);if(G!=null){u=u.replace(I.match[U],"");break}}}}G||(G=y.getElementsByTagName("*"));return{set:G,expr:u}};E.filter=function(u,
y,F,G){for(var O=u,N=[],X=y,U,ba,va=y&&y[0]&&Z(y[0]);u&&y.length;){for(var pa in I.filter)if((U=I.leftMatch[pa].exec(u))!=null&&U[2]){var ra=I.filter[pa],qa,ja;ja=U[1];ba=false;U.splice(1,1);if(ja.substr(ja.length-1)!=="\\"){if(X===N)N=[];if(I.preFilter[pa])if(U=I.preFilter[pa](U,X,F,N,G,va)){if(U===true)continue}else ba=qa=true;if(U)for(var wa=0;(ja=X[wa])!=null;wa++)if(ja){qa=ra(ja,U,wa,X);var Ra=G^!!qa;if(F&&qa!=null)if(Ra)ba=true;else X[wa]=false;else if(Ra){N.push(ja);ba=true}}if(qa!==undefined){F||
(X=N);u=u.replace(I.match[pa],"");if(!ba)return[];break}}}if(u===O)if(ba==null)E.error(u);else break;O=u}return X};E.error=function(u){throw"Syntax error, unrecognized expression: "+u;};var I=E.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,
POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(u){return u.getAttribute("href")}},relative:{"+":function(u,y){var F=typeof y==="string",G=F&&!/\W/.test(y);F=F&&!G;if(G)y=y.toLowerCase();G=0;for(var O=u.length,N;G<O;G++)if(N=u[G]){for(;(N=N.previousSibling)&&N.nodeType!==1;);u[G]=F||N&&N.nodeName.toLowerCase()===
y?N||false:N===y}F&&E.filter(y,u,true)},">":function(u,y){var F=typeof y==="string";if(F&&!/\W/.test(y)){y=y.toLowerCase();for(var G=0,O=u.length;G<O;G++){var N=u[G];if(N){F=N.parentNode;u[G]=F.nodeName.toLowerCase()===y?F:false}}}else{G=0;for(O=u.length;G<O;G++)if(N=u[G])u[G]=F?N.parentNode:N.parentNode===y;F&&E.filter(y,u,true)}},"":function(u,y,F){var G=o++,O=k;if(typeof y==="string"&&!/\W/.test(y)){var N=y=y.toLowerCase();O=d}O("parentNode",y,G,u,N,F)},"~":function(u,y,F){var G=o++,O=k;if(typeof y===
"string"&&!/\W/.test(y)){var N=y=y.toLowerCase();O=d}O("previousSibling",y,G,u,N,F)}},find:{ID:function(u,y,F){if(typeof y.getElementById!=="undefined"&&!F)return(u=y.getElementById(u[1]))?[u]:[]},NAME:function(u,y){if(typeof y.getElementsByName!=="undefined"){var F=[];y=y.getElementsByName(u[1]);for(var G=0,O=y.length;G<O;G++)y[G].getAttribute("name")===u[1]&&F.push(y[G]);return F.length===0?null:F}},TAG:function(u,y){return y.getElementsByTagName(u[1])}},preFilter:{CLASS:function(u,y,F,G,O,N){u=
" "+u[1].replace(/\\/g,"")+" ";if(N)return u;N=0;for(var X;(X=y[N])!=null;N++)if(X)if(O^(X.className&&(" "+X.className+" ").replace(/[\t\n]/g," ").indexOf(u)>=0))F||G.push(X);else if(F)y[N]=false;return false},ID:function(u){return u[1].replace(/\\/g,"")},TAG:function(u){return u[1].toLowerCase()},CHILD:function(u){if(u[1]==="nth"){var y=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(u[2]==="even"&&"2n"||u[2]==="odd"&&"2n+1"||!/\D/.test(u[2])&&"0n+"+u[2]||u[2]);u[2]=y[1]+(y[2]||1)-0;u[3]=y[3]-0}u[0]=o++;return u},
ATTR:function(u,y,F,G,O,N){y=u[1].replace(/\\/g,"");if(!N&&I.attrMap[y])u[1]=I.attrMap[y];if(u[2]==="~=")u[4]=" "+u[4]+" ";return u},PSEUDO:function(u,y,F,G,O){if(u[1]==="not")if((p.exec(u[3])||"").length>1||/^\w/.test(u[3]))u[3]=E(u[3],null,null,y);else{u=E.filter(u[3],y,F,true^O);F||G.push.apply(G,u);return false}else if(I.match.POS.test(u[0])||I.match.CHILD.test(u[0]))return true;return u},POS:function(u){u.unshift(true);return u}},filters:{enabled:function(u){return u.disabled===false&&u.type!==
"hidden"},disabled:function(u){return u.disabled===true},checked:function(u){return u.checked===true},selected:function(u){return u.selected===true},parent:function(u){return!!u.firstChild},empty:function(u){return!u.firstChild},has:function(u,y,F){return!!E(F[3],u).length},header:function(u){return/h\d/i.test(u.nodeName)},text:function(u){return"text"===u.type},radio:function(u){return"radio"===u.type},checkbox:function(u){return"checkbox"===u.type},file:function(u){return"file"===u.type},password:function(u){return"password"===
u.type},submit:function(u){return"submit"===u.type},image:function(u){return"image"===u.type},reset:function(u){return"reset"===u.type},button:function(u){return"button"===u.type||u.nodeName.toLowerCase()==="button"},input:function(u){return/input|select|textarea|button/i.test(u.nodeName)}},setFilters:{first:function(u,y){return y===0},last:function(u,y,F,G){return y===G.length-1},even:function(u,y){return y%2===0},odd:function(u,y){return y%2===1},lt:function(u,y,F){return y<F[3]-0},gt:function(u,
y,F){return y>F[3]-0},nth:function(u,y,F){return F[3]-0===y},eq:function(u,y,F){return F[3]-0===y}},filter:{PSEUDO:function(u,y,F,G){var O=y[1],N=I.filters[O];if(N)return N(u,F,y,G);else if(O==="contains")return(u.textContent||u.innerText||a([u])||"").indexOf(y[3])>=0;else if(O==="not"){y=y[3];F=0;for(G=y.length;F<G;F++)if(y[F]===u)return false;return true}else E.error("Syntax error, unrecognized expression: "+O)},CHILD:function(u,y){var F=y[1],G=u;switch(F){case "only":case "first":for(;G=G.previousSibling;)if(G.nodeType===
1)return false;if(F==="first")return true;G=u;case "last":for(;G=G.nextSibling;)if(G.nodeType===1)return false;return true;case "nth":F=y[2];var O=y[3];if(F===1&&O===0)return true;y=y[0];var N=u.parentNode;if(N&&(N.sizcache!==y||!u.nodeIndex)){var X=0;for(G=N.firstChild;G;G=G.nextSibling)if(G.nodeType===1)G.nodeIndex=++X;N.sizcache=y}u=u.nodeIndex-O;return F===0?u===0:u%F===0&&u/F>=0}},ID:function(u,y){return u.nodeType===1&&u.getAttribute("id")===y},TAG:function(u,y){return y==="*"&&u.nodeType===
1||u.nodeName.toLowerCase()===y},CLASS:function(u,y){return(" "+(u.className||u.getAttribute("class"))+" ").indexOf(y)>-1},ATTR:function(u,y){var F=y[1];u=I.attrHandle[F]?I.attrHandle[F](u):u[F]!=null?u[F]:u.getAttribute(F);F=u+"";var G=y[2];y=y[4];return u==null?G==="!=":G==="="?F===y:G==="*="?F.indexOf(y)>=0:G==="~="?(" "+F+" ").indexOf(y)>=0:!y?F&&u!==false:G==="!="?F!==y:G==="^="?F.indexOf(y)===0:G==="$="?F.substr(F.length-y.length)===y:G==="|="?F===y||F.substr(0,y.length+1)===y+"-":false},POS:function(u,
y,F,G){var O=I.setFilters[y[2]];if(O)return O(u,F,y,G)}}},Q=I.match.POS;for(var V in I.match){I.match[V]=new RegExp(I.match[V].source+/(?![^\[]*\])(?![^\(]*\))/.source);I.leftMatch[V]=new RegExp(/(^(?:.|\r|\n)*?)/.source+I.match[V].source.replace(/\\(\d+)/g,function(u,y){return"\\"+(y-0+1)}))}var ca=function(u,y){u=Array.prototype.slice.call(u,0);if(y){y.push.apply(y,u);return y}return u};try{Array.prototype.slice.call(m.documentElement.childNodes,0)}catch(ga){ca=function(u,y){y=y||[];if(A.call(u)===
"[object Array]")Array.prototype.push.apply(y,u);else if(typeof u.length==="number")for(var F=0,G=u.length;F<G;F++)y.push(u[F]);else for(F=0;u[F];F++)y.push(u[F]);return y}}var fa;if(m.documentElement.compareDocumentPosition)fa=function(u,y){if(!u.compareDocumentPosition||!y.compareDocumentPosition){if(u==y)B=true;return u.compareDocumentPosition?-1:1}u=u.compareDocumentPosition(y)&4?-1:u===y?0:1;if(u===0)B=true;return u};else if("sourceIndex"in m.documentElement)fa=function(u,y){if(!u.sourceIndex||
!y.sourceIndex){if(u==y)B=true;return u.sourceIndex?-1:1}u=u.sourceIndex-y.sourceIndex;if(u===0)B=true;return u};else if(m.createRange)fa=function(u,y){if(!u.ownerDocument||!y.ownerDocument){if(u==y)B=true;return u.ownerDocument?-1:1}var F=u.ownerDocument.createRange(),G=y.ownerDocument.createRange();F.setStart(u,0);F.setEnd(u,0);G.setStart(y,0);G.setEnd(y,0);u=F.compareBoundaryPoints(Range.START_TO_END,G);if(u===0)B=true;return u};(function(){var u=m.createElement("div"),y="script"+(new Date).getTime();
u.innerHTML="<a name='"+y+"'/>";var F=m.documentElement;F.insertBefore(u,F.firstChild);if(m.getElementById(y)){I.find.ID=function(G,O,N){if(typeof O.getElementById!=="undefined"&&!N)return(O=O.getElementById(G[1]))?O.id===G[1]||typeof O.getAttributeNode!=="undefined"&&O.getAttributeNode("id").nodeValue===G[1]?[O]:undefined:[]};I.filter.ID=function(G,O){var N=typeof G.getAttributeNode!=="undefined"&&G.getAttributeNode("id");return G.nodeType===1&&N&&N.nodeValue===O}}F.removeChild(u);F=u=null})();(function(){var u=
m.createElement("div");u.appendChild(m.createComment(""));if(u.getElementsByTagName("*").length>0)I.find.TAG=function(y,F){F=F.getElementsByTagName(y[1]);if(y[1]==="*"){y=[];for(var G=0;F[G];G++)F[G].nodeType===1&&y.push(F[G]);F=y}return F};u.innerHTML="<a href='#'></a>";if(u.firstChild&&typeof u.firstChild.getAttribute!=="undefined"&&u.firstChild.getAttribute("href")!=="#")I.attrHandle.href=function(y){return y.getAttribute("href",2)};u=null})();m.querySelectorAll&&function(){var u=E,y=m.createElement("div");
y.innerHTML="<p class='TEST'></p>";if(!(y.querySelectorAll&&y.querySelectorAll(".TEST").length===0)){E=function(G,O,N,X){O=O||m;if(!X&&O.nodeType===9&&!Z(O))try{return ca(O.querySelectorAll(G),N)}catch(U){}return u(G,O,N,X)};for(var F in u)E[F]=u[F];y=null}}();(function(){var u=m.createElement("div");u.innerHTML="<div class='test e'></div><div class='test'></div>";if(!(!u.getElementsByClassName||u.getElementsByClassName("e").length===0)){u.lastChild.className="e";if(u.getElementsByClassName("e").length!==
1){I.order.splice(1,0,"CLASS");I.find.CLASS=function(y,F,G){if(typeof F.getElementsByClassName!=="undefined"&&!G)return F.getElementsByClassName(y[1])};u=null}}})();var ka=m.compareDocumentPosition?function(u,y){return!!(u.compareDocumentPosition(y)&16)}:function(u,y){return u!==y&&(u.contains?u.contains(y):true)},Z=function(u){return(u=(u?u.ownerDocument||u:0).documentElement)?u.nodeName!=="HTML":false},Ca=function(u,y){var F=[],G="",O;for(y=y.nodeType?[y]:y;O=I.match.PSEUDO.exec(u);){G+=O[0];u=
u.replace(I.match.PSEUDO,"")}u=I.relative[u]?u+"*":u;O=0;for(var N=y.length;O<N;O++)E(u,y[O],F);return E.filter(G,F)};f.find=E;f.expr=E.selectors;f.expr[":"]=f.expr.filters;f.unique=E.uniqueSort;f.text=a;f.isXMLDoc=Z;f.contains=ka})();var eb=/Until$/,fb=/^(?:parents|prevUntil|prevAll)/,gb=/,/;oa=Array.prototype.slice;var Sa=function(a,d,k){if(f.isFunction(d))return f.grep(a,function(o,A){return!!d.call(o,A,o)===k});else if(d.nodeType)return f.grep(a,function(o){return o===d===k});else if(typeof d===
"string"){var p=f.grep(a,function(o){return o.nodeType===1});if(H.test(d))return f.filter(d,p,!k);else d=f.filter(d,p)}return f.grep(a,function(o){return f.inArray(o,d)>=0===k})};f.fn.extend({find:function(a){for(var d=this.pushStack("","find",a),k=0,p=0,o=this.length;p<o;p++){k=d.length;f.find(a,this[p],d);if(p>0)for(var A=k;A<d.length;A++)for(var B=0;B<k;B++)if(d[B]===d[A]){d.splice(A--,1);break}}return d},has:function(a){var d=f(a);return this.filter(function(){for(var k=0,p=d.length;k<p;k++)if(f.contains(this,
d[k]))return true})},not:function(a){return this.pushStack(Sa(this,a,false),"not",a)},filter:function(a){return this.pushStack(Sa(this,a,true),"filter",a)},is:function(a){return!!a&&f.filter(a,this).length>0},closest:function(a,d){if(f.isArray(a)){var k=[],p=this[0],o,A={},B;if(p&&a.length){o=0;for(var J=a.length;o<J;o++){B=a[o];A[B]||(A[B]=f.expr.match.POS.test(B)?f(B,d||this.context):B)}for(;p&&p.ownerDocument&&p!==d;){for(B in A){o=A[B];if(o.jquery?o.index(p)>-1:f(p).is(o)){k.push({selector:B,
elem:p});delete A[B]}}p=p.parentNode}}return k}var E=f.expr.match.POS.test(a)?f(a,d||this.context):null;return this.map(function(I,Q){for(;Q&&Q.ownerDocument&&Q!==d;){if(E?E.index(Q)>-1:f(Q).is(a))return Q;Q=Q.parentNode}return null})},index:function(a){if(!a||typeof a==="string")return f.inArray(this[0],a?f(a):this.parent().children());return f.inArray(a.jquery?a[0]:a,this)},add:function(a,d){a=typeof a==="string"?f(a,d||this.context):f.makeArray(a);d=f.merge(this.get(),a);return this.pushStack(g(a[0])||
g(d[0])?d:f.unique(d))},andSelf:function(){return this.add(this.prevObject)}});f.each({parent:function(a){return(a=a.parentNode)&&a.nodeType!==11?a:null},parents:function(a){return f.dir(a,"parentNode")},parentsUntil:function(a,d,k){return f.dir(a,"parentNode",k)},next:function(a){return f.nth(a,2,"nextSibling")},prev:function(a){return f.nth(a,2,"previousSibling")},nextAll:function(a){return f.dir(a,"nextSibling")},prevAll:function(a){return f.dir(a,"previousSibling")},nextUntil:function(a,d,k){return f.dir(a,
"nextSibling",k)},prevUntil:function(a,d,k){return f.dir(a,"previousSibling",k)},siblings:function(a){return f.sibling(a.parentNode.firstChild,a)},children:function(a){return f.sibling(a.firstChild)},contents:function(a){return f.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:f.makeArray(a.childNodes)}},function(a,d){f.fn[a]=function(k,p){var o=f.map(this,d,k);eb.test(a)||(p=k);if(p&&typeof p==="string")o=f.filter(p,o);o=this.length>1?f.unique(o):o;if((this.length>1||gb.test(p))&&
fb.test(a))o=o.reverse();return this.pushStack(o,a,oa.call(arguments).join(","))}});f.extend({filter:function(a,d,k){if(k)a=":not("+a+")";return f.find.matches(a,d)},dir:function(a,d,k){var p=[];for(a=a[d];a&&a.nodeType!==9&&(k===undefined||a.nodeType!==1||!f(a).is(k));){a.nodeType===1&&p.push(a);a=a[d]}return p},nth:function(a,d,k){d=d||1;for(var p=0;a;a=a[k])if(a.nodeType===1&&++p===d)break;return a},sibling:function(a,d){for(var k=[];a;a=a.nextSibling)a.nodeType===1&&a!==d&&k.push(a);return k}});
var Ta=/ jQuery\d+="(?:\d+|null)"/g,xa=/^\s+/,Ua=/(<([\w:]+)[^>]*?)\/>/g,hb=/^(?:area|br|col|embed|hr|img|input|link|meta|param)$/i,Va=/<([\w:]+)/,ib=/<tbody/i,jb=/<|&#?\w+;/,Ia=/<script|<object|<embed|<option|<style/i,Ja=/checked\s*(?:[^=]|=\s*.checked.)/i,Wa=function(a,d,k){return hb.test(k)?a:d+"></"+k+">"},la={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>",
"</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};la.optgroup=la.option;la.tbody=la.tfoot=la.colgroup=la.caption=la.thead;la.th=la.td;if(!f.support.htmlSerialize)la._default=[1,"div<div>","</div>"];f.fn.extend({text:function(a){if(f.isFunction(a))return this.each(function(d){var k=f(this);k.text(a.call(this,d,k.text()))});if(typeof a!=="object"&&a!==undefined)return this.empty().append((this[0]&&this[0].ownerDocument||
m).createTextNode(a));return f.text(this)},wrapAll:function(a){if(f.isFunction(a))return this.each(function(k){f(this).wrapAll(a.call(this,k))});if(this[0]){var d=f(a,this[0].ownerDocument).eq(0).clone(true);this[0].parentNode&&d.insertBefore(this[0]);d.map(function(){for(var k=this;k.firstChild&&k.firstChild.nodeType===1;)k=k.firstChild;return k}).append(this)}return this},wrapInner:function(a){if(f.isFunction(a))return this.each(function(d){f(this).wrapInner(a.call(this,d))});return this.each(function(){var d=
f(this),k=d.contents();k.length?k.wrapAll(a):d.append(a)})},wrap:function(a){return this.each(function(){f(this).wrapAll(a)})},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,true,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,true,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&
this[0].parentNode)return this.domManip(arguments,false,function(d){this.parentNode.insertBefore(d,this)});else if(arguments.length){var a=f(arguments[0]);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,false,function(d){this.parentNode.insertBefore(d,this.nextSibling)});else if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,f(arguments[0]).toArray());return a}},
remove:function(a,d){for(var k=0,p;(p=this[k])!=null;k++)if(!a||f.filter(a,[p]).length){if(!d&&p.nodeType===1){f.cleanData(p.getElementsByTagName("*"));f.cleanData([p])}p.parentNode&&p.parentNode.removeChild(p)}return this},empty:function(){for(var a=0,d;(d=this[a])!=null;a++)for(d.nodeType===1&&f.cleanData(d.getElementsByTagName("*"));d.firstChild;)d.removeChild(d.firstChild);return this},clone:function(a){var d=this.map(function(){if(!f.support.noCloneEvent&&!f.isXMLDoc(this)){var k=this.outerHTML,
p=this.ownerDocument;if(!k){k=p.createElement("div");k.appendChild(this.cloneNode(true));k=k.innerHTML}return f.clean([k.replace(Ta,"").replace(/=([^="'>\s]+\/)>/g,'="$1">').replace(xa,"")],p)[0]}else return this.cloneNode(true)});if(a===true){q(this,d);q(this.find("*"),d.find("*"))}return d},html:function(a){if(a===undefined)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(Ta,""):null;else if(typeof a==="string"&&!Ia.test(a)&&(f.support.leadingWhitespace||!xa.test(a))&&!la[(Va.exec(a)||
["",""])[1].toLowerCase()]){a=a.replace(Ua,Wa);try{for(var d=0,k=this.length;d<k;d++)if(this[d].nodeType===1){f.cleanData(this[d].getElementsByTagName("*"));this[d].innerHTML=a}}catch(p){this.empty().append(a)}}else f.isFunction(a)?this.each(function(o){var A=f(this),B=A.html();A.empty().append(function(){return a.call(this,o,B)})}):this.empty().append(a);return this},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(f.isFunction(a))return this.each(function(d){var k=f(this),p=k.html();k.replaceWith(a.call(this,
d,p))});if(typeof a!=="string")a=f(a).detach();return this.each(function(){var d=this.nextSibling,k=this.parentNode;f(this).remove();d?f(d).before(a):f(k).append(a)})}else return this.pushStack(f(f.isFunction(a)?a():a),"replaceWith",a)},detach:function(a){return this.remove(a,true)},domManip:function(a,d,k){function p(V){return f.nodeName(V,"table")?V.getElementsByTagName("tbody")[0]||V.appendChild(V.ownerDocument.createElement("tbody")):V}var o,A,B=a[0],J=[],E;if(!f.support.checkClone&&arguments.length===
3&&typeof B==="string"&&Ja.test(B))return this.each(function(){f(this).domManip(a,d,k,true)});if(f.isFunction(B))return this.each(function(V){var ca=f(this);a[0]=B.call(this,V,d?ca.html():undefined);ca.domManip(a,d,k)});if(this[0]){o=B&&B.parentNode;o=f.support.parentNode&&o&&o.nodeType===11&&o.childNodes.length===this.length?{fragment:o}:r(a,this,J);E=o.fragment;if(A=E.childNodes.length===1?(E=E.firstChild):E.firstChild){d=d&&f.nodeName(A,"tr");for(var I=0,Q=this.length;I<Q;I++)k.call(d?p(this[I],
A):this[I],I>0||o.cacheable||this.length>1?E.cloneNode(true):E)}J.length&&f.each(J,s)}return this}});f.fragments={};f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,d){f.fn[a]=function(k){var p=[];k=f(k);var o=this.length===1&&this[0].parentNode;if(o&&o.nodeType===11&&o.childNodes.length===1&&k.length===1){k[d](this[0]);return this}else{o=0;for(var A=k.length;o<A;o++){var B=(o>0?this.clone(true):this).get();f.fn[d].apply(f(k[o]),
B);p=p.concat(B)}return this.pushStack(p,a,k.selector)}}});f.extend({clean:function(a,d,k,p){d=d||m;if(typeof d.createElement==="undefined")d=d.ownerDocument||d[0]&&d[0].ownerDocument||m;for(var o=[],A=0,B;(B=a[A])!=null;A++){if(typeof B==="number")B+="";if(B){if(typeof B==="string"&&!jb.test(B))B=d.createTextNode(B);else if(typeof B==="string"){B=B.replace(Ua,Wa);var J=(Va.exec(B)||["",""])[1].toLowerCase(),E=la[J]||la._default,I=E[0],Q=d.createElement("div");for(Q.innerHTML=E[1]+B+E[2];I--;)Q=Q.lastChild;
if(!f.support.tbody){I=ib.test(B);J=J==="table"&&!I?Q.firstChild&&Q.firstChild.childNodes:E[1]==="<table>"&&!I?Q.childNodes:[];for(E=J.length-1;E>=0;--E)f.nodeName(J[E],"tbody")&&!J[E].childNodes.length&&J[E].parentNode.removeChild(J[E])}!f.support.leadingWhitespace&&xa.test(B)&&Q.insertBefore(d.createTextNode(xa.exec(B)[0]),Q.firstChild);B=Q.childNodes}if(B.nodeType)o.push(B);else o=f.merge(o,B)}}if(k)for(A=0;o[A];A++)if(p&&f.nodeName(o[A],"script")&&(!o[A].type||o[A].type.toLowerCase()==="text/javascript"))p.push(o[A].parentNode?
o[A].parentNode.removeChild(o[A]):o[A]);else{o[A].nodeType===1&&o.splice.apply(o,[A+1,0].concat(f.makeArray(o[A].getElementsByTagName("script"))));k.appendChild(o[A])}return o},cleanData:function(a){for(var d,k,p=f.cache,o=f.event.special,A=f.support.deleteExpando,B=0,J;(J=a[B])!=null;B++)if(k=J[f.expando]){d=p[k];if(d.events)for(var E in d.events)o[E]?f.event.remove(J,E):Ma(J,E,d.handle);if(A)delete J[f.expando];else J.removeAttribute&&J.removeAttribute(f.expando);delete p[k]}}});var kb=/z-?index|font-?weight|opacity|zoom|line-?height/i,
Xa=/alpha\([^)]*\)/,Ya=/opacity=([^)]*)/,Da=/float/i,Ea=/-([a-z])/ig,lb=/([A-Z])/g,mb=/^-?\d+(?:px)?$/i,nb=/^-?\d/,ob={position:"absolute",visibility:"hidden",display:"block"},pb=["Left","Right"],qb=["Top","Bottom"],rb=m.defaultView&&m.defaultView.getComputedStyle,Za=f.support.cssFloat?"cssFloat":"styleFloat",Fa=function(a,d){return d.toUpperCase()};f.fn.css=function(a,d){return n(this,a,d,true,function(k,p,o){if(o===undefined)return f.curCSS(k,p);if(typeof o==="number"&&!kb.test(p))o+="px";f.style(k,
p,o)})};f.extend({style:function(a,d,k){if(!(!a||a.nodeType===3||a.nodeType===8)){if((d==="width"||d==="height")&&parseFloat(k)<0)k=undefined;var p=a.style||a,o=k!==undefined;if(!f.support.opacity&&d==="opacity"){if(o){p.zoom=1;d=parseInt(k,10)+""==="NaN"?"":"alpha(opacity="+k*100+")";a=p.filter||f.curCSS(a,"filter")||"";p.filter=Xa.test(a)?a.replace(Xa,d):d}return p.filter&&p.filter.indexOf("opacity=")>=0?parseFloat(Ya.exec(p.filter)[1])/100+"":""}if(Da.test(d))d=Za;d=d.replace(Ea,Fa);if(o)p[d]=
k;return p[d]}},css:function(a,d,k,p){if(d==="width"||d==="height"){var o,A=d==="width"?pb:qb;k=function(){o=d==="width"?a.offsetWidth:a.offsetHeight;p!=="border"&&f.each(A,function(){p||(o-=parseFloat(f.curCSS(a,"padding"+this,true))||0);if(p==="margin")o+=parseFloat(f.curCSS(a,"margin"+this,true))||0;else o-=parseFloat(f.curCSS(a,"border"+this+"Width",true))||0})};a.offsetWidth!==0?k():f.swap(a,ob,k);return Math.max(0,Math.round(o))}return f.curCSS(a,d,k)},curCSS:function(a,d,k){var p,o=a.style;
if(!f.support.opacity&&d==="opacity"&&a.currentStyle){p=Ya.test(a.currentStyle.filter||"")?parseFloat(RegExp.$1)/100+"":"";return p===""?"1":p}if(Da.test(d))d=Za;if(!k&&o&&o[d])p=o[d];else if(rb){if(Da.test(d))d="float";d=d.replace(lb,"-$1").toLowerCase();o=a.ownerDocument.defaultView;if(!o)return null;if(a=o.getComputedStyle(a,null))p=a.getPropertyValue(d);if(d==="opacity"&&p==="")p="1"}else if(a.currentStyle){k=d.replace(Ea,Fa);p=a.currentStyle[d]||a.currentStyle[k];if(!mb.test(p)&&nb.test(p)){d=
o.left;var A=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;o.left=k==="fontSize"?"1em":p||0;p=o.pixelLeft+"px";o.left=d;a.runtimeStyle.left=A}}return p},swap:function(a,d,k){var p={};for(var o in d){p[o]=a.style[o];a.style[o]=d[o]}k.call(a);for(o in d)a.style[o]=p[o]}});if(f.expr&&f.expr.filters){f.expr.filters.hidden=function(a){var d=a.offsetWidth,k=a.offsetHeight,p=a.nodeName.toLowerCase()==="tr";return d===0&&k===0&&!p?true:d>0&&k>0&&!p?false:f.curCSS(a,"display")==="none"};f.expr.filters.visible=
function(a){return!f.expr.filters.hidden(a)}}var sb=j(),tb=/<script(.|\s)*?\/script>/gi,ub=/select|textarea/i,vb=/color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week/i,sa=/=\?(&|$)/,Ga=/\?/,wb=/(\?|&)_=.*?(&|$)/,xb=/^(\w+:)?\/\/([^\/?#]+)/,yb=/%20/g,zb=f.fn.load;f.fn.extend({load:function(a,d,k){if(typeof a!=="string")return zb.call(this,a);else if(!this.length)return this;var p=a.indexOf(" ");if(p>=0){var o=a.slice(p,a.length);a=a.slice(0,p)}p="GET";if(d)if(f.isFunction(d)){k=
d;d=null}else if(typeof d==="object"){d=f.param(d,f.ajaxSettings.traditional);p="POST"}var A=this;f.ajax({url:a,type:p,dataType:"html",data:d,complete:function(B,J){if(J==="success"||J==="notmodified")A.html(o?f("<div />").append(B.responseText.replace(tb,"")).find(o):B.responseText);k&&A.each(k,[B.responseText,J,B])}});return this},serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?f.makeArray(this.elements):this}).filter(function(){return this.name&&
!this.disabled&&(this.checked||ub.test(this.nodeName)||vb.test(this.type))}).map(function(a,d){a=f(this).val();return a==null?null:f.isArray(a)?f.map(a,function(k){return{name:d.name,value:k}}):{name:d.name,value:a}}).get()}});f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,d){f.fn[d]=function(k){return this.bind(d,k)}});f.extend({get:function(a,d,k,p){if(f.isFunction(d)){p=p||k;k=d;d=null}return f.ajax({type:"GET",url:a,data:d,success:k,dataType:p})},
getScript:function(a,d){return f.get(a,null,d,"script")},getJSON:function(a,d,k){return f.get(a,d,k,"json")},post:function(a,d,k,p){if(f.isFunction(d)){p=p||k;k=d;d={}}return f.ajax({type:"POST",url:a,data:d,success:k,dataType:p})},ajaxSetup:function(a){f.extend(f.ajaxSettings,a)},ajaxSettings:{url:location.href,global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:window.XMLHttpRequest&&(window.location.protocol!=="file:"||!window.ActiveXObject)?function(){return new window.XMLHttpRequest}:
function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},etag:{},ajax:function(a){function d(){o.success&&o.success.call(E,J,B,Z);o.global&&p("ajaxSuccess",[Z,o])}function k(){o.complete&&o.complete.call(E,Z,B);o.global&&p("ajaxComplete",[Z,o]);o.global&&!--f.active&&f.event.trigger("ajaxStop")}
function p(O,N){(o.context?f(o.context):f.event).trigger(O,N)}var o=f.extend(true,{},f.ajaxSettings,a),A,B,J,E=a&&a.context||o,I=o.type.toUpperCase();if(o.data&&o.processData&&typeof o.data!=="string")o.data=f.param(o.data,o.traditional);if(o.dataType==="jsonp"){if(I==="GET")sa.test(o.url)||(o.url+=(Ga.test(o.url)?"&":"?")+(o.jsonp||"callback")+"=?");else if(!o.data||!sa.test(o.data))o.data=(o.data?o.data+"&":"")+(o.jsonp||"callback")+"=?";o.dataType="json"}if(o.dataType==="json"&&(o.data&&sa.test(o.data)||
sa.test(o.url))){A=o.jsonpCallback||"jsonp"+sb++;if(o.data)o.data=(o.data+"").replace(sa,"="+A+"$1");o.url=o.url.replace(sa,"="+A+"$1");o.dataType="script";window[A]=window[A]||function(O){J=O;d();k();window[A]=undefined;try{delete window[A]}catch(N){}ca&&ca.removeChild(ga)}}if(o.dataType==="script"&&o.cache===null)o.cache=false;if(o.cache===false&&I==="GET"){var Q=j(),V=o.url.replace(wb,"$1_="+Q+"$2");o.url=V+(V===o.url?(Ga.test(o.url)?"&":"?")+"_="+Q:"")}if(o.data&&I==="GET")o.url+=(Ga.test(o.url)?
"&":"?")+o.data;o.global&&!f.active++&&f.event.trigger("ajaxStart");Q=(Q=xb.exec(o.url))&&(Q[1]&&Q[1]!==location.protocol||Q[2]!==location.host);if(o.dataType==="script"&&I==="GET"&&Q){var ca=m.getElementsByTagName("head")[0]||m.documentElement,ga=m.createElement("script");ga.src=o.url;if(o.scriptCharset)ga.charset=o.scriptCharset;if(!A){var fa=false;ga.onload=ga.onreadystatechange=function(){if(!fa&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){fa=true;d();k();ga.onload=
ga.onreadystatechange=null;ca&&ga.parentNode&&ca.removeChild(ga)}}}ca.insertBefore(ga,ca.firstChild)}else{var ka=false,Z=o.xhr();if(Z){o.username?Z.open(I,o.url,o.async,o.username,o.password):Z.open(I,o.url,o.async);try{if(o.data||a&&a.contentType)Z.setRequestHeader("Content-Type",o.contentType);if(o.ifModified){f.lastModified[o.url]&&Z.setRequestHeader("If-Modified-Since",f.lastModified[o.url]);f.etag[o.url]&&Z.setRequestHeader("If-None-Match",f.etag[o.url])}Q||Z.setRequestHeader("X-Requested-With",
"XMLHttpRequest");Z.setRequestHeader("Accept",o.dataType&&o.accepts[o.dataType]?o.accepts[o.dataType]+", */*":o.accepts._default)}catch(Ca){}if(o.beforeSend&&o.beforeSend.call(E,Z,o)===false){o.global&&!--f.active&&f.event.trigger("ajaxStop");Z.abort();return false}o.global&&p("ajaxSend",[Z,o]);var u=Z.onreadystatechange=function(O){if(!Z||Z.readyState===0||O==="abort"){ka||k();ka=true;if(Z)Z.onreadystatechange=f.noop}else if(!ka&&Z&&(Z.readyState===4||O==="timeout")){ka=true;Z.onreadystatechange=
f.noop;B=O==="timeout"?"timeout":!f.httpSuccess(Z)?"error":o.ifModified&&f.httpNotModified(Z,o.url)?"notmodified":"success";var N;if(B==="success")try{J=f.httpData(Z,o.dataType,o)}catch(X){B="parsererror";N=X}if(B==="success"||B==="notmodified")A||d();else f.handleError(o,Z,B,N);k();O==="timeout"&&Z.abort();if(o.async)Z=null}};try{var y=Z.abort;Z.abort=function(){Z&&y.call(Z);u("abort")}}catch(F){}o.async&&o.timeout>0&&setTimeout(function(){Z&&!ka&&u("timeout")},o.timeout);try{Z.send(I==="POST"||
I==="PUT"||I==="DELETE"?o.data:null)}catch(G){f.handleError(o,Z,null,G);k()}o.async||u();return Z}}},handleError:function(a,d,k,p){if(a.error)a.error.call(a.context||a,d,k,p);if(a.global)(a.context?f(a.context):f.event).trigger("ajaxError",[d,a,p])},active:0,httpSuccess:function(a){try{return!a.status&&location.protocol==="file:"||a.status>=200&&a.status<300||a.status===304||a.status===1223||a.status===0}catch(d){}return false},httpNotModified:function(a,d){var k=a.getResponseHeader("Last-Modified"),
p=a.getResponseHeader("Etag");if(k)f.lastModified[d]=k;if(p)f.etag[d]=p;return a.status===304||a.status===0},httpData:function(a,d,k){var p=a.getResponseHeader("content-type")||"",o=d==="xml"||!d&&p.indexOf("xml")>=0;a=o?a.responseXML:a.responseText;o&&a.documentElement.nodeName==="parsererror"&&f.error("parsererror");if(k&&k.dataFilter)a=k.dataFilter(a,d);if(typeof a==="string")if(d==="json"||!d&&p.indexOf("json")>=0)a=f.parseJSON(a);else if(d==="script"||!d&&p.indexOf("javascript")>=0)f.globalEval(a);
return a},param:function(a,d){function k(B,J){if(f.isArray(J))f.each(J,function(E,I){d||/\[\]$/.test(B)?p(B,I):k(B+"["+(typeof I==="object"||f.isArray(I)?E:"")+"]",I)});else!d&&J!=null&&typeof J==="object"?f.each(J,function(E,I){k(B+"["+E+"]",I)}):p(B,J)}function p(B,J){J=f.isFunction(J)?J():J;o[o.length]=encodeURIComponent(B)+"="+encodeURIComponent(J)}var o=[];if(d===undefined)d=f.ajaxSettings.traditional;if(f.isArray(a)||a.jquery)f.each(a,function(){p(this.name,this.value)});else for(var A in a)k(A,
a[A]);return o.join("&").replace(yb,"+")}});var Ha={},Ab=/toggle|show|hide/,Bb=/^([+-]=)?([\d+-.]+)(.*)$/,ya,Ka=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];f.fn.extend({show:function(a,d){if(a||a===0)return this.animate(z("show",3),a,d);else{a=0;for(d=this.length;a<d;a++){var k=f.data(this[a],"olddisplay");this[a].style.display=k||"";if(f.css(this[a],"display")==="none"){k=this[a].nodeName;var p;
if(Ha[k])p=Ha[k];else{var o=f("<"+k+" />").appendTo("body");p=o.css("display");if(p==="none")p="block";o.remove();Ha[k]=p}f.data(this[a],"olddisplay",p)}}a=0;for(d=this.length;a<d;a++)this[a].style.display=f.data(this[a],"olddisplay")||"";return this}},hide:function(a,d){if(a||a===0)return this.animate(z("hide",3),a,d);else{a=0;for(d=this.length;a<d;a++){var k=f.data(this[a],"olddisplay");!k&&k!=="none"&&f.data(this[a],"olddisplay",f.css(this[a],"display"))}a=0;for(d=this.length;a<d;a++)this[a].style.display=
"none";return this}},_toggle:f.fn.toggle,toggle:function(a,d){var k=typeof a==="boolean";if(f.isFunction(a)&&f.isFunction(d))this._toggle.apply(this,arguments);else a==null||k?this.each(function(){var p=k?a:f(this).is(":hidden");f(this)[p?"show":"hide"]()}):this.animate(z("toggle",3),a,d);return this},fadeTo:function(a,d,k){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:d},a,k)},animate:function(a,d,k,p){var o=f.speed(d,k,p);if(f.isEmptyObject(a))return this.each(o.complete);
return this[o.queue===false?"each":"queue"](function(){var A=f.extend({},o),B,J=this.nodeType===1&&f(this).is(":hidden"),E=this;for(B in a){var I=B.replace(Ea,Fa);if(B!==I){a[I]=a[B];delete a[B];B=I}if(a[B]==="hide"&&J||a[B]==="show"&&!J)return A.complete.call(this);if((B==="height"||B==="width")&&this.style){A.display=f.css(this,"display");A.overflow=this.style.overflow}if(f.isArray(a[B])){(A.specialEasing=A.specialEasing||{})[B]=a[B][1];a[B]=a[B][0]}}if(A.overflow!=null)this.style.overflow="hidden";
A.curAnim=f.extend({},a);f.each(a,function(Q,V){var ca=new f.fx(E,A,Q);if(Ab.test(V))ca[V==="toggle"?J?"show":"hide":V](a);else{var ga=Bb.exec(V),fa=ca.cur(true)||0;if(ga){V=parseFloat(ga[2]);var ka=ga[3]||"px";if(ka!=="px"){E.style[Q]=(V||1)+ka;fa=(V||1)/ca.cur(true)*fa;E.style[Q]=fa+ka}if(ga[1])V=(ga[1]==="-="?-1:1)*V+fa;ca.custom(fa,V,ka)}else ca.custom(fa,V,"")}});return true})},stop:function(a,d){var k=f.timers;a&&this.queue([]);this.each(function(){for(var p=k.length-1;p>=0;p--)if(k[p].elem===
this){d&&k[p](true);k.splice(p,1)}});d||this.dequeue();return this}});f.each({slideDown:z("show",1),slideUp:z("hide",1),slideToggle:z("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"}},function(a,d){f.fn[a]=function(k,p){return this.animate(d,k,p)}});f.extend({speed:function(a,d,k){var p=a&&typeof a==="object"?a:{complete:k||!k&&d||f.isFunction(a)&&a,duration:a,easing:k&&d||d&&!f.isFunction(d)&&d};p.duration=f.fx.off?0:typeof p.duration==="number"?p.duration:f.fx.speeds[p.duration]||f.fx.speeds._default;
p.old=p.complete;p.complete=function(){p.queue!==false&&f(this).dequeue();f.isFunction(p.old)&&p.old.call(this)};return p},easing:{linear:function(a,d,k,p){return k+p*a},swing:function(a,d,k,p){return(-Math.cos(a*Math.PI)/2+0.5)*p+k}},timers:[],fx:function(a,d,k){this.options=d;this.elem=a;this.prop=k;if(!d.orig)d.orig={}}});f.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this);(f.fx.step[this.prop]||f.fx.step._default)(this);if((this.prop==="height"||
this.prop==="width")&&this.elem.style)this.elem.style.display="block"},cur:function(a){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];return(a=parseFloat(f.css(this.elem,this.prop,a)))&&a>-10000?a:parseFloat(f.curCSS(this.elem,this.prop))||0},custom:function(a,d,k){function p(A){return o.step(A)}this.startTime=j();this.start=a;this.end=d;this.unit=k||this.unit||"px";this.now=this.start;this.pos=this.state=0;var o=this;p.elem=this.elem;
if(p()&&f.timers.push(p)&&!ya)ya=setInterval(f.fx.tick,13)},show:function(){this.options.orig[this.prop]=f.style(this.elem,this.prop);this.options.show=true;this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur());f(this.elem).show()},hide:function(){this.options.orig[this.prop]=f.style(this.elem,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(a){var d=j(),k=true;if(a||d>=this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();
this.options.curAnim[this.prop]=true;for(var p in this.options.curAnim)if(this.options.curAnim[p]!==true)k=false;if(k){if(this.options.display!=null){this.elem.style.overflow=this.options.overflow;a=f.data(this.elem,"olddisplay");this.elem.style.display=a?a:this.options.display;if(f.css(this.elem,"display")==="none")this.elem.style.display="block"}this.options.hide&&f(this.elem).hide();if(this.options.hide||this.options.show)for(var o in this.options.curAnim)f.style(this.elem,o,this.options.orig[o]);
this.options.complete.call(this.elem)}return false}else{o=d-this.startTime;this.state=o/this.options.duration;a=this.options.easing||(f.easing.swing?"swing":"linear");this.pos=f.easing[this.options.specialEasing&&this.options.specialEasing[this.prop]||a](this.state,o,0,1,this.options.duration);this.now=this.start+(this.end-this.start)*this.pos;this.update()}return true}};f.extend(f.fx,{tick:function(){for(var a=f.timers,d=0;d<a.length;d++)a[d]()||a.splice(d--,1);a.length||f.fx.stop()},stop:function(){clearInterval(ya);
ya=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){f.style(a.elem,"opacity",a.now)},_default:function(a){if(a.elem.style&&a.elem.style[a.prop]!=null)a.elem.style[a.prop]=(a.prop==="width"||a.prop==="height"?Math.max(0,a.now):a.now)+a.unit;else a.elem[a.prop]=a.now}}});if(f.expr&&f.expr.filters)f.expr.filters.animated=function(a){return f.grep(f.timers,function(d){return a===d.elem}).length};f.fn.offset="getBoundingClientRect"in m.documentElement?function(a){var d=this[0];if(a)return this.each(function(o){f.offset.setOffset(this,
a,o)});if(!d||!d.ownerDocument)return null;if(d===d.ownerDocument.body)return f.offset.bodyOffset(d);var k=d.getBoundingClientRect(),p=d.ownerDocument;d=p.body;p=p.documentElement;return{top:k.top+(self.pageYOffset||f.support.boxModel&&p.scrollTop||d.scrollTop)-(p.clientTop||d.clientTop||0),left:k.left+(self.pageXOffset||f.support.boxModel&&p.scrollLeft||d.scrollLeft)-(p.clientLeft||d.clientLeft||0)}}:function(a){var d=this[0];if(a)return this.each(function(Q){f.offset.setOffset(this,a,Q)});if(!d||
!d.ownerDocument)return null;if(d===d.ownerDocument.body)return f.offset.bodyOffset(d);f.offset.initialize();var k=d.offsetParent,p=d,o=d.ownerDocument,A,B=o.documentElement,J=o.body;p=(o=o.defaultView)?o.getComputedStyle(d,null):d.currentStyle;for(var E=d.offsetTop,I=d.offsetLeft;(d=d.parentNode)&&d!==J&&d!==B;){if(f.offset.supportsFixedPosition&&p.position==="fixed")break;A=o?o.getComputedStyle(d,null):d.currentStyle;E-=d.scrollTop;I-=d.scrollLeft;if(d===k){E+=d.offsetTop;I+=d.offsetLeft;if(f.offset.doesNotAddBorder&&
!(f.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(d.nodeName))){E+=parseFloat(A.borderTopWidth)||0;I+=parseFloat(A.borderLeftWidth)||0}p=k;k=d.offsetParent}if(f.offset.subtractsBorderForOverflowNotVisible&&A.overflow!=="visible"){E+=parseFloat(A.borderTopWidth)||0;I+=parseFloat(A.borderLeftWidth)||0}p=A}if(p.position==="relative"||p.position==="static"){E+=J.offsetTop;I+=J.offsetLeft}if(f.offset.supportsFixedPosition&&p.position==="fixed"){E+=Math.max(B.scrollTop,J.scrollTop);I+=Math.max(B.scrollLeft,
J.scrollLeft)}return{top:E,left:I}};f.offset={initialize:function(){var a=m.body,d=m.createElement("div"),k,p,o,A=parseFloat(f.curCSS(a,"marginTop",true))||0;f.extend(d.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"});d.innerHTML="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>";
a.insertBefore(d,a.firstChild);k=d.firstChild;p=k.firstChild;o=k.nextSibling.firstChild.firstChild;this.doesNotAddBorder=p.offsetTop!==5;this.doesAddBorderForTableAndCells=o.offsetTop===5;p.style.position="fixed";p.style.top="20px";this.supportsFixedPosition=p.offsetTop===20||p.offsetTop===15;p.style.position=p.style.top="";k.style.overflow="hidden";k.style.position="relative";this.subtractsBorderForOverflowNotVisible=p.offsetTop===-5;this.doesNotIncludeMarginInBodyOffset=a.offsetTop!==A;a.removeChild(d);
f.offset.initialize=f.noop},bodyOffset:function(a){var d=a.offsetTop,k=a.offsetLeft;f.offset.initialize();if(f.offset.doesNotIncludeMarginInBodyOffset){d+=parseFloat(f.curCSS(a,"marginTop",true))||0;k+=parseFloat(f.curCSS(a,"marginLeft",true))||0}return{top:d,left:k}},setOffset:function(a,d,k){if(/static/.test(f.curCSS(a,"position")))a.style.position="relative";var p=f(a),o=p.offset(),A=parseInt(f.curCSS(a,"top",true),10)||0,B=parseInt(f.curCSS(a,"left",true),10)||0;if(f.isFunction(d))d=d.call(a,
k,o);k={top:d.top-o.top+A,left:d.left-o.left+B};"using"in d?d.using.call(a,k):p.css(k)}};f.fn.extend({position:function(){if(!this[0])return null;var a=this[0],d=this.offsetParent(),k=this.offset(),p=/^body|html$/i.test(d[0].nodeName)?{top:0,left:0}:d.offset();k.top-=parseFloat(f.curCSS(a,"marginTop",true))||0;k.left-=parseFloat(f.curCSS(a,"marginLeft",true))||0;p.top+=parseFloat(f.curCSS(d[0],"borderTopWidth",true))||0;p.left+=parseFloat(f.curCSS(d[0],"borderLeftWidth",true))||0;return{top:k.top-
p.top,left:k.left-p.left}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||m.body;a&&!/^body|html$/i.test(a.nodeName)&&f.css(a,"position")==="static";)a=a.offsetParent;return a})}});f.each(["Left","Top"],function(a,d){var k="scroll"+d;f.fn[k]=function(p){var o=this[0],A;if(!o)return null;if(p!==undefined)return this.each(function(){if(A=C(this))A.scrollTo(!a?p:f(A).scrollLeft(),a?p:f(A).scrollTop());else this[k]=p});else return(A=C(o))?"pageXOffset"in A?A[a?"pageYOffset":
"pageXOffset"]:f.support.boxModel&&A.document.documentElement[k]||A.document.body[k]:o[k]}});f.each(["Height","Width"],function(a,d){var k=d.toLowerCase();f.fn["inner"+d]=function(){return this[0]?f.css(this[0],k,false,"padding"):null};f.fn["outer"+d]=function(p){return this[0]?f.css(this[0],k,false,p?"margin":"border"):null};f.fn[k]=function(p){var o=this[0];if(!o)return p==null?null:this;if(f.isFunction(p))return this.each(function(A){var B=f(this);B[k](p.call(this,A,B[k]()))});return"scrollTo"in
o&&o.document?o.document.compatMode==="CSS1Compat"&&o.document.documentElement["client"+d]||o.document.body["client"+d]:o.nodeType===9?Math.max(o.documentElement["client"+d],o.body["scroll"+d],o.documentElement["scroll"+d],o.body["offset"+d],o.documentElement["offset"+d]):p===undefined?f.css(o,k):this.css(k,typeof p==="string"?p:p+"px")}});t.$=t.jQuery=f});
bespin.tiki.register("::embedded",{name:"embedded",dependencies:{theme_manager:"0.0.0",text_editor:"0.0.0",appconfig:"0.0.0",edit_session:"0.0.0",screen_theme:"0.0.0"}});bespin.tiki.module("embedded:index",function(){});bespin.tiki.register("::settings",{name:"settings",dependencies:{types:"0.0.0"}});
bespin.tiki.module("settings:commands",function(x,t){x("bespin:plugins");x("environment");var v=x("settings").settings;t.setCommand=function(s,n){var j;if(s.setting)if(s.value===undefined)j="<strong>"+s.setting+"</strong> = "+v.get(s.setting);else{j="Setting: <strong>"+s.setting+"</strong> = "+s.value;v.set(s.setting,s.value)}else{s=v._list();j="";s.sort(function(b,e){return b.key<e.key?-1:b.key==e.key?0:1});s.forEach(function(b){j+='<a class="setting" href="https://wiki.mozilla.org/Labs/Bespin/Settings#'+
b.key+'" title="View external documentation on setting: '+b.key+'" target="_blank">'+b.key+"</a> = "+b.value+"<br/>"})}n.done(j)};t.unsetCommand=function(s,n){v.resetValue(s.setting);n.done("Reset "+s.setting+" to default: "+v.get(s.setting))}});
bespin.tiki.module("settings:index",function(x,t){var v=x("bespin:plugins").catalog,s=x("bespin:console").console,n=x("bespin:promise").Promise,j=x("bespin:promise").group,b=x("types:types");t.addSetting=function(e){x("settings").settings.addSetting(e)};t.getSettings=function(){return v.getExtensions("setting")};t.getTypeSpecFromAssignment=function(e){var l=e.assignments;e="text";if(l){var h=null;l.forEach(function(i){if(i.param.name==="setting")h=i});if(h)if((l=h.value)&&l!=="")if(l=v.getExtensionByKey("setting",
l))e=l.type}return e};t.MemorySettings=function(){};t.MemorySettings.prototype={_values:{},_deactivated:{},setPersister:function(e){(this._persister=e)&&e.loadInitialValues(this)},get:function(e){return this._values[e]},set:function(e,l){var h=v.getExtensionByKey("setting",e);if(h)if(typeof l=="string"&&h.type=="string")this._values[e]=l;else{var i=false;b.fromString(l,h.type).then(function(g){i=true;this._values[e]=g;v.publish(this,"settingChange",e,g)}.bind(this),function(g){s.error("Error setting",
e,": ",g)});if(!i){s.warn("About to set string version of ",e,"delaying typed set.");this._values[e]=l}}else{s.warn("Setting not defined: ",e,l);this._deactivated[e]=l}this._persistValue(e,l);return this},addSetting:function(e){if(e.name){!e.defaultValue===undefined&&s.error("Setting.defaultValue == undefined",e);b.isValid(e.defaultValue,e.type).then(function(l){l||s.warn("!Setting.isValid(Setting.defaultValue)",e);this.set(e.name,this._deactivated[e.name]||e.defaultValue)}.bind(this),function(l){s.error("Type error ",
l," ignoring setting ",e)})}else s.error("Setting.name == undefined. Ignoring.",e)},resetValue:function(e){var l=v.getExtensionByKey("setting",e);l?this.set(e,l.defaultValue):s.log("ignore resetValue on ",e)},resetAll:function(){this._getSettingNames().forEach(function(e){this.resetValue(e)}.bind(this))},_getSettingNames:function(){var e=[];v.getExtensions("setting").forEach(function(l){e.push(l.name)});return e},_list:function(){var e=[];this._getSettingNames().forEach(function(l){e.push({key:l,
value:this.get(l)})}.bind(this));return e},_persistValue:function(e,l){var h=this._persister;h&&h.persistValue(this,e,l)},_loadInitialValues:function(){var e=this._persister;e?e.loadInitialValues(this):this._loadDefaultValues()},_loadDefaultValues:function(){return this._loadFromObject(this._defaultValues())},_loadFromObject:function(e){var l=[],h=function(z){return function(C){this.set(z,C)}};for(var i in e)if(e.hasOwnProperty(i)){var g=e[i],q=v.getExtensionByKey("setting",i);if(q){g=b.fromString(g,
q.type);q=h(i);g.then(q);l.push(g)}}var r=new n;j(l).then(function(){r.resolve()});return r},_saveToObject:function(){var e=[],l={};this._getSettingNames().forEach(function(i){var g=this.get(i),q=v.getExtensionByKey("setting",i);if(q){g=b.toString(g,q.type);g.then(function(r){l[i]=r});e.push(g)}}.bind(this));var h=new n;j(e).then(function(){h.resolve(l)});return h},_defaultValues:function(){var e={};v.getExtensions("setting").forEach(function(l){e[l.name]=l.defaultValue});return e}};t.settings=new t.MemorySettings});
bespin.tiki.module("settings:cookie",function(x,t){var v=x("bespin:util/cookie");t.CookiePersister=function(){};t.CookiePersister.prototype={loadInitialValues:function(s){s._loadDefaultValues().then(function(){var n=v.get("settings");s._loadFromObject(JSON.parse(n))}.bind(this))},persistValue:function(s){try{var n={};s._getSettingNames().forEach(function(e){n[e]=s.get(e)});var j=JSON.stringify(n);v.set("settings",j)}catch(b){console.error("Unable to JSONify the settings! "+b)}}}});
bespin.tiki.register("::appconfig",{name:"appconfig",dependencies:{jquery:"0.0.0",canon:"0.0.0",underscore:"0.0.0",settings:"0.0.0"}});
bespin.tiki.module("appconfig:index",function(x,t){var v=x("jquery").$;x("underscore");var s=x("settings").settings,n=x("bespin:promise").group,j=x("bespin:promise").Promise,b=x("bespin:console").console,e=x("bespin:util/stacktrace").Trace,l=x("bespin:util/util"),h=true;t.launch=function(q){var r=new j;v("#_bespin_loading").remove();var z;if(h){z=bespin.tiki.require;h=false}else z=(new (bespin.tiki.require("bespin:sandbox").Sandbox)).createRequire({id:"index",ownerPackage:bespin.tiki.loader.anonymousPackage});
var C=z("bespin:plugins").catalog;q=q||{};t.normalizeConfig(C,q);var f=q.objects;for(var K in f)C.registerObject(K,f[K]);for(var M in q.settings)s.set(M,q.settings[M]);var m=function(){var D=z("environment").env,H=D.editor;if(H){q.lineNumber&&H.setLineNumber(q.lineNumber);if(q.stealFocus)H.focus=true;if(q.readOnly)H.readOnly=q.readOnly;if(q.syntax)H.syntax=q.syntax}if(H=C.getObject("commandLine"))D.commandLine=H;C.publish(this,"appLaunched");r.resolve(D)}.bind(this),w=new j;w.then(function(){f.loginController?
C.createObject("loginController").then(function(D){D.showLogin().then(function(H){q.objects.session.arguments.push(H);t.launchEditor(C,q).then(m,r.reject.bind(r))})}):t.launchEditor(C,q).then(m,r.reject.bind(r))},function(D){r.reject(D)});C.plugins.theme_manager?bespin.tiki.require.ensurePackage("::theme_manager",function(){var D=z("theme_manager");q.theme.basePlugin&&D.setBasePlugin(q.theme.basePlugin);q.theme.standard&&D.setStandardTheme(q.theme.standard);D.startParsing().then(function(){w.resolve()},
function(H){w.reject(H)})}):w.resolve();return r};t.normalizeConfig=function(q,r){if(r.objects===undefined)r.objects={};if(r.autoload===undefined)r.autoload=[];if(r.theme===undefined)r.theme={};if(!r.theme.basePlugin&&q.plugins.screen_theme)r.theme.basePlugin="screen_theme";if(!r.initialContent)r.initialContent="";if(!r.settings)r.settings={};if(!r.objects.notifier&&q.plugins.notifier)r.objects.notifier={};if(!r.objects.loginController&&q.plugins.userident)r.objects.loginController={};if(!r.objects.fileHistory&&
q.plugins.file_history)r.objects.fileHistory={factory:"file_history",arguments:["session"],objects:{"0":"session"}};if(!r.objects.server&&q.plugins.bespin_server){r.objects.server={factory:"bespin_server"};r.objects.filesource={factory:"bespin_filesource",arguments:["server"],objects:{"0":"server"}}}if(!r.objects.files&&q.plugins.filesystem&&r.objects.filesource)r.objects.files={arguments:["filesource"],objects:{"0":"filesource"}};if(!r.objects.editor)r.objects.editor={factory:"text_editor",arguments:[r.initialContent]};
if(!r.objects.session)r.objects.session={arguments:["editor"],objects:{"0":"editor"}};if(!r.objects.commandLine&&q.plugins.command_line)r.objects.commandLine={};if(!r.objects.toolbar&&q.plugins.toolbar)r.objects.toolbar={};if(r.gui===undefined)r.gui={};q={};for(var z in r.gui){var C=r.gui[z];if(C.component)q[C.component]=true}if(!r.gui.north&&r.objects.toolbar&&!q.toolbar)r.gui.north={component:"toolbar"};if(!r.gui.center&&r.objects.editor&&!q.editor)r.gui.center={component:"editor"};if(!r.gui.south&&
r.objects.commandLine&&!q.commandLine)r.gui.south={component:"commandLine"}};t.launchEditor=function(q,r){var z=new j;if(r===null){b.error("Cannot start editor without a configuration!");z.reject("Cannot start editor without a configuration!");return z}i(q,r).then(function(){g(q,r,z)},function(C){b.error("Error while creating objects");(new e(C)).log();z.reject(C)});return z};var i=function(q,r){var z=[];for(var C in r.objects)z.push(q.createObject(C));return n(z)},g=function(q,r,z){var C=document.createElement("div");
C.setAttribute("class","container");var f=document.createElement("div");f.setAttribute("class","center-container");var K=false,M=r.element||document.body;l.addClass(M,"bespin");M.appendChild(C);try{["north","west","center","east","south"].forEach(function(w){var D=r.gui[w];if(D){var H=q.getObject(D.component);if(!H)throw"Cannot find object "+D.component+" to attach to the Bespin UI";M=H.element;if(!M)throw"Component "+D.component+' does not have an "element" attribute to attach to the Bespin UI';
v(M).addClass(w);if(w=="west"||w=="east"||w=="center"){if(!K){C.appendChild(f);K=true}f.appendChild(M)}else C.appendChild(M)}});["north","west","east","south","center"].forEach(function(w){if(w=r.gui[w]){w=q.getObject(w.component);w.elementAppended!=null&&w.elementAppended()}});z.resolve()}catch(m){b.error(m);z.reject(m)}}});bespin.tiki.register("::events",{name:"events",dependencies:{traits:"0.0.0"}});
bespin.tiki.module("events:index",function(x,t){t.Event=function(){var v=[],s=function(){var n=arguments;v.forEach(function(j){j.func.apply(null,n)})};s.add=function(){arguments.length==1?v.push({ref:arguments[0],func:arguments[0]}):v.push({ref:arguments[0],func:arguments[1]})};s.remove=function(n){v=v.filter(function(j){return n!==j.ref})};s.removeAll=function(){v=[]};return s}});bespin.tiki.register("::screen_theme",{name:"screen_theme",dependencies:{theme_manager:"0.0.0"}});
bespin.tiki.module("screen_theme:index",function(){});
(function(){var x=bespin.tiki.require("jquery").$;x(document).ready(function(){bespin.tiki.require("bespin:plugins").catalog.registerMetadata({text_editor:{resourceURL:"/documentation/assets/bespin/resources/text_editor/",description:"Canvas-based text editor component and many common editing commands",dependencies:{completion:"0.0.0",undomanager:"0.0.0",settings:"0.0.0",canon:"0.0.0",rangeutils:"0.0.0",traits:"0.0.0",theme_manager:"0.0.0",keyboard:"0.0.0",edit_session:"0.0.0",syntax_manager:"0.0.0"},testmodules:["tests/testScratchcanvas",
"tests/utils/testRect","tests/models/testTextstorage","tests/controllers/testLayoutmanager"],provides:[{action:"new",pointer:"views/editor#EditorView",ep:"factory",name:"text_editor"},{predicates:{isTextView:true},pointer:"commands/editing#backspace",ep:"command",key:"backspace",name:"backspace"},{predicates:{isTextView:true},pointer:"commands/editing#deleteCommand",ep:"command",key:"delete",name:"delete"},{description:"Delete all lines currently selected",key:"ctrl_d",predicates:{isTextView:true},
pointer:"commands/editing#deleteLines",ep:"command",name:"deletelines"},{description:"Create a new, empty line below the current one",key:"ctrl_return",predicates:{isTextView:true},pointer:"commands/editing#openLine",ep:"command",name:"openline"},{description:"Join the current line with the following",key:"ctrl_shift_j",predicates:{isTextView:true},pointer:"commands/editing#joinLines",ep:"command",name:"joinline"},{params:[{defaultValue:"",type:"text",name:"text",description:"The text to insert"}],
pointer:"commands/editing#insertText",ep:"command",name:"insertText"},{predicates:{completing:false,isTextView:true},pointer:"commands/editing#newline",ep:"command",key:"return",name:"newline"},{predicates:{completing:false,isTextView:true},pointer:"commands/editing#tab",ep:"command",key:"tab",name:"tab"},{predicates:{isTextView:true},pointer:"commands/editing#untab",ep:"command",key:"shift_tab",name:"untab"},{predicates:{isTextView:true},ep:"command",name:"move"},{description:"Repeat the last search (forward)",
pointer:"commands/editor#findNextCommand",ep:"command",key:"ctrl_g",name:"findnext"},{description:"Repeat the last search (backward)",pointer:"commands/editor#findPrevCommand",ep:"command",key:"ctrl_shift_g",name:"findprev"},{predicates:{completing:false,isTextView:true},pointer:"commands/movement#moveDown",ep:"command",key:"down",name:"move down"},{predicates:{isTextView:true},pointer:"commands/movement#moveLeft",ep:"command",key:"left",name:"move left"},{predicates:{isTextView:true},pointer:"commands/movement#moveRight",
ep:"command",key:"right",name:"move right"},{predicates:{completing:false,isTextView:true},pointer:"commands/movement#moveUp",ep:"command",key:"up",name:"move up"},{predicates:{isTextView:true},ep:"command",name:"select"},{predicates:{isTextView:true},pointer:"commands/movement#selectDown",ep:"command",key:"shift_down",name:"select down"},{predicates:{isTextView:true},pointer:"commands/movement#selectLeft",ep:"command",key:"shift_left",name:"select left"},{predicates:{isTextView:true},pointer:"commands/movement#selectRight",
ep:"command",key:"shift_right",name:"select right"},{predicates:{isTextView:true},pointer:"commands/movement#selectUp",ep:"command",key:"shift_up",name:"select up"},{predicates:{isTextView:true},pointer:"commands/movement#moveLineEnd",ep:"command",key:["end","ctrl_right"],name:"move lineend"},{predicates:{isTextView:true},pointer:"commands/movement#selectLineEnd",ep:"command",key:["shift_end","ctrl_shift_right"],name:"select lineend"},{predicates:{isTextView:true},pointer:"commands/movement#moveDocEnd",
ep:"command",key:"ctrl_down",name:"move docend"},{predicates:{isTextView:true},pointer:"commands/movement#selectDocEnd",ep:"command",key:"ctrl_shift_down",name:"select docend"},{predicates:{isTextView:true},pointer:"commands/movement#moveLineStart",ep:"command",key:["home","ctrl_left"],name:"move linestart"},{predicates:{isTextView:true},pointer:"commands/movement#selectLineStart",ep:"command",key:["shift_home","ctrl_shift_left"],name:"select linestart"},{predicates:{isTextView:true},pointer:"commands/movement#moveDocStart",
ep:"command",key:"ctrl_up",name:"move docstart"},{predicates:{isTextView:true},pointer:"commands/movement#selectDocStart",ep:"command",key:"ctrl_shift_up",name:"select docstart"},{predicates:{isTextView:true},pointer:"commands/movement#moveNextWord",ep:"command",key:["alt_right"],name:"move nextword"},{predicates:{isTextView:true},pointer:"commands/movement#selectNextWord",ep:"command",key:["alt_shift_right"],name:"select nextword"},{predicates:{isTextView:true},pointer:"commands/movement#movePreviousWord",
ep:"command",key:["alt_left"],name:"move prevword"},{predicates:{isTextView:true},pointer:"commands/movement#selectPreviousWord",ep:"command",key:["alt_shift_left"],name:"select prevword"},{predicates:{isTextView:true},pointer:"commands/movement#selectAll",ep:"command",key:["ctrl_a","meta_a"],name:"select all"},{predicates:{isTextView:true},ep:"command",name:"scroll"},{predicates:{isTextView:true},pointer:"commands/scrolling#scrollDocStart",ep:"command",key:"ctrl_home",name:"scroll start"},{predicates:{isTextView:true},
pointer:"commands/scrolling#scrollDocEnd",ep:"command",key:"ctrl_end",name:"scroll end"},{predicates:{isTextView:true},pointer:"commands/scrolling#scrollPageDown",ep:"command",key:"pagedown",name:"scroll down"},{predicates:{isTextView:true},pointer:"commands/scrolling#scrollPageUp",ep:"command",key:"pageup",name:"scroll up"},{pointer:"commands/editor#lcCommand",description:"Change all selected text to lowercase",withKey:"CMD SHIFT L",ep:"command",name:"lc"},{pointer:"commands/editor#detabCommand",
description:"Convert tabs to spaces.",params:[{defaultValue:null,type:"text",name:"tabsize",description:"Optionally, specify a tab size. (Defaults to setting.)"}],ep:"command",name:"detab"},{pointer:"commands/editor#entabCommand",description:"Convert spaces to tabs.",params:[{defaultValue:null,type:"text",name:"tabsize",description:"Optionally, specify a tab size. (Defaults to setting.)"}],ep:"command",name:"entab"},{pointer:"commands/editor#trimCommand",description:"trim trailing or leading whitespace from each line in selection",
params:[{defaultValue:"both",type:{data:[{name:"left"},{name:"right"},{name:"both"}],name:"selection"},name:"side",description:"Do we trim from the left, right or both"}],ep:"command",name:"trim"},{pointer:"commands/editor#ucCommand",description:"Change all selected text to uppercase",withKey:"CMD SHIFT U",ep:"command",name:"uc"},{predicates:{isTextView:true},pointer:"controllers/undo#undoManagerCommand",ep:"command",key:["ctrl_shift_z"],name:"redo"},{predicates:{isTextView:true},pointer:"controllers/undo#undoManagerCommand",
ep:"command",key:["ctrl_z"],name:"undo"},{description:"The distance in characters between each tab",defaultValue:8,type:"number",ep:"setting",name:"tabstop"},{description:"Customize the keymapping",defaultValue:"{}",type:"text",ep:"setting",name:"customKeymapping"},{description:"The keymapping to use",defaultValue:"standard",type:"text",ep:"setting",name:"keymapping"},{description:"The editor font size in pixels",defaultValue:14,type:"number",ep:"setting",name:"fontsize"},{description:"The editor font face",
defaultValue:"Monaco, Lucida Console, monospace",type:"text",ep:"setting",name:"fontface"},{defaultValue:{color:"#e5c138",paddingLeft:5,backgroundColor:"#4c4a41",paddingRight:10},ep:"themevariable",name:"gutter"},{defaultValue:{color:"#e6e6e6",selectedTextBackgroundColor:"#526da5",backgroundColor:"#2a211c",cursorColor:"#879aff",unfocusedCursorBackgroundColor:"#73171e",unfocusedCursorColor:"#ff0033"},ep:"themevariable",name:"editor"},{defaultValue:{comment:"#666666",directive:"#999999",keyword:"#42A8ED",
addition:"#FFFFFF",plain:"#e6e6e6",module:"#BA4946",specialmodule:"#C741BB",builtin:"#307BAD",deletion:"#FFFFFF",error:"#ff0000",operator:"#88BBFF",identifier:"#D841FF",string:"#039A0A"},ep:"themevariable",name:"highlighterFG"},{defaultValue:{addition:"#008000",deletion:"#800000"},ep:"themevariable",name:"highlighterBG"},{defaultValue:{nibStrokeStyle:"rgb(150, 150, 150)",fullAlpha:1,barFillStyle:"rgb(0, 0, 0)",particalAlpha:0.3,barFillGradientBottomStop:"rgb(44, 44, 44)",backgroundStyle:"#2A211C",
thickness:17,padding:5,trackStrokeStyle:"rgb(150, 150, 150)",nibArrowStyle:"rgb(255, 255, 255)",barFillGradientBottomStart:"rgb(22, 22, 22)",barFillGradientTopStop:"rgb(40, 40, 40)",barFillGradientTopStart:"rgb(90, 90, 90)",nibStyle:"rgb(100, 100, 100)",trackFillStyle:"rgba(50, 50, 50, 0.8)"},ep:"themevariable",name:"scroller"},{description:"Event: Notify when something within the editor changed.",params:[{required:true,name:"pointer",description:"Function that is called whenever a change happened."}],
ep:"extensionpoint",name:"editorChange"},{description:"Decoration for the gutter",ep:"extensionpoint",name:"gutterDecoration"},{description:"Line number decoration for the gutter",pointer:"views/gutter#lineNumbers",ep:"gutterDecoration",name:"lineNumbers"}],type:"plugins/supported",name:"text_editor"},less:{resourceURL:"/documentation/assets/bespin/resources/less/",description:"Leaner CSS",contributors:[],author:"Alexis Sellier <self@cloudhead.net>",url:"http://lesscss.org",version:"1.0.11",dependencies:{},testmodules:[],provides:[],
keywords:["css","parser","lesscss","browser"],type:"plugins/thirdparty",name:"less"},theme_manager_base:{resourceURL:"/documentation/assets/bespin/resources/theme_manager_base/",name:"theme_manager_base",share:true,environments:{main:true},dependencies:{},testmodules:[],provides:[{description:"(Less)files holding the CSS style information for the UI.",params:[{required:true,name:"url",description:"Name of the ThemeStylesFile - can also be an array of files."}],ep:"extensionpoint",name:"themestyles"},{description:"Event: Notify when the theme(styles) changed.",
params:[{required:true,name:"pointer",description:"Function that is called whenever the theme is changed."}],ep:"extensionpoint",name:"themeChange"},{indexOn:"name",description:"A theme is a way change the look of the application.",params:[{required:false,name:"url",description:"Name of a ThemeStylesFile that holds theme specific CSS rules - can also be an array of files."},{required:true,name:"pointer",description:"Function that returns the ThemeData"}],ep:"extensionpoint",name:"theme"}],type:"plugins/supported",
description:"Defines extension points required for theming"},canon:{resourceURL:"/documentation/assets/bespin/resources/canon/",name:"canon",environments:{main:true,worker:false},dependencies:{environment:"0.0.0",events:"0.0.0",settings:"0.0.0"},testmodules:[],provides:[{indexOn:"name",description:"A command is a bit of functionality with optional typed arguments which can do something small like moving the cursor around the screen, or large like cloning a project from VCS.",ep:"extensionpoint",name:"command"},{description:"An extension point to be called whenever a new command begins output.",
ep:"extensionpoint",name:"addedRequestOutput"},{description:"A dimensionsChanged is a way to be notified of changes to the dimension of Bespin",ep:"extensionpoint",name:"dimensionsChanged"},{description:"How many typed commands do we recall for reference?",defaultValue:50,type:"number",ep:"setting",name:"historyLength"},{action:"create",pointer:"history#InMemoryHistory",ep:"factory",name:"history"}],type:"plugins/supported",description:"Manages commands"},traits:{resourceURL:"/documentation/assets/bespin/resources/traits/",description:"Traits library, traitsjs.org",
dependencies:{},testmodules:[],provides:[],type:"plugins/thirdparty",name:"traits"},keyboard:{resourceURL:"/documentation/assets/bespin/resources/keyboard/",description:"Keyboard shortcuts",dependencies:{canon:"0.0",settings:"0.0"},testmodules:["tests/testKeyboard"],provides:[{description:"A keymapping defines how keystrokes are interpreted.",params:[{required:true,name:"states",description:"Holds the states and all the informations about the keymapping. See docs: pluginguide/keymapping"}],ep:"extensionpoint",name:"keymapping"}],
type:"plugins/supported",name:"keyboard"},worker_manager:{resourceURL:"/documentation/assets/bespin/resources/worker_manager/",description:"Manages a web worker on the browser side",dependencies:{canon:"0.0.0",events:"0.0.0",underscore:"0.0.0"},testmodules:[],provides:[{description:"Low-level web worker control (for plugin development)",ep:"command",name:"worker"},{description:"Restarts all web workers (for plugin development)",pointer:"#workerRestartCommand",ep:"command",name:"worker restart"}],type:"plugins/supported",name:"worker_manager"},
edit_session:{resourceURL:"/documentation/assets/bespin/resources/edit_session/",description:"Ties together the files being edited with the views on screen",dependencies:{events:"0.0.0"},testmodules:["tests/testSession"],provides:[{action:"call",pointer:"#createSession",ep:"factory",name:"session"}],type:"plugins/supported",name:"edit_session"},syntax_manager:{resourceURL:"/documentation/assets/bespin/resources/syntax_manager/",name:"syntax_manager",environments:{main:true,worker:false},dependencies:{worker_manager:"0.0.0",syntax_directory:"0.0.0",events:"0.0.0",
underscore:"0.0.0",settings:"0.0.0"},testmodules:[],provides:[],type:"plugins/supported",description:"Provides syntax highlighting services for the editor"},completion:{resourceURL:"/documentation/assets/bespin/resources/completion/",description:"Code completion support",dependencies:{jquery:"0.0.0",ctags:"0.0.0",rangeutils:"0.0.0",canon:"0.0.0",underscore:"0.0.0"},testmodules:[],provides:[{indexOn:"name",description:"Code completion support for specific languages",ep:"extensionpoint",name:"completion"},{description:"Accept the chosen completion",
key:["return","tab"],predicates:{completing:true},pointer:"controller#completeCommand",ep:"command",name:"complete"},{description:"Abandon the completion",key:"escape",predicates:{completing:true},pointer:"controller#completeCancelCommand",ep:"command",name:"complete cancel"},{description:"Choose the completion below",key:"down",predicates:{completing:true},pointer:"controller#completeDownCommand",ep:"command",name:"complete down"},{description:"Choose the completion above",key:"up",predicates:{completing:true},
pointer:"controller#completeUpCommand",ep:"command",name:"complete up"}],type:"plugins/supported",name:"completion"},environment:{testmodules:[],dependencies:{settings:"0.0.0"},resourceURL:"/documentation/assets/bespin/resources/environment/",name:"environment",type:"plugins/supported"},undomanager:{resourceURL:"/documentation/assets/bespin/resources/undomanager/",description:"Manages undoable events",testmodules:["tests/testUndomanager"],provides:[{pointer:"#undoManagerCommand",ep:"command",key:["ctrl_shift_z"],name:"redo"},{pointer:"#undoManagerCommand",
ep:"command",key:["ctrl_z"],name:"undo"}],type:"plugins/supported",name:"undomanager"},rangeutils:{testmodules:["tests/test"],type:"plugins/supported",resourceURL:"/documentation/assets/bespin/resources/rangeutils/",description:"Utility functions for dealing with ranges of text",name:"rangeutils"},stylesheet:{resourceURL:"/documentation/assets/bespin/resources/stylesheet/",name:"stylesheet",environments:{worker:true},dependencies:{standard_syntax:"0.0.0"},testmodules:[],provides:[{pointer:"#CSSSyntax",ep:"syntax",fileexts:["css","less"],name:"css"}],type:"plugins/supported",
description:"CSS syntax highlighter"},ctags:{resourceURL:"/documentation/assets/bespin/resources/ctags/",description:"Reads and writes tag files",dependencies:{traits:"0.0.0",underscore:"0.0.0"},testmodules:[],type:"plugins/supported",name:"ctags"},events:{resourceURL:"/documentation/assets/bespin/resources/events/",description:"Dead simple event implementation",dependencies:{traits:"0.0"},testmodules:["tests/test"],provides:[],type:"plugins/supported",name:"events"},gherkin_syntax:{resourceURL:"/documentation/assets/bespin/resources/gherkin_syntax/",name:"gherkin_syntax",environments:{worker:true},
dependencies:{standard_syntax:"0.0.0"},testmodules:[],provides:[{pointer:"#GherkinSyntax",ep:"syntax",fileexts:["feature"],name:"gherkin"}],type:"plugins/supported",description:"Gherkin syntax highlighter"},theme_manager:{resourceURL:"/documentation/assets/bespin/resources/theme_manager/",name:"theme_manager",share:true,environments:{main:true,worker:false},dependencies:{theme_manager_base:"0.0.0",settings:"0.0.0",events:"0.0.0",less:"0.0.0"},testmodules:[],provides:[{unregister:"themestyles#unregisterThemeStyles",register:"themestyles#registerThemeStyles",
ep:"extensionhandler",name:"themestyles"},{unregister:"index#unregisterTheme",register:"index#registerTheme",ep:"extensionhandler",name:"theme"},{defaultValue:"standard",description:"The theme plugin's name to use. If set to 'standard' no theme will be used",type:"text",ep:"setting",name:"theme"},{pointer:"#appLaunched",ep:"appLaunched"}],type:"plugins/supported",description:"Handles colors in Bespin"},standard_syntax:{resourceURL:"/documentation/assets/bespin/resources/standard_syntax/",description:"Easy-to-use basis for syntax engines",
environments:{worker:true},dependencies:{syntax_worker:"0.0.0",syntax_directory:"0.0.0",underscore:"0.0.0"},testmodules:[],type:"plugins/supported",name:"standard_syntax"},types:{resourceURL:"/documentation/assets/bespin/resources/types/",description:"Defines parameter types for commands",testmodules:["tests/testTypes","tests/testBasic"],provides:[{indexOn:"name",description:"Commands can accept various arguments that the user enters or that are automatically supplied by the environment. Those arguments have types that define how they are supplied or completed. The pointer points to an object with methods convert(str value) and getDefault(). Both functions have `this` set to the command's `takes` parameter. If getDefault is not defined, the default on the command's `takes` is used, if there is one. The object can have a noInput property that is set to true to reflect that this type is provided directly by the system. getDefault must be defined in that case.",
ep:"extensionpoint",name:"type"},{description:"Text that the user needs to enter.",pointer:"basic#text",ep:"type",name:"text"},{description:"A JavaScript number",pointer:"basic#number",ep:"type",name:"number"},{description:"A true/false value",pointer:"basic#bool",ep:"type",name:"boolean"},{description:"An object that converts via JavaScript",pointer:"basic#object",ep:"type",name:"object"},{description:"A string that is constrained to be one of a number of pre-defined values",pointer:"basic#selection",
ep:"type",name:"selection"},{description:"A type which we don't understand from the outset, but which we hope context can help us with",ep:"type",name:"deferred"}],type:"plugins/supported",name:"types"},jquery:{testmodules:[],resourceURL:"/documentation/assets/bespin/resources/jquery/",name:"jquery",type:"plugins/thirdparty"},embedded:{testmodules:[],dependencies:{theme_manager:"0.0.0",text_editor:"0.0.0",appconfig:"0.0.0",edit_session:"0.0.0",screen_theme:"0.0.0"},resourceURL:"/documentation/assets/bespin/resources/embedded/",name:"embedded",type:"plugins/supported"},
settings:{resourceURL:"/documentation/assets/bespin/resources/settings/",description:"Infrastructure and commands for managing user preferences",share:true,dependencies:{types:"0.0"},testmodules:[],provides:[{indexOn:"name",description:"A setting is something that the application offers as a way to customize how it works",register:"index#addSetting",ep:"extensionpoint",name:"setting"},{description:"A settingChange is a way to be notified of changes to a setting",ep:"extensionpoint",name:"settingChange"},{pointer:"commands#setCommand",
description:"define and show settings",params:[{defaultValue:null,type:{pointer:"settings:index#getSettings",name:"selection"},name:"setting",description:"The name of the setting to display or alter"},{defaultValue:null,type:{pointer:"settings:index#getTypeSpecFromAssignment",name:"deferred"},name:"value",description:"The new value for the chosen setting"}],ep:"command",name:"set"},{pointer:"commands#unsetCommand",description:"unset a setting entirely",params:[{type:{pointer:"settings:index#getSettings",
name:"selection"},name:"setting",description:"The name of the setting to return to defaults"}],ep:"command",name:"unset"}],type:"plugins/supported",name:"settings"},appconfig:{resourceURL:"/documentation/assets/bespin/resources/appconfig/",description:"Instantiates components and displays the GUI based on configuration.",dependencies:{jquery:"0.0.0",canon:"0.0.0",underscore:"0.0.0",settings:"0.0.0"},testmodules:[],provides:[{description:"Event: Fired when the app is completely launched.",ep:"extensionpoint",name:"appLaunched"}],
type:"plugins/supported",name:"appconfig"},syntax_worker:{resourceURL:"/documentation/assets/bespin/resources/syntax_worker/",description:"Coordinates multiple syntax engines",environments:{worker:true},dependencies:{syntax_directory:"0.0.0",underscore:"0.0.0"},testmodules:[],type:"plugins/supported",name:"syntax_worker"},screen_theme:{resourceURL:"/documentation/assets/bespin/resources/screen_theme/",description:"Bespins standard theme basePlugin",dependencies:{theme_manager:"0.0.0"},testmodules:[],provides:[{url:["theme.less"],ep:"themestyles"},{defaultValue:"@global_font",
ep:"themevariable",name:"container_font"},{defaultValue:"@global_font_size",ep:"themevariable",name:"container_font_size"},{defaultValue:"@global_container_background",ep:"themevariable",name:"container_bg"},{defaultValue:"@global_color",ep:"themevariable",name:"container_color"},{defaultValue:"@global_line_height",ep:"themevariable",name:"container_line_height"},{defaultValue:"@global_pane_background",ep:"themevariable",name:"pane_bg"},{defaultValue:"@global_pane_border_radius",ep:"themevariable",
name:"pane_border_radius"},{defaultValue:"@global_form_font",ep:"themevariable",name:"form_font"},{defaultValue:"@global_form_font_size",ep:"themevariable",name:"form_font_size"},{defaultValue:"@global_form_line_height",ep:"themevariable",name:"form_line_height"},{defaultValue:"@global_form_color",ep:"themevariable",name:"form_color"},{defaultValue:"@global_form_text_shadow",ep:"themevariable",name:"form_text_shadow"},{defaultValue:"@global_pane_link_color",ep:"themevariable",name:"pane_a_color"},
{defaultValue:"@global_font",ep:"themevariable",name:"pane_font"},{defaultValue:"@global_font_size",ep:"themevariable",name:"pane_font_size"},{defaultValue:"@global_pane_text_shadow",ep:"themevariable",name:"pane_text_shadow"},{defaultValue:"@global_pane_h1_font",ep:"themevariable",name:"pane_h1_font"},{defaultValue:"@global_pane_h1_font_size",ep:"themevariable",name:"pane_h1_font_size"},{defaultValue:"@global_pane_h1_color",ep:"themevariable",name:"pane_h1_color"},{defaultValue:"@global_font_size * 1.8",
ep:"themevariable",name:"pane_line_height"},{defaultValue:"@global_pane_color",ep:"themevariable",name:"pane_color"},{defaultValue:"@global_text_shadow",ep:"themevariable",name:"pane_text_shadow"},{defaultValue:"@global_font",ep:"themevariable",name:"button_font"},{defaultValue:"@global_font_size",ep:"themevariable",name:"button_font_size"},{defaultValue:"@global_button_color",ep:"themevariable",name:"button_color"},{defaultValue:"@global_button_background",ep:"themevariable",name:"button_bg"},{defaultValue:"@button_bg - #063A27",
ep:"themevariable",name:"button_bg2"},{defaultValue:"@button_bg - #194A5E",ep:"themevariable",name:"button_border"},{defaultValue:"@global_control_background",ep:"themevariable",name:"control_bg"},{defaultValue:"@global_control_color",ep:"themevariable",name:"control_color"},{defaultValue:"@global_control_border",ep:"themevariable",name:"control_border"},{defaultValue:"@global_control_border_radius",ep:"themevariable",name:"control_border_radius"},{defaultValue:"@global_control_active_background",
ep:"themevariable",name:"control_active_bg"},{defaultValue:"@global_control_active_border",ep:"themevariable",name:"control_active_border"},{defaultValue:"@global_control_active_color",ep:"themevariable",name:"control_active_color"},{defaultValue:"@global_control_active_inset_color",ep:"themevariable",name:"control_active_inset_color"}],type:"plugins/supported",name:"screen_theme"}})})})();
(function(){var x=bespin.tiki.require("bespin:promise").Promise,t=bespin.tiki.require("bespin:promise").group,v=bespin.tiki.require("jquery").$;bespin.loaded=new x;bespin.initialized=new x;var s=function(n,j,b){n=n.style[b]||document.defaultView.getComputedStyle(n,"").getPropertyValue(b);if(!n||n=="auto"||n=="intrinsic")n=j.style[b];return n};bespin.useBespin=function(n,j){var b=bespin.tiki.require("bespin:util/util"),e={},l=e.settings;j=j||{};for(var h in j)e[h]=j[h];j=e.settings;if(l!==undefined)for(h in l)if(j[h]===
undefined)e.settings[h]=l[h];var i=null,g=new x;bespin.tiki.require.ensurePackage("::appconfig",function(){var q=bespin.tiki.require("appconfig");if(b.isString(n))n=document.getElementById(n);if(b.none(e.initialContent))e.initialContent=n.value||n.innerHTML;n.innerHTML="";if(n.type=="textarea"){var r=n.parentNode,z=document.createElement("div"),C=function(){var K="position:relative;";["margin-top","margin-left","margin-right","margin-bottom"].forEach(function(w){K+=w+":"+s(n,z,w)+";"});var M=s(n,
z,"width"),m=s(n,z,"height");K+="height:"+m+";width:"+M+";";K+="display:inline-block;";z.setAttribute("style",K)};window.addEventListener("resize",C,false);C();for(n.nextSibling?r.insertBefore(z,n.nextSibling):r.appendChild(z);r!==document;){if(r.tagName.toUpperCase()==="FORM"){var f=r.onsubmit;r.onsubmit=function(K){n.value=i.editor.value;n.innerHTML=i.editor.value;f&&f.call(this,K)};break}r=r.parentNode}n.style.display="none";e.element=z;if(!b.none(n.getAttribute("readonly")))e.readOnly=true}else e.element=
n;q.launch(e).then(function(K){i=K;g.resolve(K)})});return g};v(document).ready(function(){bespin.loaded.resolve();for(var n=[],j=document.querySelectorAll(".bespin"),b=0;b<j.length;b++){var e=j[b],l=e.getAttribute("data-bespinoptions")||"{}";l=bespin.useBespin(e,JSON.parse(l));l.then(function(h){e.bespin=h},function(h){throw new Error("Launch failed: "+h);});n.push(l)}t(n).then(function(){bespin.initialized.resolve();window.onBespinLoad&&window.onBespinLoad()},function(h){bespin.initialized.reject("At least one Bespin failed to launch!"+
h)})})})();
